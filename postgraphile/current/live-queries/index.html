<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-4.x plugin-docs plugin-id-default docs-doc-id-live-queries">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Live Queries | PostGraphile</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://postgraphile.org/postgraphile/current/live-queries"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="4.x"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.x"><meta data-rh="true" name="docsearch:version" content="4.x"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.x"><meta data-rh="true" property="og:title" content="Live Queries | PostGraphile"><meta data-rh="true" name="description" content="A “live query” monitors the query a user provides and gives the client an updated version whenever the query would return a different result."><meta data-rh="true" property="og:description" content="A “live query” monitors the query a user provides and gives the client an updated version whenever the query would return a different result."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://postgraphile.org/postgraphile/current/live-queries"><link data-rh="true" rel="alternate" href="https://postgraphile.org/postgraphile/current/live-queries" hreflang="en"><link data-rh="true" rel="alternate" href="https://postgraphile.org/postgraphile/current/live-queries" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://T47OLMXAXW-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="PostGraphile" href="/opensearch.xml">

<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="PostGraphile RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="PostGraphile Atom Feed">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Sarabun"><link rel="stylesheet" href="/assets/css/styles.b5934424.css">
<link rel="preload" href="/assets/js/runtime~main.80bf8250.js" as="script">
<link rel="preload" href="/assets/js/main.4f3a8e0c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_ncOr" role="banner"><div class="content_L1uV announcementBarContent__57G">This documentation is a work in progress, please forgive gaps, and feel free to send pull requests!</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="PostGraphile Logo" class="themedImage_RWGG themedImage--light_riBm"><img src="/img/logo.svg" alt="PostGraphile Logo" class="themedImage_RWGG themedImage--dark_Dsi0"></div><b class="navbar__title text--truncate">PostGraphile</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/postgraphile/current/">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/postgraphile/current/">4.x</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/postgraphile/next/">Next</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/postgraphile/current/live-queries">4.x</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/news">News</a><a class="navbar__item navbar__link" href="/sponsor">Sponsor</a><a class="navbar__item navbar__link" href="/pricing">Go Pro</a><a href="https://www.graphile.org/support/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Support<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/graphile/crystal" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_xrOJ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV docsWrapper_BqXd"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docPage_pOTq"><aside class="theme-doc-sidebar-container docSidebarContainer_aIKW"><div class="sidebarViewport_DwR9"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME menuWithAnnouncementBar_hRfJ"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><h4>OVERVIEW</h4></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/postgraphile/current/examples/">Example Gallery</a><button aria-label="Toggle the collapsible sidebar category &#x27;Example Gallery&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/postgraphile/current/usage">Usage</a><button aria-label="Toggle the collapsible sidebar category &#x27;Usage&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/performance">Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/requirements">Requirements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/required-knowledge">Required Knowledge</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><h4>OPERATION</h4></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/quick-start-guide">Quick Start Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/namespaces">Namespaces (PostgreSQL &quot;schemas&quot;)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/inflection">Inflection</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/postgraphile/current/tables">Tables</a><button aria-label="Toggle the collapsible sidebar category &#x27;Tables&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/postgraphile/current/functions">Functions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Functions&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/enums">Enums</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/views">Views</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/aggregates">Aggregates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/postgresql-indexes">PostgreSQL Indexes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/security">Security</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/postgraphile/current/realtime">Realtime</a><button aria-label="Toggle the collapsible sidebar category &#x27;Realtime&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/postgraphile/current/subscriptions">GraphQL Subscriptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/postgraphile/current/live-queries">Live Queries</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/background-tasks">Background Tasks in PostGraphile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/reserved-keywords">Reserved Keywords / Table Names</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/debugging">Debugging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><h4>CUSTOMISING</h4></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/postgraphile/current/smart-tags">Smart Tags</a><button aria-label="Toggle the collapsible sidebar category &#x27;Smart Tags&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/postgraphile/current/extending">Schema Plugins</a><button aria-label="Toggle the collapsible sidebar category &#x27;Schema Plugins&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/plugins">Server Plugins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><h4>GUIDES</h4></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/postgresql-schema-design">PostgreSQL Schema Design</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/evaluating">Evaluating</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/best-practices">PostGraphile best practices</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/production">Production Considerations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/jwt-guide">PostGraphile JWT Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/jwk-verification">PostGraphile JWT/JWK Verification Quickstart</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/default-role">Default Role</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/pg-pubsub-migration">Migrating from the Supporter Plugin to @graphile/pg-pubsub</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/v4-new-features">v4 Feature Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/v3-migration">Migrating from PostGraphQL v3</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/testing-jest">Testing with Jest</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/bundling-webpack">Bundling PostGraphile with Webpack</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/multiple-schemas">Multiple GraphQL Schemas with PostGraphile</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/running-postgraphile-in-docker">Running PostGraphile in Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/running-postgraphile-as-a-library-in-docker">Running PostGraphile as a library in Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><h4>DEPLOYING</h4></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/deploying-heroku">Deploying to Heroku</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/deploying-docker">Deploying with Docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/deploying-lambda">Deploying to AWS Lambda</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/deploying-gcp">Deploying to GCP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><h4>COMMUNITY</h4></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/community-contributions">Community contributions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/community-chat">PostGraphile chat</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/code-of-conduct">Code of Conduct</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><h4>FAQ</h4></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/introspection">Introspection?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/why-nullable">Why is it nullable?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/postgraphile/current/versioning-policy">Versioning Policy</a></li></ul></nav></div></div></aside><main class="docMainContainer_fv3b"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/postgraphile/current/realtime"><span itemprop="name">Realtime</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Live Queries</span><meta itemprop="position" content="2"></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Version: 4.x</span><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Live Queries</h1></header><p class="intro">A “live query” monitors the query a user provides and gives the client an updated version whenever the query would return a different result.</p><p><em>This feature requires PostGraphile v4.4.0 or higher.</em></p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="what-are-live-queries">What are live queries?<a href="#what-are-live-queries" class="hash-link" aria-label="Direct link to What are live queries?" title="Direct link to What are live queries?">​</a></h3><p>You can think of live queries as akin to extremely frequent polling of a regular
query, but without the bandwidth costs. Live queries are not yet an official
feature of GraphQL, and so there are a number of different implementations.
PostGraphile’s live queries do not require specific client software since we use
the standard GraphQL subscriptions interface — simply change your <code>query</code> to a
<code>subscription</code> and it becomes live, as in the following example
(<a href="https://github.com/graphile/livesotope" target="_blank" rel="noopener noreferrer">available on GitHub</a>) showing
real-time points rankings of fictional players:</p><div class="tc"><img loading="lazy" alt="Changing a query to a live query" src="/images/query2subscription.png" style="max-height:230px" class="img__Ss2"></div><p></p><div class="tc"><img loading="lazy" alt="Demo of live query" src="/images/live_demo_rankings.gif" class="img__Ss2"></div><p>Live queries are an incredibly powerful tool for frontend developers, as it
means they don’t need to worry about monitoring for changes in the data — they
know the data they’ve requested will always be up to date. However, live queries
are not a panacea: they can come with significant backend cost and/or
complexity.</p><p>One way to achieve 100% accurate live queries is to run the users query over and
over on the server side, and send an update whenever the results change. This,
however, is not very efficient and puts an excessive load on the server.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="live-queries-via-logical-decoding">Live queries via logical decoding<a href="#live-queries-via-logical-decoding" class="hash-link" aria-label="Direct link to Live queries via logical decoding" title="Direct link to Live queries via logical decoding">​</a></h3><p>PostGraphile supports &quot;realtime provider plugins&quot; to source information about
when data changes. Our initial official realtime provider plugin,
<code>@graphile/subscriptions-lds</code>, monitors a “logical replication slot” from
PostgreSQL (this is similar to the system that PostgreSQL read-replicas use to
stay up to date with the primary database). This allows us to determine relevant
changes without putting too much additional load on the database.</p><p>However, we must re-run the user&#x27;s query to see if anything else (e.g. computed
values from functions, views, plugins, etc; reordering of results; effects on
pagination) has changed before returning the updated data to the user.
Therefore, it’s best to keep live queries small and simple: the more complex the
query, the more sources of change it has (so updates may happen more
frequently), and the longer it will take to execute.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="when-not-to-use-live-queries">When (not) to use live queries<a href="#when-not-to-use-live-queries" class="hash-link" aria-label="Direct link to When (not) to use live queries" title="Direct link to When (not) to use live queries">​</a></h3><p>PostGraphile has worked hard to decrease the costs associated with live queries,
but there’s still more to be done. Currently we feel PostGraphile live queries
may be suitable in apps with relatively small user bases (such as for internal
tooling used across a large enterprise), but if you’re targeting an internet
scale deployment hoping for millions of users you will likely be better off
using <a href="/postgraphile/current/subscriptions/">subscriptions</a>, or keeping live queries to a very small
area of your application.</p><p>One particular problem to be aware of is the &quot;thundering herd&quot; — if thousands of
users are all subscribed to the same data, and that data is updated, then
thousands of SQL queries will be issued against the database at the same time.
This issue can be lessened by ensuring that live queries only apply to a subset
of users at a time.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="enabling-live-queries">Enabling live queries<a href="#enabling-live-queries" class="hash-link" aria-label="Direct link to Enabling live queries" title="Direct link to Enabling live queries">​</a></h3><p>To enable live queries support in PostGraphile, you will need:</p><ul><li>to pass <code>--live</code> (or <code>live: true</code>)</li><li>to provide a plugin that can inform PostGraphile of realtime changes</li></ul><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="realtime-provider-plugins">Realtime provider plugins<a href="#realtime-provider-plugins" class="hash-link" aria-label="Direct link to Realtime provider plugins" title="Direct link to Realtime provider plugins">​</a></h3><p>You may track changes to your database data in many ways, for example using
database triggers and LISTEN/NOTIFY, using logical decoding, or even by
streaming from an external source such as Kafka.</p><p>Currently we have one first-party realtime provider plugin,
<code>@graphile/subscriptions-lds</code>:</p><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="graphilesubscriptions-lds">@graphile/subscriptions-lds<a href="#graphilesubscriptions-lds" class="hash-link" aria-label="Direct link to @graphile/subscriptions-lds" title="Direct link to @graphile/subscriptions-lds">​</a></h4><p>This plugin uses the Logical Decoding features of PostgreSQL to get a stream of
data changes very efficiently from the database (using its replication
interface). When a change occurs, if any of the live queries would be affected
by it, they&#x27;re informed of the change and PostGraphile re-runs the query and
sends the results to the client - this ensures that database permissions are
always respected, and that no caching issues occur.</p><p>To enable this plugin, you must alter your PostgreSQL configuration
<code>postgresql.conf</code> and ensure that the following settings are enabled:</p><div class="codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">wal_level = logical</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_wal_senders = 10</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">max_replication_slots = 10</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You must also install the <code>wal2json</code> extension into PostgreSQL if you don&#x27;t
already have it (normally takes under 10 seconds):</p><div class="codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/eulerto/wal2json.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd wal2json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_PGXS=1 make</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">USE_PGXS=1 make install</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now PostgreSQL is ready, you can enable live queries support in PostGraphile.
First, install the plugin:</p><div class="codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">yarn add @graphile/subscriptions-lds</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Because of the power the replication interface gives, it&#x27;s necessary to use a
superuser or database owner account, so in addition to your normal connection
string you must also pass an &quot;owner&quot; connection string which has elevated
privileges. (If you&#x27;re not using RLS/etc and normally use PostGraphile with a
superuser/database owner account then this is unnecessary.)</p><p>On the CLI:</p><div class="codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-text codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">postgraphile \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --connection postgres://postgraphile_user:postgraphile_pass@host/db \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --live \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --owner-connection postgres://db_owner:db_owner_pass@host/db \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --append-plugins @graphile/subscriptions-lds \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Via the library:</p><div class="language-js codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-js codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">postgraphile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">AUTH_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">SCHEMA</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Enable live support in PostGraphile</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">live</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// We need elevated privileges for logical decoding</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">ownerConnectionString</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">ROOT_DATABASE_URL</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Add this plugin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">appendPlugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic">//...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;@graphile/subscriptions-lds&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token keyword module" style="color:#00009f">default</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then to make a query live, you simply turn it into a subscription, e.g.</p><div class="language-graphql codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-graphql codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token object">allPeople</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token object">nodes</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>would become:</p><div class="language-graphql codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-graphql codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">subscription</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token object">allPeople</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token object">nodes</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More detailed instructions are available in the
<a href="https://www.npmjs.com/package/@graphile/subscriptions-lds" target="_blank" rel="noopener noreferrer">@graphile/subscriptions-lds README</a>.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h3><p>You can configure the live query support with the following environmental
variables:</p><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="ld_wait-default-125"><code>LD_WAIT</code> (default 125)<a href="#ld_wait-default-125" class="hash-link" aria-label="Direct link to ld_wait-default-125" title="Direct link to ld_wait-default-125">​</a></h4><p>This environmental variable controls how often in milliseconds we check for
changes from the database. Setting it smaller leads to more timely updates but
increases overhead. Setting it larger increases efficiency but means each batch
takes longer to process which may slow the Node.js event loop.</p><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="live_throttle-default-500"><code>LIVE_THROTTLE</code> (default 500)<a href="#live_throttle-default-500" class="hash-link" aria-label="Direct link to live_throttle-default-500" title="Direct link to live_throttle-default-500">​</a></h4><p>This environmental variable is the minimum duration in milliseconds between live
updates to the same subscription.</p><p>If your server is getting overwhelmed, you may increase this to increase the
period between live updates sent to clients.</p><p>If your application is not responsive enough, you may decrease this to get
closer to real-time updates.</p><p>(Throttle fires on both the leading and trailing edge, so decreasing this only
affects successive updates, not the initial update.)</p><h4 class="anchor anchorWithStickyNavbar_fF9Z" id="ld_table_pattern-default-"><code>LD_TABLE_PATTERN</code> (default &quot;<!-- -->*<!-- -->.<!-- -->*<!-- -->&quot;)<a href="#ld_table_pattern-default-" class="hash-link" aria-label="Direct link to ld_table_pattern-default-" title="Direct link to ld_table_pattern-default-">​</a></h4><p>Set this envvar to e.g. <code>app_public.*</code> to only monitor tables in the
<code>app_public</code> schema. See
<a href="https://github.com/eulerto/wal2json#parameters" target="_blank" rel="noopener noreferrer"><code>filter-tables</code> in the wal2json documentation</a>.
This should increase performance by ignoring irrelevant data.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="performance">Performance<a href="#performance" class="hash-link" aria-label="Direct link to Performance" title="Direct link to Performance">​</a></h3><p>Live queries are a lot more expensive than regular subscriptions — the server
must monitor a lot more sources to detect a change (monitoring each individual
record returned, plus monitoring for additions/removals from any collection
including filtering constraints), and changes will most likely be more frequent
as they&#x27;re coming from multiple sources. Use live queries with care - it&#x27;s wise
to keep the queries as small as possible since they must be recalculated any
time anything within the query results changes.</p><p>Logical decoding uses a &quot;logical&quot; PostgreSQL replication slot (replication slots
are the technology behind how PostgreSQL read replicas stay up to date with the
primary). We poll this slot for changes using the efficient
<code>pg_logical_slot_get_changes</code> API in PostgreSQL. When a change is detected, we
check to see if this change is relevant to any of the running live queries, and
if so we tell that live query to refetch its data.</p><p>This refetching process requires the query to be executed again (in order for us
to ensure any requested data still matches the permissions you have set via RLS,
and to ensure that no old (cached) data can make the request
inconsistent/stale). However, it does come at a cost as any relevant data may
trigger multiple (or <em>all</em>) connected clients to all request the same data at
the same time (the &quot;thundering herd&quot; problem). We solve this slightly by giving
each client their own throttled callback, so the callbacks are offset. There&#x27;s a
lot more that can be done to optimise our logical decoding support, so if you
get to a point where logical decoding performance is an issue, please get in
touch!</p><p>Optimization steps you can take currently:</p><ul><li>Whitelist (or otherwise limit) the live queries that your system may perform</li><li>Only write small non-overlapping live queries - since the entire query must
run again on change it&#x27;s better to have 20 small queries than one large one
(quite the opposite to normal queries!)</li><li>Use <code>LD_TABLE_PATTERN</code> to ignore irrelevant data</li><li>Increase <code>LIVE_THROTTLE</code> and/or <code>LD_WAIT</code> to reduce the frequency data is
recalculated</li><li>Move the logical decoding system to a dedicated server</li><li>Add more <code>liveConditions</code> to queries to filter rows the user may not see so
that they do not trigger live updates for that user (TODO: document this!)</li><li>Use read replicas <span class="proTag_vRmB"><a href="/pricing/"><span class="firstLetter_NMLh">P</span>ro</a></span> <span class="sponTag_Nh0y"><a href="/sponsor/"><span class="firstLetter_NMLh">S</span>pon</a></span></li></ul><p>We do not currently recommend live queries for very large deployments - if
you&#x27;re expecting tens of thousands of concurrent users it&#x27;s going to be
significantly more efficient to use regular <a href="/postgraphile/current/subscriptions/">subscriptions</a>.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="scaling">Scaling<a href="#scaling" class="hash-link" aria-label="Direct link to Scaling" title="Direct link to Scaling">​</a></h3><p>Once you reach beyond a few PostGraphile instances you&#x27;ll want to make your live
decoding usage more efficient. We support this by allowing you to run a
dedicated live decoding server (LDS) and have PostGraphile instances connect to
this server. You can use the <code>LDS_URL</code> envvar to tell PostGraphile where to find
this shared server. To set up the server, follow the instructions in the
<a href="https://github.com/graphile/graphile-engine/blob/master/packages/lds/README.md" target="_blank" rel="noopener noreferrer">@graphile/lds</a>
project. When running LDS standalone like this, there are more options for
configuring it.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="inflection">Inflection<a href="#inflection" class="hash-link" aria-label="Direct link to Inflection" title="Direct link to Inflection">​</a></h3><p>By default, live fields use the same names as fields in the <code>Query</code> type;
however these field names are sent through the <code>live</code> inflector so you may
customise these if you wish using <a href="/postgraphile/current/inflection/">the inflection system</a>.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations">​</a></h3><p>Note that each live provider plugin has its own limitations, and may not be able
to detect all changes. For example <code>@graphile/subscriptions-lds</code> can detect
changes to results queried from tables, but cannot currently detect changes to
results queried from views and functions. In particular, computed columns are
not kept up to date (although they are re-calculated whenever a table update
triggers the subscription).</p><p>Monitored tables must also use primary keys. Problems may arise if such key is a
<code>bigint</code> or <code>bigserial</code> due to how PostgreSQL serializes these to JSON as a
number (which is allowed by the JSON spec), but JavaScript&#x27;s JSON.parse will not
maintain precision when parsing them, leading to potential divergence. We
recommend the key to be either a regular <code>int</code> or a <code>uuid</code>.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="amazon-rds">Amazon RDS<a href="#amazon-rds" class="hash-link" aria-label="Direct link to Amazon RDS" title="Direct link to Amazon RDS">​</a></h3><p>Configuring Live Queries on Amazon RDS is slightly different, as it&#x27;s a managed
service. (Also note that RDS runs a slightly out-of-date <code>wal2json</code>.)</p><p>To set up your RDS server:</p><ul><li>Go to &#x27;Parameter groups&#x27; in the AWS management console and change the
<code>rds.logical_replication</code> setting to <code>1</code>, then reboot your database</li><li>Connect to the RDS server as your superuser and
<code>grant rds_replication to DB_OWNER;</code> where <code>DB_OWNER</code> is the name of the
PostgreSQL role that created your database.</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/graphile/crystal/tree/main/postgraphile/website/versioned_docs/version-4.x/live-queries.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UohW" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_T23F"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/postgraphile/current/subscriptions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">GraphQL Subscriptions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/postgraphile/current/background-tasks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Background Tasks in PostGraphile</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-are-live-queries" class="table-of-contents__link toc-highlight">What are live queries?</a></li><li><a href="#live-queries-via-logical-decoding" class="table-of-contents__link toc-highlight">Live queries via logical decoding</a></li><li><a href="#when-not-to-use-live-queries" class="table-of-contents__link toc-highlight">When (not) to use live queries</a></li><li><a href="#enabling-live-queries" class="table-of-contents__link toc-highlight">Enabling live queries</a></li><li><a href="#realtime-provider-plugins" class="table-of-contents__link toc-highlight">Realtime provider plugins</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#performance" class="table-of-contents__link toc-highlight">Performance</a></li><li><a href="#scaling" class="table-of-contents__link toc-highlight">Scaling</a></li><li><a href="#inflection" class="table-of-contents__link toc-highlight">Inflection</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li><li><a href="#amazon-rds" class="table-of-contents__link toc-highlight">Amazon RDS</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://postgraphile.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">PostGraphile</a></li><li class="footer__item"><a class="footer__link-item" href="/grafast">Gra<em>fast</em></a></li><li class="footer__item"><a href="https://build.graphile.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Graphile Build</a></li><li class="footer__item"><a href="https://star.graphile.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Graphile*</a></li><li class="footer__item"><a href="https://grafast.org/ruru/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ruru</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/graphile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/GraphileHQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://fosstodon.org/@graphile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mastodon<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/graphile/crystal" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://graphile.org/sponsor/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsor<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/logo.svg" alt="PostGraphile Logo" class="themedImage_RWGG themedImage--light_riBm footer__logo" width="64" height="64"><img src="/img/logo.svg" alt="PostGraphile Logo" class="themedImage_RWGG themedImage--dark_Dsi0 footer__logo" width="64" height="64"></div><div class="footer__copyright">Copyright © 2024 Graphile Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.80bf8250.js"></script>
<script src="/assets/js/main.4f3a8e0c.js"></script>
</body>
</html>