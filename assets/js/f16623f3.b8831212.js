(self.webpackChunk_localrepo_grafast_website=self.webpackChunk_localrepo_grafast_website||[]).push([[1232],{90699:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hookArgs=void 0;const r=n(94932),a=n(40354),s=n(22722);t.hookArgs=function(e,t,n){const o=e;if(o[a.$$hooked])throw new Error("Must not call hookArgs twice!");o[a.$$hooked]=!0,o.contextValue=Object.assign(Object.create(null),o.contextValue);const i=e=>{const r=t.grafast?.context;if("function"==typeof r){const t=r(n,e);return(0,s.isPromiseLike)(t)?t.then((t=>(Object.assign(e.contextValue,t),e))):(Object.assign(e.contextValue,t),e)}return"object"==typeof r&&null!==r?(Object.assign(e.contextValue,r),e):e};if(t!==r.NULL_PRESET&&t.plugins&&t.plugins.length>0){const e={args:o,ctx:n,resolvedPreset:t},a=(0,r.hook)(t,"args",e);return(0,s.isPromiseLike)(a)?a.then((()=>i(e.args))):i(e.args)}return i(o)}},48282:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.strictEqual=t.ok=void 0,t.ok=function(e,t){if(!e)throw new Error(t)},t.strictEqual=function(e,t,n){if(e!==t)throw new Error(n+` (${e} !== ${t})`)}},94932:(e,t,n)=>{"use strict";let r;Object.defineProperty(t,"__esModule",{value:!0}),t.hook=t.withHooks=t.withGraphileConfig=t.NULL_PRESET=void 0,t.NULL_PRESET=Object.freeze(Object.create(null));let a=!1;function s(e){return void 0===r&&(r=new Promise(((e,t)=>{try{e(n(71678))}catch(r){if("ERR_REQUIRE_ESM"===r.code)return Promise.resolve().then(n.bind(n,71678)).then(e,t);t(r)}})).then((e=>(r=e,a=!0,e)),(()=>(r=null,a=!0,null)))),a?e(r):r.then(e)}t.withGraphileConfig=s;const o=Symbol("skipHooks"),i=Symbol("grafastHooks");function l(e,t){const n=e[i];if(void 0!==n)return t(n);if(!e.plugins||0===e.plugins.length)return e[i]=null,t(null);const r=e.plugins;return s((n=>{if(null!==n){const a=new n.AsyncHooks;return n.applyHooks(r,(e=>e.grafast?.hooks),((e,t,n)=>{a.hook(e,t)})),e[i]=a,t(a)}return e[i]=null,t(null)}))}t.withHooks=l,t.hook=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(!e[o]?.[t])return l(e,(n=>null!==n&&void 0!==n.callbacks[t]?n.process(t,...r):(e[o]||(e[o]=Object.create(null)),void(e[o][t]=!0))))}},38456:(e,t)=>{"use strict";function n(e,t){const n=function(e,t){let n=e;for(let e=0,r=t.length;e<r;e++){const r=t[e];if("number"==typeof r!==Array.isArray(n))return;if(null==n)return;if(n=n[r],void 0===n)return}return n}(t,e.path);switch(e.type){case"length":return Array.isArray(n)&&n.length===e.expectedLength;case"exists":return void 0!==n===e.exists;case"equal":return n===e.expectedValue===e.pass;case"value":return n===e.value;case"isEmpty":return("object"==typeof n&&null!==n&&0===Object.keys(n).length)===e.isEmpty;default:throw new Error(`Unsupported constraint type '${e.type}'`)}}Object.defineProperty(t,"__esModule",{value:!0}),t.matchesConstraints=void 0,t.matchesConstraints=function(e,t){for(let r=0,a=e.length;r<a;r++){if(!n(e[r],t))return!1}return!0}},47655:(e,t)=>{"use strict";function n(){}Object.defineProperty(t,"__esModule",{value:!0}),t.defer=void 0,t.defer=function(){let e,t;const r=new Promise(((n,r)=>{e=n,t=r}));return r.resolve=e,r.reject=t,r.then(null,n),r}},79554:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.noop=t.isTest=t.isDev=void 0;const n="undefined"!=typeof process?process.env.GRAPHILE_ENV:void 0,r="undefined"!=typeof process?"production":void 0,a=void 0!==n?n:r;t.isDev="development"===a||"test"===a,t.isTest="test"===a,t.noop=function(){},"undefined"!=typeof process&&void 0===n&&void 0===r?console.warn("The GRAPHILE_ENV environmental variable is not set; Grafast will run in production mode. In your development environments, it's recommended that you set `GRAPHILE_ENV=development` to opt in to additional checks that will provide guidance and help you to catch issues in your code earlier, and other changes such as formatting to improve your development experience."):t.isDev&&!t.isTest&&console.warn(`Grafast is running in development mode due to \`${void 0!==n?`GRAPHILE_ENV=${n}`:`NODE_ENV=${r}`}\`; this is recommended for development environments (and strongly discouraged in production), but will impact on performance - in particular, planning will be significantly more expensive.`)},88784:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LayerPlan=t.isPolymorphicLayerPlan=t.isDeferredLayerPlan=t.isBranchingLayerPlan=void 0;const r=n(22970),a=r.__importDefault(n(53870)),s=r.__importDefault(n(73177)),o=r.__importStar(n(48282)),i=n(4730),l=n(40354),c=n(68415),u=n(61258);function p(e){const t=e.reason.type;return"stream"===t||"subscription"===t||"mutationField"===t||"defer"===t}t.isBranchingLayerPlan=function(e){return"polymorphic"===e.reason.type},t.isDeferredLayerPlan=p,t.isPolymorphicLayerPlan=function(e){return"polymorphic"===e.reason.type};t.LayerPlan=class LayerPlan{constructor(e,t,n){this.operationPlan=e,this.parentLayerPlan=t,this.reason=n,this.rootStep=null,this.copyStepIds=[],this.children=[],this.steps=[],this.pendingSteps=[],this.phases=[],this.stepsByConstructor=new Map,null!==t?(this.depth=t.depth+1,this.ancestry=[...t.ancestry,this],p(this)?this.deferBoundaryDepth=this.depth:this.deferBoundaryDepth=t.deferBoundaryDepth):(this.depth=0,this.ancestry=[this],this.deferBoundaryDepth=0),this.id=e.addLayerPlan(this),t?(o.ok("root"!=n.type,"Non-root LayerPlan must have a parentStep"),t.children.push(this)):o.strictEqual(this.id,0,"All but the first LayerPlan must have a parent")}toString(){let e="",t=this;for(;t=t.parentLayerPlan;)e+=`∈${t.id}`;const n="polymorphic"===this.reason.type?`{${this.reason.typeNames.join(",")}}`:"",r=this.copyStepIds.length>0?`/${this.copyStepIds}`:"";return`LayerPlan<${this.id}${e}?${this.reason.type}${n}!${this.rootStep?.id??"x"}${r}>`}print(e){void 0===e&&(e=0);const t=[`${" ".repeat(2*e)}${this}`];for(const n of this.children)t.push(n.print(e+1));return t.join("\n")}setRootStep(e){this.operationPlan.stepTracker.setLayerPlanRootStep(this,e)}getStep(e,t){return this.operationPlan.getStep(e,t)}_addStep(e){return this.operationPlan._addStep(e)}_addModifierStep(e){return this.operationPlan._addModifierStep(e)}finalize(){if("listItem"===this.reason.type){const e=this.copyStepIds.length;!function(e,t,n,r){const a=d.get(e);if(void 0!==a)return r(a);const o=f.get(e);if(void 0!==o)return void o.push(r);const i=[r];f.set(e,i);const l=function(e,t,n){if("nullableBoundary"===n){if(Math.random()<2)throw new Error("This code no longer works since we added unary steps.");const r=[],a=[];for(let e=0;e<t;e++){const t=s.default.identifier(`source${e}`),n=s.default.identifier(`target${e}`),o=s.default.lit(e);r.push(s.default`\
  const ${t} = parentBucket.store.get(copyStepIds[${o}]);
  const ${n} = ${t}.isBatch ? ${g}([]) : ${t};
  store.set(copyStepIds[${o}], ${n});
`),a.push(s.default`\
      if(${n}.isBatch) {
        ${n}.entries[newIndex] = ${t}.at(originalIndex);
      }
`)}return S(e,n,s.default`\
  const itemStepId = this.rootStep.id;
  const nullableStepStore = parentBucket.store.get(itemStepId);

  const itemStepIdList = [];
  store.set(itemStepId, ${g}(itemStepIdList));

  // Prepare store with an empty list for each copyPlanId
${s.default.join(r,"")}

  // We'll typically be creating fewer nullableBoundary bucket entries
  // than we have parent bucket entries (because we exclude nulls), so
  // we must "multiply up" (down) the store entries.
  for (
    let originalIndex = 0;
    originalIndex < parentBucket.size;
    originalIndex++
  ) {
    const fieldValue = nullableStepStore.at(originalIndex);
    if (fieldValue != null) {
      const newIndex = size++;
      map.set(originalIndex, newIndex);
      itemStepIdList[newIndex] = fieldValue;

      polymorphicPathList[newIndex] = parentBucket.polymorphicPathList[originalIndex];
      iterators[newIndex] = parentBucket.iterators[originalIndex];
${s.default.join(a,"")}
    }
  }
`)}if("listItem"===n){const r=[],a=[];for(let e=0;e<t;e++){const t=s.default.identifier(`source${e}`),n=s.default.identifier(`target${e}`),o=s.default.lit(e);r.push(s.default`\
  const ${t} = parentBucket.store.get(copyStepIds[${o}]);
  const ${n} = ${t}.isBatch ? ${g}([]) : ${t};
  store.set(copyStepIds[${o}], ${n});
  `),a.push(s.default`\
        if (${n}.isBatch) {
          ${n}.entries[newIndex] = ${t}.at(originalIndex);
        }
        `)}return S(e,n,s.default`\
  const listStepId = this.reason.parentStep.id;
  const listStepStore = parentBucket.store.get(listStepId);

  const itemStepIdList = [];
  store.set(this.rootStep.id, ${g}(itemStepIdList));

  // Prepare store with an empty list for each copyPlanId
  ${s.default.join(r,"")}

  // We'll typically be creating more listItem bucket entries than we
  // have parent buckets, so we must "multiply up" the store entries.
  for (
    let originalIndex = 0;
    originalIndex < parentBucket.size;
    originalIndex++
  ) {
    const list = listStepStore.at(originalIndex);
    if (Array.isArray(list)) {
      const newIndexes = [];
      map.set(originalIndex, newIndexes);
      for (let j = 0, l = list.length; j < l; j++) {
        const newIndex = size++;
        newIndexes.push(newIndex);
        itemStepIdList[newIndex] = list[j];

        polymorphicPathList[newIndex] = parentBucket.polymorphicPathList[originalIndex];
        iterators[newIndex] = parentBucket.iterators[originalIndex];
        ${s.default.join(a,"")}
      }
    }
  }

`)}return n}(e,t,n),c=s.default`\
function ${s.default.identifier(`layerPlanNewBucketFactory_${e}`)}(copyStepIds) {
  return ${l};
}`;s.default.runInBatch(c,(t=>{d.set(e,t),f.delete(e);for(const e of i)e(t)}))}(`${this.reason.type[0]}_${e}`,e,this.reason.type,(e=>{this.newBucket=e(this.copyStepIds)}))}}newBucket(e){const{copyStepIds:t}=this,n=new Map,r="mutationField"===this.reason.type?e.polymorphicPathList:[],a="mutationField"===this.reason.type?e.iterators:[],s=new Map;let o=0;switch(this.reason.type){case"nullableBoundary":{if(null==this.rootStep)throw new Error("GrafastInternalError<f8136364-46c7-4886-b2ae-51319826f97d>: nullableStepStore layer plan has no rootStepId");const i=this.rootStep.id,c=!1;if(this.rootStep._isUnary){const c=e.store.get(i);if(c._entryFlags&l.FORBIDDEN_BY_NULLABLE_BOUNDARY_FLAGS)o=0;else{o=e.size,n.set(i,c);for(const r of t)n.set(r,e.store.get(r));for(let t=0;t<o;t++)s.set(t,t),r[t]=e.polymorphicPathList[t],a[t]=e.iterators[t]}}else if(c){const l=e.store.get(i);if(!l)throw new Error(`GrafastInternalError<017dc8bf-1db1-4983-a41e-e69c6652e4c7>: could not find entry '${i}' (${e.layerPlan.operationPlan.dangerouslyGetStep(i)}) in store for ${e.layerPlan}`);n.set(i,l);for(const r of t)n.set(r,e.store.get(r));for(let t=0;t<e.size;t++){const n=o++;s.set(t,n),r[n]=e.polymorphicPathList[t],a[n]=e.iterators[t]}}else{const l=[];n.set(i,(0,u.batchExecutionValue)(l));for(const r of t){const t=e.store.get(r);t.isBatch?n.set(r,(0,u.batchExecutionValue)([])):n.set(r,t)}const c=e.store.get(i);if(!c)throw new Error(`GrafastInternalError<017dc8bf-1db1-4983-a41e-e69c6652e4c7>: could not find entry '${i}' (${e.layerPlan.operationPlan.dangerouslyGetStep(i)}) in store for ${e.layerPlan}`);for(let i=0;i<e.size;i++){const u=c.at(i);if(null!=u){const c=o++;s.set(i,c),l[c]=u,r[c]=e.polymorphicPathList[i],a[c]=e.iterators[i];for(const r of t){const t=n.get(r);if(t.isBatch){const n=e.store.get(r);t._copyResult(c,n,i)}}}}}break}case"listItem":{const i=this.reason.parentStep.id,l=e.store.get(i);if(!l)throw new Error(`GrafastInternalError<314865b0-f7e8-4e81-b966-56e5a0de562e>: could not find entry '${i}' (${e.layerPlan.operationPlan.dangerouslyGetStep(i)}) in store for layerPlan ${e.layerPlan}`);if(null==this.rootStep)throw new Error("GrafastInternalError<b3a2bff9-15c6-47e2-aa82-19c862324f1a>: listItem layer plan has no rootStepId");const c=this.rootStep.id,p=this.rootStep._isUnary?null:[];if(this.rootStep._isUnary){const e=l.at(0);n.set(c,(0,u.unaryExecutionValue)(Array.isArray(e)?e[0]:e))}else n.set(c,(0,u.batchExecutionValue)(p));for(const r of t){const t=e.store.get(r);t.isBatch?n.set(r,(0,u.batchExecutionValue)([])):n.set(r,t)}for(let i=0;i<e.size;i++){const c=l.at(i);if(Array.isArray(c)){const l=[];s.set(i,l);for(let s=0,u=c.length;s<u;s++){const u=o++;l.push(u),null!==p&&(p[u]=c[s]),r[u]=e.polymorphicPathList[i],a[u]=e.iterators[i];for(const r of t){const t=n.get(r);if(t.isBatch){const n=e.store.get(r);t._copyResult(u,n,i)}}}}}break}case"mutationField":o=e.size;for(let t=0;t<e.size;t++)s.set(t,t);for(const r of t)n.set(r,e.store.get(r));break;case"polymorphic":{const i=this.reason.parentStep.id,p=e.store.get(i);if(!p)throw new Error(`GrafastInternalError<af1417c6-752b-466e-af7e-cfc35724c3bc>: Entry for '${e.layerPlan.operationPlan.dangerouslyGetStep(i)}' not found in bucket for '${e.layerPlan}'`);const d=this.reason.typeNames;for(const r of t){const t=e.store.get(r);if(!t)throw new Error(`GrafastInternalError<548f0d84-4556-4189-8655-fb16aa3345a6>: new bucket for ${this} wants to copy ${this.operationPlan.dangerouslyGetStep(r)}, but bucket for ${e.layerPlan} doesn't contain that plan`);t.isBatch?n.set(r,(0,u.batchExecutionValue)([])):n.set(r,t)}for(let i=0;i<e.size;i++){if(p._flagsAt(i)&(l.FLAG_ERROR|l.FLAG_INHIBITED|l.FLAG_NULL))continue;const u=p.at(i),f=(0,c.resolveType)(u);if(!d.includes(f))continue;const h=o++;s.set(i,h);const y=(e.polymorphicPathList[i]??"")+">"+f;r[h]=y,a[h]=e.iterators[i];for(const r of t){const t=n.get(r);if(t.isBatch){const n=e.store.get(r);t._copyResult(h,n,i)}}}break}case"subscription":case"defer":throw new Error("TODO");case"subroutine":throw new Error("Subroutines are experimental and must currently handle their own bucket creation");case"root":throw new Error("GrafastInternalError<05fb7069-81b5-43f7-ae71-f62547d2c2b7>: root cannot be not the root (...)");default:{const e=this.reason;throw new Error(`GrafastInternalError<8162e6c2-3d66-4d67-ba03-5310a4f9a6d4>: unhandled reason '${(0,i.inspect)(e)}'`)}}if(o>0){const t=(0,u.newBucket)({layerPlan:this,size:o,store:n,flagUnion:e.flagUnion,polymorphicPathList:r,iterators:a},e.metaByMetaKey);return e.children[this.id]={bucket:t,map:s},t}return null}};const d=new a.default({maxLength:1e3}),f=new Map,h=s.default`parentBucket.polymorphicPathList`,y=s.default`parentBucket.iterators`,b=s.default`[]`,m=s.default.ref(u.newBucket,"newBucket"),g=s.default.ref(u.batchExecutionValue,"batchExecutionValue");function S(e,t,n){return s.default`\
(function ${s.default.identifier(`newBucket_${e}`)}(parentBucket) {
  const store = new Map();
  const polymorphicPathList = ${"mutationField"===t?h:b};
  const iterators = ${"mutationField"===t?y:b};
  const map = new Map();
  let size = 0;

${n}

  if (size > 0) {
    // Reference
    const childBucket = ${m}({
      layerPlan: this,
      size,
      store,
      // PERF: not necessarily, if we don't copy the errors, we don't have the errors.
      flagUnion: parentBucket.flagUnion,
      polymorphicPathList,
      iterators,
    }, parentBucket.metaByMetaKey);
    // PERF: set ourselves in more places so that we never have to call 'getChildBucketAndIndex'.
    parentBucket.children[this.id] = { bucket: childBucket, map };

    return childBucket;
  } else {
    return null;
  }
})`}},54173:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OperationPlan=t.POLYMORPHIC_ROOT_PATHS=t.POLYMORPHIC_ROOT_PATH=void 0;const r=n(22970),a=r.__importDefault(n(53870)),s=r.__importStar(n(45290)),o=r.__importDefault(n(73177)),i=r.__importStar(n(48282)),l=n(89159),c=n(46534),u=n(46510),p=n(63881),d=n(4730),f=n(40354),h=n(86780),y=n(28326),b=n(60351),m=n(20353),g=n(26446),S=n(62408),P=n(22722),v=n(88784),w=n(35616),O=n(44026),$=n(38769),E=n(71476),_="undefined"!=typeof process&&process.env.ALWAYS_THROW_PLANNING_ERRORS,x="1"===_,I="2"===_;function L(e){return e instanceof u.__ItemStep||e instanceof u.__ValueStep}if(_&&"0"!==_&&!x&&!I)throw new Error(`Invalid value for envvar 'ALWAYS_THROW_PLANNING_ERRORS' - expected '1' or '2', but received '${_}'`);const{assertObjectType:k,defaultFieldResolver:j,getNamedType:A,getNullableType:T,isEnumType:R,isInterfaceType:N,isListType:D,isNonNullType:B,isObjectType:C,isScalarType:F,isUnionType:G}=s;let M=5;const V=Object.freeze([]);t.POLYMORPHIC_ROOT_PATH=null,t.POLYMORPHIC_ROOT_PATHS=null,Object.freeze(t.POLYMORPHIC_ROOT_PATHS);const z=Object.freeze({type:"root"}),U=Object.freeze({mode:"null"}),H=Object.freeze({mode:"array"}),q=()=>new u.__ValueStep,Q={get(){throw new Error("This field doesn't have any arguments")}};function W(e){return t=>"function"==typeof t.get?t.get(e):(0,b.access)(t,[e])}t.OperationPlan=class OperationPlan{constructor(e,n,r,a,s,l,c){this.schema=e,this.operation=n,this.fragments=r,this.variableValues=a,this.context=s,this.rootValue=l,this.planningTimeout=c,this.phase="init",this.loc=u.isDev?[]:null,this.modifierStepCount=0,this.modifierDepthCount=0,this.modifierSteps=[],this.stepTracker=new E.StepTracker(this),this.maxDeduplicatedStepId=-1,this.maxValidatedStepId=-1,this.variableValuesConstraints=[],this.contextConstraints=[],this.rootValueConstraints=[],this.itemStepIdByListStepId=Object.create(null),this.pure=!0,this.startTime=S.timeSource.now(),this.previousLap=this.startTime,this.laps=[],this.optimizeMeta=new Map,this.getStep=u.isDev?(e,t)=>{if(!["plan","validate","optimize"].includes(this.phase))throw new Error(`Getting a step during the '${this.phase}' phase is forbidden - please do so before or during the optimize phase.`);if(t.isOptimized&&("optimize"!==this.phase||!t.allowMultipleOptimizations))throw new Error(`Optimized step ${t} is not permitted to request other steps (requested '${e}')`);const n=this.stepTracker.getStepById(e);if(null==n)throw new Error(`Programming error: step with id '${e}' no longer exists (attempted access from ${t}). Most likely this means that ${t} has an illegal reference to this step, you should only maintain references to steps via dependencies.`);return n[f.$$proxy]??n}:(e,t)=>{const n=this.stepTracker.getStepById(e);return n[f.$$proxy]??n},this.polymorphicLayerPlanByPathByLayerPlan=new Map,this.scalarPlanInfo={schema:this.schema};const p=e.getQueryType();i.ok(p,"Schema must have a query type"),this.queryType=p,this.mutationType=e.getMutationType()??null,this.subscriptionType=e.getSubscriptionType()??null;const d=Object.values(e.getTypeMap()),h=[],y=[];this.unionsContainingObjectType=Object.create(null);for(const e of d)if(G(e)){h.push(e);const t=e.getTypes();for(const n of t)this.unionsContainingObjectType[n.name]?this.unionsContainingObjectType[n.name].push(e):this.unionsContainingObjectType[n.name]=[e]}else C(e)&&(y.push(e),this.unionsContainingObjectType[e.name]||(this.unionsContainingObjectType[e.name]=[]));this.operationType=n.operation,this.phase="plan",this.rootLayerPlan=new v.LayerPlan(this,null,z);const b=(0,w.withGlobalLayerPlan)(this.rootLayerPlan,t.POLYMORPHIC_ROOT_PATHS,q);this.rootLayerPlan.setRootStep(b),[this.variableValuesStep,this.trackedVariableValuesStep]=this.track(a,this.variableValuesConstraints,this.operation.variableDefinitions),[this.contextStep,this.trackedContextStep]=this.track(s,this.contextConstraints),[this.rootValueStep,this.trackedRootValueStep]=this.track(l,this.rootValueConstraints),this.deduplicateSteps(),this.lap("init"),this.planOperation(),this.checkTimeout(),this.lap("planOperation"),this.hoistSteps(),this.checkTimeout(),this.lap("hoistSteps","planOperation"),u.isDev&&(this.phase="validate",this.validateSteps(),this.lap("validateSteps")),this.phase="optimize",this.stepTracker.treeShakeSteps(),this.checkTimeout(),this.lap("treeShakeSteps","optimize"),o.default.batch((()=>{this.optimizeSteps()})),this.checkTimeout(),this.lap("optimizeSteps"),this.inlineSteps(),this.checkTimeout(),this.lap("inlineSteps"),this.phase="finalize",this.stepTracker.finalizeSteps(),this.stepTracker.treeShakeSteps(),this.checkTimeout(),this.lap("treeShakeSteps","finalize"),this.pushDownSteps(),this.checkTimeout(),this.lap("pushDownSteps"),o.default.batch((()=>{this.finalizeSteps()})),this.lap("finalizeSteps"),o.default.batch((()=>{this.optimizeOutputPlans()})),this.checkTimeout(),this.lap("optimizeOutputPlans"),this.stepTracker.treeShakeSteps(),this.checkTimeout(),this.lap("treeShakeSteps","optimizeOutputPlans"),this.stepTracker.finalizeOutputPlans(),o.default.batch((()=>{this.finalizeLayerPlans()})),this.lap("finalizeLayerPlans"),o.default.batch((()=>{this.finalizeOutputPlans()})),this.lap("finalizeOutputPlans"),this.phase="ready";const m=new Set;for(const e of this.stepTracker.activeSteps)void 0!==e.metaKey&&m.add(e.metaKey);const g=[...m];this.makeMetaByMetaKey=function(e){const t=e.length;if(0===t)return J;if(1===t)return n=e[0],function(){const e=Object.create(null);return e[n]=Object.create(null),e};if(2===t)return function(e,t){return function(){const n=Object.create(null);return n[e]=Object.create(null),n[t]=Object.create(null),n}}(e[0],e[1]);if(3===t)return function(e,t,n){return function(){const r=Object.create(null);return r[e]=Object.create(null),r[t]=Object.create(null),r[n]=Object.create(null),r}}(e[0],e[1],e[2]);if(4===t)return function(e,t,n,r){return function(){const a=Object.create(null);return a[e]=Object.create(null),a[t]=Object.create(null),a[n]=Object.create(null),a[r]=Object.create(null),a}}(e[0],e[1],e[2],e[3]);if(5===t)return function(e,t,n,r,a){return function(){const s=Object.create(null);return s[e]=Object.create(null),s[t]=Object.create(null),s[n]=Object.create(null),s[r]=Object.create(null),s[a]=Object.create(null),s}}(e[0],e[1],e[2],e[3],e[4]);if(6===t)return function(e,t,n,r,a,s){return function(){const o=Object.create(null);return o[e]=Object.create(null),o[t]=Object.create(null),o[n]=Object.create(null),o[r]=Object.create(null),o[a]=Object.create(null),o[s]=Object.create(null),o}}(e[0],e[1],e[2],e[3],e[4],e[5]);var n;return function(){const n=Object.create(null);for(let r=0;r<t;r++)n[e[r]]=Object.create(null);return n}}(g),this.lap("ready");const P=S.timeSource.now()-this.startTime;this.optimizeMeta=null,s?.grafastMetricsEmitter?.emit("plan",{elapsed:P,laps:this.laps}),M>1&&(M=Math.max(1,M-.5))}lap(e,t){const n=S.timeSource.now(),r=n-this.previousLap;this.previousLap=n,this.laps.push({category:e,subcategory:t,elapsed:r})}checkTimeout(){if(null===this.planningTimeout)return;const e=S.timeSource.now();if(e-this.startTime>this.planningTimeout*M)throw new u.SafeError("Operation took too long to plan and was aborted. Please simplify the request and try again.",{[f.$$timeout]:this.planningTimeout,[f.$$ts]:e})}addLayerPlan(e){return this.stepTracker.addLayerPlan(e)}_addStep(e){if(!["plan","validate","optimize"].includes(this.phase))throw new Error(`Creating a plan during the '${this.phase}' phase is forbidden.`);return this.stepTracker.addStep(e)}_addModifierStep(e){if(!["plan","validate","optimize"].includes(this.phase))throw new Error(`Creating a step during the '${this.phase}' phase is forbidden.`);const t=`${this.modifierDepthCount}-${this.modifierStepCount++}`;return this.modifierSteps.push(e),t}dangerouslyGetStep(e){return this.stepTracker.getStepById(e)}planOperation(){try{switch(this.operationType){case"query":this.planQuery();break;case"mutation":this.planMutation();break;case"subscription":this.planSubscription();break;default:{const e=this.operationType;throw new u.SafeError(`Unsupported operation type '${e}'.`)}}}catch(e){throw null!=this.loc?console.error(`Error occurred during query planning (at ${this.loc.join(" > ")}): \n${e.stack||e}`):console.error(`Error occurred during query planning: \n${e.stack||e}`),new Error(`Query planning error: ${e.message}`,{cause:e})}}planQuery(){null!==this.loc&&this.loc.push("planQuery()");const e=this.queryType;if(!e)throw new u.SafeError("No query type found in schema");const n={node:this.operation.selectionSet.selections,parentTypeName:null,fieldName:null},r=new $.OutputPlan(this.rootLayerPlan,this.rootValueStep,{mode:"root",typeName:this.queryType.name},n);this.rootOutputPlan=r,this.planSelectionSet(r,[],t.POLYMORPHIC_ROOT_PATH,t.POLYMORPHIC_ROOT_PATHS,this.trackedRootValueStep,e,this.operation.selectionSet.selections),null!==this.loc&&this.loc.pop()}planMutation(){null!==this.loc&&this.loc.push("planMutation()");const e=this.mutationType;if(!e)throw new u.SafeError("No mutation type found in schema");this.deduplicateSteps();const n={node:this.operation.selectionSet.selections,parentTypeName:null,fieldName:null},r=new $.OutputPlan(this.rootLayerPlan,this.rootValueStep,{mode:"root",typeName:e.name},n);this.rootOutputPlan=r,this.planSelectionSet(r,[],t.POLYMORPHIC_ROOT_PATH,t.POLYMORPHIC_ROOT_PATHS,this.trackedRootValueStep,e,this.operation.selectionSet.selections,!0),null!==this.loc&&this.loc.pop()}planSubscription(){null!==this.loc&&this.loc.push("planSubscription");const e=this.subscriptionType;if(!e)throw new u.SafeError("No subscription type found in schema");const n=this.operation.selectionSet,r=(0,w.withGlobalLayerPlan)(this.rootLayerPlan,t.POLYMORPHIC_ROOT_PATHS,l.graphqlCollectFields,null,this,this.trackedRootValueStep.id,e,n.selections);if(void 0!==r.deferred)throw new u.SafeError("@defer forbidden on subscription root selection set");let a;for(const e of r.fields.keys()){if(void 0!==a)throw new u.SafeError("subscriptions may only have one top-level field");a=e}i.ok(null!=a,"selection set cannot be empty");const s=r.fields.get(a);if(!s)throw new u.SafeError("Consistency error.");const o=s[0],c=o.name.value,p=e.getFields()[c],d=p.extensions?.grafast?.subscribePlan,f=[o.alias?.value??c],h={parentTypeName:e.name,fieldName:c,node:this.operation.selectionSet.selections},y=d,b=p.args,m=b.length>0?(0,w.withGlobalLayerPlan)(this.rootLayerPlan,t.POLYMORPHIC_ROOT_PATHS,this.getTrackedArguments,this,b,o):Q;if(void 0!==y){const{haltTree:r,step:a}=this.planField(this.rootLayerPlan,f,t.POLYMORPHIC_ROOT_PATHS,s,y,"autoApplyAfterParentSubscribePlan",this.trackedRootValueStep,p,m);if(r)throw new u.SafeError("Failed to setup subscription");const o={stream:{initialCount:0}};a._stepOptions=o,this.rootLayerPlan.setRootStep(a);const i=new v.LayerPlan(this,this.rootLayerPlan,{type:"subscription"}),l=(0,w.withGlobalLayerPlan)(i,t.POLYMORPHIC_ROOT_PATHS,(()=>new u.__ItemStep(a)));i.setRootStep(l);let c=(0,P.hasItemPlan)(a)?(0,w.withGlobalLayerPlan)(i,t.POLYMORPHIC_ROOT_PATHS,a.itemPlan,a,l):l;this.deduplicateSteps(),c=this.stepTracker.getStepById(c.id);const d=new $.OutputPlan(i,this.rootValueStep,{mode:"root",typeName:e.name},h);this.rootOutputPlan=d,this.planSelectionSet(d,[],t.POLYMORPHIC_ROOT_PATH,t.POLYMORPHIC_ROOT_PATHS,c,e,n.selections)}else{const r=(0,w.withGlobalLayerPlan)(this.rootLayerPlan,t.POLYMORPHIC_ROOT_PATHS,(()=>{const e=(0,u.object)(o.arguments?.reduce(((e,t)=>(e[t.name.value]=m.get(t.name.value),e)),Object.create(null))??Object.create(null)),t=p.resolve,n=p.subscribe;return(0,g.graphqlResolver)(t,n,this.trackedRootValueStep,e,{fieldName:c,fieldNodes:s,fragments:this.fragments,operation:this.operation,parentType:this.subscriptionType,returnType:p.type,schema:this.schema,path:{typename:this.subscriptionType.name,key:c,prev:void 0}})})),a={stream:{initialCount:0}};r._stepOptions=a,this.rootLayerPlan.setRootStep(r);const i=new v.LayerPlan(this,this.rootLayerPlan,{type:"subscription"}),l=(0,w.withGlobalLayerPlan)(i,t.POLYMORPHIC_ROOT_PATHS,(()=>new u.__ItemStep(r)));i.setRootStep(l);let d=(0,P.hasItemPlan)(r)?(0,w.withGlobalLayerPlan)(i,t.POLYMORPHIC_ROOT_PATHS,r.itemPlan,r,l):l;this.deduplicateSteps(),d=this.stepTracker.getStepById(d.id);const f=new $.OutputPlan(i,this.rootValueStep,{mode:"root",typeName:e.name},h);this.rootOutputPlan=f,this.planSelectionSet(f,[],t.POLYMORPHIC_ROOT_PATH,t.POLYMORPHIC_ROOT_PATHS,d,e,n.selections)}null!==this.loc&&this.loc.pop()}itemStepForListStep(e,t,n){void 0===n&&(n=0);const r=this.itemStepIdByListStepId[t.id];if(void 0!==r)return this.stepTracker.getStepById(r);const a=new v.LayerPlan(this,e,{type:"listItem",parentStep:t,stream:t._stepOptions.stream??void 0}),s=(0,w.withGlobalLayerPlan)(a,t.polymorphicPaths,(()=>new u.__ItemStep(t,n)));return a.setRootStep(s),this.itemStepIdByListStepId[t.id]=s.id,s}processGroupedFieldSet(e,n,r,s,o,l,c,p,d){let f=-1;for(const[h,y]of d.fields.entries()){const d=y[0],b=d.name.value,m={parentTypeName:l.name,fieldName:b,node:y};if("__typename"===b){e.addChild(l,h,{type:"__typename",locationDetails:m});continue}if("__schema"===b||"__type"===b){const t=(0,P.findVariableNamesUsed)(this,d);e.addChild(l,h,{type:"outputPlan",isNonNull:"__schema"===b,outputPlan:new $.OutputPlan(e.layerPlan,this.rootValueStep,{mode:"introspection",field:d,variableNames:t,introspectionCacheByVariableValues:new a.default({maxLength:3})},m),locationDetails:m});continue}const S=c[b];if(!S)continue;const O=S.type,E=S.extensions?.grafast?.plan;if("AsyncFunction"===E?.constructor?.name)throw new Error(`Plans must be synchronous, but this schema has an async function at '${l.name}.${b}.plan': ${E.toString()}`);const _=A(O),x=S.resolve,I=S.subscribe,L=null==x||x===j,k=L?null:x,T=E??(L?W(b):void 0);null!==k&&(this.pure=!1);const R=(0,P.isTypePlanned)(this.schema,_);if(R&&!!!T&&!l.extensions?.grafast?.assertStep)throw new Error(`Field ${l.name}.${b} returns a ${_.name} which expects a plan to be available; however this field has no plan() method to produce such a plan; please add 'extensions.grafast.plan' to this field.`);if(R&&k)throw new Error(`Field ${l.name}.${b} returns a ${_.name} which expects a plan to be available; this means that ${l.name}.${b} is forbidden from defining a GraphQL resolver.`);let N,D=!1;const C=p?new v.LayerPlan(this,e.layerPlan,{type:"mutationField",mutationIndex:++f}):e.layerPlan,F=S.args,G=F.length>0?(0,w.withGlobalLayerPlan)(this.rootLayerPlan,t.POLYMORPHIC_ROOT_PATHS,this.getTrackedArguments,this,F,d):Q,M=[...n,h];if("function"==typeof T?({step:N,haltTree:D}=this.planField(C,M,s,y,T,"autoApplyAfterParentPlan",o,S,G)):(i.ok(null!==k,"GraphileInternalError<81652257-617a-4d1a-8306-903d0e3d2ddf>: The field has no resolver, so planResolver should exist (either as the field.plan or as the default plan resolver)."),N=o),null!==k&&(N=(0,w.withGlobalLayerPlan)(C,s,(()=>{const e=(0,u.object)(d.arguments?.reduce(((e,t)=>(e[t.name.value]=G.get(t.name.value),e)),Object.create(null))??Object.create(null));return(0,g.graphqlResolver)(k,I,N,e,{fieldName:b,fieldNodes:y,fragments:this.fragments,operation:this.operation,parentType:l,returnType:O,schema:this.schema})}))),N=this.stepTracker.getStepById(N.id),D){const t=B(O);e.addChild(l,h,{type:"outputPlan",outputPlan:new $.OutputPlan(C,N,U,m),isNonNull:t,locationDetails:m})}else this.planIntoOutputPlan(e,C,M,r,s,null!=d.selectionSet?y.flatMap((e=>e.selectionSet.selections)):void 0,l,h,O,N,m)}if(void 0!==d.deferred)for(const t of d.deferred){const a=new v.LayerPlan(this,e.layerPlan,{type:"defer",label:t.label}),i=new $.OutputPlan(a,e.rootStep,{mode:"object",deferLabel:t.label,typeName:l.name},e.locationDetails);e.deferredOutputPlans.push(i),this.processGroupedFieldSet(i,n,r,s,o,l,c,p,t)}}planSelectionSet(e,t,n,r,a,s,o,i){void 0===i&&(i=!1),null!==this.loc&&this.loc.push(`planSelectionSet(${s.name} @ ${e.layerPlan.id} @ ${t.join(".")} @ ${n??""})`),u.isDev&&k(s);const c=(0,w.withGlobalLayerPlan)(e.layerPlan,r,l.graphqlCollectFields,null,this,a.id,s,o,i),p=s.getFields();this.processGroupedFieldSet(e,t,n,r,a,s,p,i,c),null!==this.loc&&this.loc.pop()}planIntoOutputPlan(e,t,n,r,a,s,o,l,p,d,f,h){void 0===h&&(h=0);const b=T(p),m=b!==p;if(D(b)){const i=new $.OutputPlan(t,d,H,f);e.addChild(o,l,{type:"outputPlan",outputPlan:i,isNonNull:m,locationDetails:f});const c=this.itemStepForListStep(t,d,h),u=(0,y.isListCapableStep)(d)?(0,w.withGlobalLayerPlan)(c.layerPlan,c.polymorphicPaths,d.listItem,d,c):c;this.planIntoOutputPlan(i,u.layerPlan,n,r,a,s,null,null,b.ofType,u,f,h+1)}else if(F(b)){const n=b.extensions?.grafast?.plan;if("AsyncFunction"===n?.constructor?.name)throw new Error(`Plans must be synchronous, but this schema has an async function at '${b.name}.plan': ${n.toString()}`);const r="function"==typeof n?(0,w.withGlobalLayerPlan)(t,a,n,null,d,this.scalarPlanInfo):d;e.addChild(o,l,{type:"outputPlan",isNonNull:m,outputPlan:new $.OutputPlan(t,r,{mode:"leaf",graphqlType:b},f),locationDetails:f})}else if(R(b))e.addChild(o,l,{type:"outputPlan",isNonNull:m,outputPlan:new $.OutputPlan(t,d,{mode:"leaf",graphqlType:b},f),locationDetails:f});else if(C(b)){if(u.isDev){const e=b.extensions?.grafast?.assertStep;if(null!=e)try{if(e===u.ExecutableStep||e.prototype instanceof u.ExecutableStep){if(!(d instanceof e))throw new Error(`Step mis-match: expected ${e.name}, but instead found ${d.constructor.name} (${d})`)}else e(d)}catch(e){throw new Error(`The step returned by '${n.join(".")}${"[]".repeat(h)}' is not compatible with the GraphQL object type '${b.name}': ${e.message}`,{cause:e})}if(!s)throw new Error("GrafastInternalError<7fe4f7d1-01d2-4f1e-add6-5aa6936938c9>: no selections on a GraphQLObjectType?!")}let i;if(m||"nullableBoundary"===t.reason.type&&t.rootStep===d)i=t;else{const e=t.children.find((e=>"nullableBoundary"===e.reason.type&&e.reason.parentStep===d));void 0!==e?i=e:(i=new v.LayerPlan(this,t,{type:"nullableBoundary",parentStep:d}),i.setRootStep(d))}const c=new $.OutputPlan(i,d,{mode:"object",deferLabel:void 0,typeName:b.name},f);e.addChild(o,l,{type:"outputPlan",outputPlan:c,isNonNull:m,locationDetails:f}),this.planSelectionSet(c,n,r,a,d,b,s)}else{const a=G(b),u=N(b);if(!a&&!u)throw new Error(`GrafastInternalError<a54d6d63-d186-4ab9-9299-05f817894300>: Wasn't expecting ${b}`);i.ok(s,"GrafastInternalError<d94e281c-1a10-463e-b7f5-2b0a3665d99b>: A polymorphic type with no selections is invalid");const p=a?b.getTypes():this.schema.getImplementations(b).objects;if(0===p.length){const n=new $.OutputPlan(t,d,U,f);e.addChild(o,l,{type:"outputPlan",outputPlan:n,isNonNull:m,locationDetails:f})}else{if(!(0,y.isPolymorphicStep)(d))throw new Error(`${d} is not a polymorphic capable step, it must have a planForType method`);const a=new $.OutputPlan(t,d,{mode:"polymorphic",deferLabel:void 0,typeNames:p.map((e=>e.name))},f);e.addChild(o,l,{type:"outputPlan",outputPlan:a,isNonNull:m,locationDetails:f});const i=this.getPolymorphicLayerPlan(t,n,d,p),u=r??"",h=d;for(const e of p){const t=this.stepTracker.getStepById(h.id),r=`${u}>${e.name}`;i.reason.polymorphicPaths.add(r);const o=new Set;o.add(r);const l=(0,w.withGlobalLayerPlan)(i,o,t.planForType,t,e),p=new $.OutputPlan(i,l,{mode:"object",deferLabel:void 0,typeName:e.name},f),d=(0,c.fieldSelectionsForType)(this,e,s);this.planSelectionSet(p,n,r,o,l,e,d,!1),a.addChild(e,null,{type:"outputPlan",isNonNull:m,outputPlan:p,locationDetails:f})}}}}getPolymorphicLayerPlan(e,t,n,r){const a=`${t.join("|")}!${n.id}`,s=this.polymorphicLayerPlanByPathByLayerPlan.get(e)??new Map;0===s.size&&this.polymorphicLayerPlanByPathByLayerPlan.set(e,s);const o=s.get(a);if(void 0!==o){const{stepId:e,layerPlan:t}=o,s=this.stepTracker.getStepById(e),i=this.stepTracker.getStepById(n.id);if(s!==i)throw new Error(`GrafastInternalError<e01bdc40-7c89-41c6-8d84-56efa22c872a>: unexpected inconsistency when determining the polymorphic LayerPlan to use (pathString = ${a}, ${s} (${e}) != ${i} (${n.id}))`);for(const e of r)t.reason.typeNames.includes(e.name)||t.reason.typeNames.push(e.name);return t}{const t=new v.LayerPlan(this,e,{type:"polymorphic",typeNames:r.map((e=>e.name)),parentStep:n,polymorphicPaths:new Set});return s.set(a,{stepId:n.id,layerPlan:t}),t}}planField(e,t,n,r,a,s,o,i,c,p){void 0===p&&(p=!0);const d=this.stepTracker.getStepById(o.id),f=this.stepTracker.stepCount;null!==this.loc&&this.loc.push(`planField(${t.join(".")})`);try{let t=(0,w.withGlobalLayerPlan)(e,n,h.withFieldArgsForArguments,null,this,d,c,i,s,(e=>a(d,e,{field:i,schema:this.schema}))),o=!1;(null===t||t instanceof m.ConstantStep&&t.isNull())&&(t=t||(0,w.withGlobalLayerPlan)(e,n,m.constant,null,null),o=!0),(0,y.assertExecutableStep)(t);const u=r[0].directives?.find((e=>"stream"===e.name.value)),f={stream:!o&&u?{initialCount:Number((0,l.evalDirectiveArg)(r[0],"stream","initialCount",this.trackedVariableValuesStep,null))||0}:null};return t._stepOptions=f,p&&(this.deduplicateSteps(),t=this.stepTracker.getStepById(t.id)),{step:t,haltTree:o}}catch(t){if(x)throw t;if(I)for(let e=f;e<this.stepTracker.stepCount;e++){const n=this.stepTracker.stepById[e];if(n&&n.hasSideEffects)throw t}try{this.stepTracker.purgeBackTo(f)}catch(e){throw console.error(`Cleanup error occurred whilst trying to recover from field planning error: ${e.stack}`),t}const r=(0,w.withGlobalLayerPlan)(e,n,u.error,null,t),a=!0;return this.modifierSteps=[],{step:r,haltTree:a}}finally{null!==this.loc&&this.loc.pop()}}getTrackedArguments(e,t){const n=t.arguments,r=Object.create(null);for(const t of e){const e=t.name;if(u.isDev&&r[e])throw new u.SafeError(`Argument name '${e}' seen twice; aborting.`);const a=t.type,s=t.defaultValue?(0,P.defaultValueToValueNode)(a,t.defaultValue):void 0,o=n?.find((t=>t.name.value===e)),i=(0,p.inputStep)(this,a,o?.value,s);r[e]=i}return{get:e=>r[e]}}withModifiers(e){const t=this.modifierDepthCount++,n=this.modifierStepCount,r=this.modifierSteps.splice(0,this.modifierSteps.length);let a,s;this.modifierStepCount=0;try{a=e()}finally{s=this.modifierSteps.splice(0,this.modifierSteps.length).reverse(),this.modifierStepCount=n;for(const e of r)this.modifierSteps.push(e);this.modifierDepthCount=t}for(let e=0,t=s.length;e<t;e++)s[e].apply();return a}track(e,n,r){const a=(0,w.withGlobalLayerPlan)(this.rootLayerPlan,t.POLYMORPHIC_ROOT_PATHS,q),s=(0,w.withGlobalLayerPlan)(this.rootLayerPlan,t.POLYMORPHIC_ROOT_PATHS,(()=>new u.__TrackedValueStep(e,a,n,[],r)));return[a,s]}validateSteps(e){void 0===e&&(e=0);const t=[];for(const n of this.stepTracker.activeSteps)if(!(n.id<e))for(const e in n){const r=n[e];r instanceof u.ExecutableStep&&t.push(new Error(`ERROR: ExecutableStep ${n} has illegal reference via property '${e}' to step ${r}. You must not reference steps directly, instead add the step as a dependency (\`depId = this.addDependency($step)\`) and use \`this.getDep(depId)\` to look the step up (or, if the step is not a dependency, store the step ID and use \`this.getStep(stepId)\` each time you need to reference it). Failure to comply could result in subtle breakage during optimisation.`))}if(t.length>0)throw console.error(t.map((e=>e.message)).join("\n")),t[0]}replaceStep(e,t){this.stepTracker.replaceStep(e,t)}processStep(e,t,n,r,a,s){if(a.add(s),!this.stepTracker.activeSteps.has(s))return s;if("dependents-first"===t){for(let o=0;o<s.dependents.length;o++){const i=s.dependents[o],{step:l}=i;a.has(l)||(this.processStep(e,t,n,r,a,l),s.dependents[o]!==i&&(o=-1))}const o=s[f.$$subroutine];if(null!==o){const s=o.rootStep;s&&this.processStep(e,t,n,r,a,s)}}else for(const o of(0,P.sudo)(s).dependencies)a.has(o)||this.processStep(e,t,n,r,a,o);if(!this.stepTracker.activeSteps.has(s))return s;let o=s;try{o=(0,w.withGlobalLayerPlan)(s.layerPlan,s.polymorphicPaths,r,this,s)}catch(n){throw console.error(`Error occurred during ${e}; whilst processing ${s} in ${t} mode an error occurred:`,n),n}if(!o)throw new Error(`The callback did not return a step during ${e}`);if(n){if(o!==s)throw new Error("Replacing step in readonly mode is not permitted!")}else o!==s&&this.replaceStep(s,o),this.deduplicateSteps();return o}processSteps(e,t,n,r){u.isDev&&this.stepTracker.lockNewSteps();const a=this.stepTracker.stepCount,s=new Set;for(let o=0;o<this.stepTracker.stepCount;o++){const i=this.stepTracker.getStepById(o,!0);if(!i||i.id!==o||s.has(i))continue;const l=this.processStep(e,t,n,r,s,i);if(u.isDev){const t=this.stepTracker.stepCount-a;if(t>1e5)throw new Error(`Whilst processing steps as part of ${e}Plans, ${t} new steps have been created... That seems like it's likely a bug in the relevant method of one of your steps. The last plan processed was ${l}`)}(n||u.isDev)&&this.stepTracker.stepCount>a&&(n&&Y(this,e,i,a,"Creating steps in isReadonly mode is forbidden"),u.isDev&&this.stepTracker.lockNewSteps())}!n&&"plan"!==this.phase&&this.stepTracker.stepCount>a&&this.validateSteps(a)}getPeers(e){if(e.hasSideEffects)return V;const{dependencies:t,dependencyForbiddenFlags:n,dependencyOnReject:r,layerPlan:a,constructor:s}=(0,P.sudo)(e),o=t.length;if(0===o){let t=null;for(const n of this.stepTracker.stepsWithNoDependencies)n===e||n.hasSideEffects||n.layerPlan!==a||n.constructor!==s||(null===t?t=[n]:t.push(n));return null===t?V:t}if(1===o){const{ancestry:i,deferBoundaryDepth:l}=a,c=t[0];if(1===c.dependents.length)return V;const u=Math.max(l,c.layerPlan.depth);let p=null;for(const{dependencyIndex:t,step:a}of c.dependents){const l=(0,P.sudo)(a),{layerPlan:c,dependencyForbiddenFlags:d,dependencyOnReject:f}=l;l!==e&&0===t&&!l.hasSideEffects&&l.constructor===s&&c.depth>=u&&(0,P.sudo)(l).dependencies.length===o&&c===i[c.depth]&&d[0]===n[0]&&f[0]===r[0]&&(null===p?p=[l]:p.push(l))}return null===p?V:p}{const{ancestry:i,deferBoundaryDepth:l}=a;let c=l;const u=[];for(let a=0;a<o;a++){const l=t[a];if(1===l.dependents.length)return V;if(a===o-1)for(const{dependencyIndex:t,step:c}of l.dependents){const l=(0,P.sudo)(c),{layerPlan:p,dependencyForbiddenFlags:d,dependencyOnReject:f,dependencies:h}=l;l===e||t!==a||l.hasSideEffects||l.constructor!==s||h.length!==o||p!==i[p.depth]||d[0]!==n[0]||f[0]!==r[0]||u.push(l)}const p=l.layerPlan.depth;p>c&&(c=p)}if(0===u.length)return V;let p=null;e:for(const e of u)if(!(e.layerPlan.depth<c)){for(let n=0;n<o-1;n++)if(t[n]!==(0,P.sudo)(e).dependencies[n])continue e;null===p?p=[e]:p.push(e)}return null===p?V:p}}isImmoveable(e){return!!e.hasSideEffects||(!!L(e)||null!==e[f.$$subroutine])}hoistStep(e){if(this.isImmoveable(e))return;if("mutationField"===e.layerPlan.parentLayerPlan?.reason.type)return;switch(e.layerPlan.reason.type){case"root":return;case"subscription":case"defer":if(e.isSyncAndSafe)break;return;case"polymorphic":if(e.isSyncAndSafe&&e.polymorphicPaths.size===e.layerPlan.reason.polymorphicPaths.size)break;if(e instanceof u.__FlagStep)break;return;case"subroutine":case"listItem":break;case"nullableBoundary":{const t=e.layerPlan.reason.parentStep;if((0,P.sudo)(e).dependencies.includes(t))return;break}case"mutationField":if(e.isSyncAndSafe&&!e.hasSideEffects){if(0===e.layerPlan.reason.mutationIndex)break;return}if(e instanceof u.__FlagStep)break;return;default:{const t=e.layerPlan.reason;throw new Error(`GrafastInternalError<81e3a7d4-aaa0-416b-abbb-a887734007bc>: unhandled layer plan reason ${(0,d.inspect)(t)}`)}}if((0,P.sudo)(e).dependencies.some((t=>t.layerPlan===e.layerPlan)))return;if(i.ok(null!==e.layerPlan.parentLayerPlan,"GrafastInternalError<55c8940f-e8ac-4985-8b34-96fc6f81d62d>: A non-root layer plan had no parent?!"),"polymorphic"===e.layerPlan.reason.type){let n=e.layerPlan;for(;(n=n.parentLayerPlan)&&"polymorphic"!==n.reason.type;);const r=n?n.reason.polymorphicPaths:t.POLYMORPHIC_ROOT_PATHS,a=[...e.polymorphicPaths];if(r?.has(a[0]));else if(null===r)e.polymorphicPaths=null;else{const t=[...e.layerPlan.reason.polymorphicPaths],n=new Set;for(const e of r){const r=e+">",s=a.filter((e=>e.startsWith(r))),o=t.filter((e=>e.startsWith(r)));if(s.length!==o.length)return;s.length>0&&n.add(e)}e.polymorphicPaths=n}}const n="subroutine"===e.layerPlan.reason.type?e.layerPlan.reason.parentStep:null;this.stepTracker.moveStepToLayerPlan(e,e.layerPlan.parentLayerPlan),n&&n.addDependency(e),this.hoistStep(e)}pushDown(e){if(this.isImmoveable(e))return e;switch(e.layerPlan.reason.type){case"root":case"subscription":case"defer":case"polymorphic":case"subroutine":case"nullableBoundary":case"listItem":break;case"mutationField":if(e.isSyncAndSafe&&!e.hasSideEffects)break;return e;default:{const t=e.layerPlan.reason;throw new Error(`GrafastInternalError<81e3a7d4-aaa0-416b-abbb-a887734009bc>: unhandled layer plan reason ${(0,d.inspect)(t)}`)}}const t=new Set,n=this.stepTracker.outputPlansByRootStep.get(e);if(void 0!==n)for(const r of n){if(r.layerPlan===e.layerPlan)return e;t.add(r.layerPlan)}for(const{step:n}of e.dependents){if(n.layerPlan===e.layerPlan)return e;t.add(n.layerPlan)}const r=this.stepTracker.layerPlansByParentStep.get(e);if(void 0!==r)for(const n of r){if(n.parentLayerPlan===e.layerPlan)return e;t.add(n.parentLayerPlan)}const a=this.stepTracker.layerPlansByRootStep.get(e);if(void 0!==a)for(const n of a){if(n===e.layerPlan)return e;t.add(n)}if(0===t.size)throw new Error(`Nothing depends on ${e}?!`);if(t.has(e.layerPlan))throw new Error("GrafastInternalError<c5cefdbc-9aa4-4895-8966-71171d8c0b36>: This should already have been caught");const s=[];let o=1/0;for(const n of t){let t=n;const r=[t];for(;t.parentLayerPlan!=e.layerPlan;){const e=t.parentLayerPlan;if(!e)throw new Error("GrafastInternalError<64c07427-4fe2-43c4-9858-272d33bee0b8>: invalid layer plan heirarchy");t=e,r.push(t)}s.push(r),o=Math.min(r.length,o)}const i=t.size;let l=e.layerPlan;e:for(let e=0;e<o;e++){const t=s[0][e];if("polymorphic"===t.reason.type)break;if("subroutine"===t.reason.type)break;if("mutationField"===t.reason.type)break;for(let n=1;n<i;n++){if(t!=s[n][e])break e}l=t}return l===e.layerPlan||this.stepTracker.moveStepToLayerPlan(e,l),e}_deduplicateInnerLogic(e){if(e.hasSideEffects)return null;if(e instanceof u.__ItemStep)return null;if(e._stepOptions.stream)return null;const t=this.getPeers(e),n=u.isDev&&(0,O.unlock)(e),r=e.deduplicate(t);if(n&&(0,O.lock)(e),0===r.length)return null;if(u.isDev&&!r.every((e=>t.includes(e))))throw new Error(`deduplicatePlan error: '${e}.deduplicate' may only return steps from its peers peers (peers = ${t}), but it returned ${r}. This is currently forbidden because it could cause confusion during the optimization process, instead apply this change in 'optimize', or make sure that any child selections aren't applied until the optimize/finalize phase so that no mapping is required during deduplicate.`);let a=e.layerPlan.depth,s=[e];for(const e of r){const t=e.layerPlan.depth;t<a?(a=t,s=[e]):t===a&&s.push(e)}return s.sort(((e,t)=>e.id-t.id)),{stepsAtMinDepth:s,equivalentSteps:r}}deduplicateStep(e){if(e.isArgumentsFinalized=!0,null==e.deduplicate)return e;const t=this._deduplicateInnerLogic(e);if(null==t)return e;const{stepsAtMinDepth:n,equivalentSteps:r}=t,a=n[0];if(null!==a.polymorphicPaths){const e=new Set;for(const t of n)for(const n of t.polymorphicPaths)e.add(n);a.polymorphicPaths=e}if(a!==e){const t=u.isDev&&(0,O.unlock)(e);e.deduplicatedWith?.(a),t&&(0,O.lock)(e),this.stepTracker.replaceStep(e,a)}for(const e of r)if(a!==e){const t=u.isDev&&(0,O.unlock)(e);e.deduplicatedWith?.(a),t&&(0,O.lock)(e),this.stepTracker.replaceStep(e,a)}return a}deduplicateStepsProcess(e,t,n){e.add(n);for(const r of(0,P.sudo)(n).dependencies)r.id>=t&&!e.has(r)&&this.deduplicateStepsProcess(e,t,r);(0,w.withGlobalLayerPlan)(n.layerPlan,n.polymorphicPaths,this.deduplicateStep,this,n)}deduplicateSteps(e){void 0===e&&(e=0);const t=this.stepTracker.nextStepIdToDeduplicate,n=this.stepTracker.stepCount;if(n===t)return;const r=new Set;for(let e=t;e<n;e++){const n=this.stepTracker.stepById[e];n&&n.id===e&&!r.has(n)&&this.deduplicateStepsProcess(r,t,n)}if(this.stepTracker.nextStepIdToDeduplicate=n,this.stepTracker.stepCount>n){const t=5;if(e>t){const e=[];for(let t=n,r=this.stepTracker.stepCount;t<r;t++)e.push(this.stepTracker.stepById[t]);throw new Error(`Whilst deduplicating steps, more steps were created; whilst deduplicating those, even more steps were created. This happened ${t} times, which suggests this might go on infinitely. Please check the deduplicate/deduplicatedWith methods on ${e.map((e=>String(e))).join(", ")}.`)}return this.deduplicateSteps(e+1)}}hoistAndDeduplicate(e){return this.hoistStep(e),e.deduplicate?this.deduplicateStep(e):e}hoistSteps(){this.processSteps("hoist","dependencies-first",!1,this.hoistAndDeduplicate)}pushDownSteps(){this.processSteps("pushDown","dependents-first",!1,this.pushDown)}getStepOptionsForStep(e){return e._stepOptions}optimizeStep(e){const t=e.allowMultipleOptimizations&&e.deduplicate?this.deduplicateStep(e):e;if(!t.optimize)return t.isOptimized=!0,t;if(t.isOptimized&&!t.allowMultipleOptimizations)return t;const n=this.getStepOptionsForStep(t);let r;void 0!==t.optimizeMetaKey&&(r=this.optimizeMeta.get(t.optimizeMetaKey),r||(r=Object.create(null),this.optimizeMeta.set(t.optimizeMetaKey,r)));const a=u.isDev&&(0,O.unlock)(t),s=t.optimize({...n,meta:r});if(a&&(0,O.lock)(t),!s)throw new Error(`Bug in ${t}'s class: the 'optimize' method must return a step. Hint: did you forget 'return this;'?`);return t.isOptimized=!0,s}optimizeSteps(){const e=[];for(let t=0;t<10;t++){let n=!1;if(this.processSteps("optimize","dependents-first",!1,0===t?e=>{const t=this.optimizeStep(e);return t!==e&&(n=!0),t}:r=>{if(r.allowMultipleOptimizations){const a=this.optimizeStep(r);return a!==r&&(n=!0,t>=3&&e.push(r)),a}return r}),!n)return}console.warn(`Optimize steps looped 10 times, and was still replacing steps at the end - this could indicate a very complex plan, or badly behaved steps. Here are some of the steps that were replaced after the second loop: ${e.slice(0,10).join(", ")}`)}inlineSteps(){e:for(const e of this.stepTracker.activeSteps)if(e instanceof u.__FlagStep){{const t=this.stepTracker.outputPlansByRootStep.get(e);if(t?.size)continue}{const t=this.stepTracker.layerPlansByRootStep.get(e);if(t?.size)continue}{const t=this.stepTracker.layerPlansByParentStep.get(e);if(t?.size)continue}const t=[];for(const n of e.dependents){const{step:r,dependencyIndex:a}=n,s=(0,P.sudo)(r),o=e.inline(s.getDepOptions(a));if(null===o)continue e;t.push({$dependent:s,dependencyIndex:a,inlineDetails:o,dependent:n})}for(const e of t){const{$dependent:t,dependencyIndex:n,inlineDetails:{onReject:r,acceptFlags:a=f.DEFAULT_ACCEPT_FLAGS}}=e;(0,P.writeableArray)(t.dependencyOnReject)[n]=r,(0,P.writeableArray)(t.dependencyForbiddenFlags)[n]=f.ALL_FLAGS&~a}const n=(0,P.sudo)(e).dependencies[0];this.stepTracker.replaceStep(e,n)}}finalizeSteps(){const e=this.stepTracker.stepCount;i.strictEqual(this.modifierSteps.length,0,"No modifier steps expected when performing finalizeSteps");for(const t of this.stepTracker.activeSteps){const n=u.isDev&&(0,O.unlock)(t);if(t.finalize(),n&&(0,O.lock)(t),(0,y.assertFinalized)(t),u.isDev&&this.stepTracker.stepCount!==e)throw new Error(`When calling ${t}.finalize() a new plan was created; this is forbidden!`)}}finalizeLayerPlans(){const e=(e,t)=>{let n=t;for(;e.layerPlan!==n&&!n.copyStepIds.includes(e.id);){const r=this.stepTracker.getStepById(e.id);if(u.isDev&&r!==e)throw new Error(`GrafastInternalError<b291b110-396a-4c9c-814a-5466af3c50e8>: Plan mismatch; are we using a replaced step? Step ID: ${e.id}; step: ${e}; stepById: ${this.stepTracker.getStepById(e.id)}`);if(r._isUnary&&(r._isUnaryLocked=!0),n.copyStepIds.push(e.id),n=n.parentLayerPlan,!n)throw new Error(`GrafastInternalError<8c1640b9-fa3c-440d-99e5-7693d0d7e5d1>: could not find layer plan for '${e}' in chain from layer plan ${t}`)}};for(const e of this.stepTracker.layerPlans)e&&(e.steps=[]);for(const e of this.stepTracker.activeSteps)e.layerPlan.steps.push(e);for(const t of this.stepTracker.layerPlans){if(!t)continue;t.pendingSteps=t.steps.filter((e=>!(y.$$noExec in e)));const n=t.pendingSteps.filter((e=>e.hasSideEffects)),r=new Set(t.pendingSteps),a=new Set,s=e=>{if(a.has(e)||L(e))return;a.add(e),r.delete(e);const n=[],o=[];for(const r of(0,P.sudo)(e).dependencies)r.layerPlan===t&&(a.has(r)||(r.hasSideEffects?n.push(r):o.push(r)));for(const e of n)s(e);for(const e of o)s(e);const i={checkTimeout:(!1,!0),normalSteps:void 0,unbatchedSyncAndSafeSteps:void 0,_allSteps:[]};i.normalSteps=[{step:e}],i._allSteps.push(e),t.phases.push(i)};for(const e of n)s(e);const o=e=>{for(const n of(0,P.sudo)(e).dependencies)if(n.layerPlan===t&&r.has(n))return!1;return!0};for(;r.size>0;){const e=[];for(const t of r)o(t)&&e.push(t);if(0===e.length)throw new Error(`GrafastInternalError<2904ebbf-6344-4f2b-9305-8db9c1ff29c5>: Could not compute execution order?! Remaining: ${[...r]} (processed: ${[...a]}; all: ${t.pendingSteps})`);const n={checkTimeout:!1,normalSteps:void 0,unbatchedSyncAndSafeSteps:void 0,_allSteps:[]};for(const t of e)a.add(t),r.delete(t),t.isSyncAndSafe&&(0,y.isUnbatchedExecutableStep)(t)?void 0!==n.unbatchedSyncAndSafeSteps?n.unbatchedSyncAndSafeSteps.push({step:t,scratchpad:void 0}):n.unbatchedSyncAndSafeSteps=[{step:t,scratchpad:void 0}]:(t.isSyncAndSafe&&!t.hasSideEffects||(n.checkTimeout=!0),void 0!==n.normalSteps?n.normalSteps.push({step:t}):n.normalSteps=[{step:t}]);let s=!1;do{s=!1;for(const e of r)e.isSyncAndSafe&&(0,y.isUnbatchedExecutableStep)(e)&&o(e)&&(a.add(e),r.delete(e),s=!0,void 0!==n.unbatchedSyncAndSafeSteps?n.unbatchedSyncAndSafeSteps.push({step:e,scratchpad:void 0}):n.unbatchedSyncAndSafeSteps=[{step:e,scratchpad:void 0}])}while(s);if(void 0!==n.normalSteps)for(const{step:e}of n.normalSteps)n._allSteps.push(e);if(void 0!==n.unbatchedSyncAndSafeSteps)for(const{step:e}of n.unbatchedSyncAndSafeSteps)n._allSteps.push(e);t.phases.push(n)}for(const n of t.steps)if(!(y.$$noExec in n))for(const r of(0,P.sudo)(n).dependencies)e(r,t);const i=t.rootStep;if(i&&e(i,t),"polymorphic"===t.reason.type){const n=t.reason.parentStep;e(n,t)}if("listItem"===t.reason.type){const n=t.reason.parentStep;e(n,t.parentLayerPlan)}}this.stepTracker.allOutputPlans.forEach((t=>{e(t.rootStep,t.layerPlan)}));for(const e of this.stepTracker.layerPlans)null!==e&&e.finalize()}optimizeOutputPlans(){this.stepTracker.allOutputPlans.forEach((e=>e.optimize()))}finalizeOutputPlans(){this.stepTracker.allOutputPlans.forEach((e=>e.finalize()))}walkOutputPlans(e,t){t(e),null!==e.child&&this.walkOutputPlans(e.child,t),void 0!==e.childByTypeName&&Object.values(e.childByTypeName).forEach((e=>{this.walkOutputPlans(e,t)}));for(const n of Object.values(e.keys))"outputPlan"===n.type&&this.walkOutputPlans(n.outputPlan,t);for(const n of e.deferredOutputPlans)this.walkOutputPlans(n,t)}generatePlanJSON(){function e(e){const t=e.toStringMeta(),n=(0,P.sudo)(e);return{id:e.id,stepClass:e.constructor.name,metaString:t?(0,u.stripAnsi)(t):t,isUnary:e._isUnary,bucketId:e.layerPlan.id,dependencyIds:n.dependencies.map((e=>e.id)),dependencyForbiddenFlags:n.dependencyForbiddenFlags.slice(),dependencyOnReject:n.dependencyOnReject.map((e=>e?String(e):e)),polymorphicPaths:e.polymorphicPaths?[...e.polymorphicPaths]:void 0,isSyncAndSafe:e.isSyncAndSafe||void 0,supportsUnbatched:"function"==typeof e.unbatchedExecute||void 0,hasSideEffects:e.hasSideEffects||void 0,extra:e.planJSONExtra()}}function t(e){return{normalStepIds:e.normalSteps?.map((e=>e.step.id)),unbatchedStepIds:e.unbatchedSyncAndSafeSteps?.map((e=>e.step.id))}}function n(e){switch(e.type){case"root":{const{type:t}=e;return{type:t}}case"nullableBoundary":{const{type:t,parentStep:n}=e;return{type:t,parentStepId:n.id}}case"listItem":{const{type:t,parentStep:n,stream:r}=e;return{type:t,parentStepId:n.id,stream:r}}case"subscription":{const{type:t}=e;return{type:t}}case"mutationField":{const{type:t,mutationIndex:n}=e;return{type:t,mutationIndex:n}}case"defer":{const{type:t,label:n}=e;return{type:t,label:n}}case"polymorphic":{const{type:t,typeNames:n,parentStep:r,polymorphicPaths:a}=e;return{type:t,typeNames:n,parentStepId:r.id,polymorphicPaths:[...a]}}case"subroutine":{const{type:t,parentStep:n}=e;return{type:t,parentStepId:n.id}}default:{const t=e;throw new Error(`Failed to process layer plan reason ${(0,d.inspect)(t)}`)}}}return{version:"v1",rootBucket:function r(a){return a.reason,{id:a.id,reason:n(a.reason),copyStepIds:a.copyStepIds,phases:a.phases.map(t),steps:a.steps.map(e),children:a.children.map(r),rootStepId:a.rootStep?a.rootStep.id:null}}(this.rootLayerPlan)}}finishSubroutine(e,t){const n=(t,r)=>{for(const n of this.stepTracker.activeSteps)if(n.layerPlan===t)for(const t of(0,P.sudo)(n).dependencies)r.includes(t.layerPlan)||e.addDependency(t);for(const e of t.children)n(e,[...r,e])};n(t,[t])}deleteLayerPlan(e){this.stepTracker.deleteLayerPlan(e)}getStepsByMetaKey(e){const t=[];for(const n of this.stepTracker.activeSteps)n.metaKey===e&&t.push(n);return t}getStepsByStepClass(e){const t=[];for(const n of this.stepTracker.activeSteps)n instanceof e&&t.push(n);return t}};const K=Object.freeze(Object.create(null));function J(){return K}function Y(e,t,n,r,a){const s=[];for(let t=r,n=e.stepTracker.stepCount;t<n;t++)s.push(e.stepTracker.stepById[t]);throw new Error(`${a}; whilst performing ${t} of ${n} the following new steps were created: ${s.map((e=>String(e))).join(", ")}`)}},38769:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getChildBucketAndIndex=t.nonNullError=t.coerceError=t.OutputPlan=void 0;const r=n(22970),a=r.__importDefault(n(53870)),s=r.__importStar(n(45290)),o=r.__importStar(n(73177)),i=r.__importStar(n(48282)),l=n(79554),c=n(46510),u=n(4730),p=n(40354),d=n(68415),f=n(60351),{executeSync:h,GraphQLBoolean:y,GraphQLError:b,GraphQLFloat:m,GraphQLID:g,GraphQLInt:S,GraphQLString:P,isObjectType:v,Kind:w,OperationTypeNode:O}=s,$=o.default.ref(p.FLAG_ERROR,"FLAG_ERROR"),E=o.default.ref(ge,"coerceError"),_=o.default.ref(Se,"nonNullError"),x=o.default.ref(o.stringifyString,"stringifyString"),I=o.default.ref(o.stringifyJSON,"stringifyJSON"),L=o.default.ref(d.isPolymorphicData,"isPolymorphicData"),k=o.default.ref(p.$$concreteType,"$$concreteType"),j=o.default.ref(i,"assert"),A=o.default.ref(Pe,"getChildBucketAndIndex"),T=o.default.ref(u.inspect,"inspect"),R=o.default.ref(p.$$streamMore,"$$streamMore"),N=o.default`String`,D=o.default`// root/introspection, null is fine`,B=o.default`"null"`,C=o.default`null`,F=o.default`childBucket`,G=o.default`childBucketIndex`,M=o.default`executeString`,V=o.default`execute`,z=o.default`polymorphic`,U=o.default`let string = "{";`,H=o.default`string +=`,q=o.default`  string += "}";\n`,Q=o.default`    string += "]";\n`,W=o.default`const obj = Object.create(null);`,K=o.default`,`,J=o.default`spec.locationDetails`,Y=o.default`this.locationDetails`,Z=o.default`spec.outputPlan`,X=o.default`bucket`,ee=o.default`bucketIndex`,te=o.default`
  // Everything seems okay; queue any deferred payloads
  for (const defer of this.deferredOutputPlans) {
    root.queue.push({
      root,
      path: mutablePath.slice(1),
      bucket,
      bucketIndex,
      outputPlan: defer,
      label: defer.type.deferLabel,
    });
  }
`,ne=o.default`string`,re=o.default`object`,ae=o.default`obj`,se=o.default`data`,oe=o.default.ref((function(e,t,n,r,a,s,o){a.streams.length>s&&a.streams.splice(s);a.queue.length>o&&a.queue.splice(o);const i=ge(e,t,n.slice(1)),l=r+1,c=n.length-l;c>0&&n.splice(l,c);a.errors.push(i)}),"handleError"),ie=o.default`, childBucket, childBucketIndex, directChild`,le=o.default`let string;`,ce=o.default`const data = [];`,ue=o.default`    string = "[]";`,pe=o.default`    string = "[";\n`,de=o.default`    /* noop */`,fe=o.default`\n      if (i > 0) { string += ","; }\n`,he=o.default`data[i] =`,ye=o.default`childOutputPlan`,be=o.default`_nonNull`,me=o.default`_stream`;function ge(e,t,n){return e instanceof b?void 0!==e.path?e:new b(e.message,t.node,null,null,n,e.originalError??e,e.extensions):new b(e.message,t.node,null,null,n,e,null)}function Se(e,t){const{parentTypeName:n,fieldName:r,node:a}=e;return new b(n&&r?`Cannot return null for non-nullable field ${n}.${r}.`:"GrafastInternalError<a3706bba-4f88-4643-8a47-2fe2eaaadbea>: null bubbled to root",a,null,null,t,null,null)}function Pe(e,t,n,r,a){if(void 0===a&&(a=null),null==a==(null!=t&&"array"===t.type.mode))throw new Error("GrafastInternalError<83d0e3cc-7eec-4185-85b4-846540288162>: arrayIndex must be supplied iff outputPlan is an array");if(t&&e.layerPlan===n.layerPlan)return[n,r];const s=[e.layerPlan];let o=e.layerPlan;for(;!n.children[o.id];){if(o=o.parentLayerPlan,!o)return null;s.push(o)}let i=n,l=r;for(let e=s.length,t=e-1;t>=0;t--){const n=s[t],r=i.children[n.id];if(!r)return null;const o=r.map.get(l);if(null==o)return null;if(null==a||t!==e-1){if(Array.isArray(o))throw new Error("GrafastInternalError<db189d32-bf8f-4e58-b55f-5c5ac3bb2381>: Was expecting an arrayIndex, but none was provided");i=r.bucket,l=o}else{if(!Array.isArray(o))throw new Error(`GrafastInternalError<8190d09f-dc75-46ec-8162-b20ad516de41>: Cannot access array index in non-array ${(0,u.inspect)(o)}`);if(!(o.length>a))throw new Error(`GrafastInternalError<1f596c22-368b-4d0d-94df-fb3df632b064>: Attempted to retrieve array index '${a}' which is out of bounds of array with length '${o.length}'`);i=r.bucket,l=o[a]}}return null==l?null:[i,l]}function ve(e){const{inner:t,nameExtra:n,asString:r,skipNullHandling:a=!1,preamble:s=o.default.blank}=e;return o.default`\
(function compiledOutputPlan${r?N:o.default.blank}_${n}(
  root,
  mutablePath,
  bucket,
  bucketIndex,
  rawBucketRootValue = bucket.store.get(this.rootStep.id).at(bucketIndex),
  bucketRootFlags = bucket.store.get(this.rootStep.id)._flagsAt(bucketIndex)
) {
  const bucketRootValue = this.processRoot !== null ? this.processRoot(rawBucketRootValue, bucketRootFlags) : rawBucketRootValue;
${s}\
  ${a?l.isDev?D:o.default.blank:o.default`if (bucketRootValue == null) return ${r?B:C};`}
  if (bucketRootFlags & ${$}) {
    throw ${E}(bucketRootValue, this.locationDetails, mutablePath.slice(1));
  }
${t}
})`}function we(e,t){const n=ve(e);if(void 0===t)return o.default.run(o.default`return ${n}`);o.default.runInBatch(n,t)}function Oe(e,t,n,r,a,s,i){void 0===s&&(s=F),void 0===i&&(i=G);const l=o.default`${n}.${a?M:V}(
  root,
  mutablePath,
  ${s},
  ${i},
  ${s}.rootStep === this.rootStep ? rawBucketRootValue : undefined,
  ${s}.rootStep === this.rootStep ? bucketRootFlags : undefined
)`;return r?o.default`\
  ${s===X?o.default.blank:o.default`if (${s} == null) {
    throw ${_}(${t}, mutablePath.slice(1));
  }
  `}fieldResult = ${l};
  if (fieldResult == ${a?B:C}) {
    throw ${_}(${t}, mutablePath.slice(1));
  }
  ${e} fieldResult;`:o.default`\
  {
    const streamCount = root.streams.length;
    const queueCount = root.queue.length;
    try {
      ${e} ${s===X?o.default.blank:o.default`${s} == null ? ${a?B:C} : `}${l};
    } catch (e) {
      ${oe}(e, ${t}, mutablePath, mutablePathIndex, root, streamCount, queueCount);
      ${e} ${a?B:C};
    }
  }`}t.OutputPlan=class OutputPlan{constructor(e,t,n,r){this.layerPlan=e,this.type=n,this.processRoot=null,this.keys=Object.create(null),this.child=null,this.childIsNonNull=!1,this.deferredOutputPlans=[],this.locationDetails=r,this.rootStep=t,e.operationPlan.stepTracker.addOutputPlan(this),this.childByTypeName="polymorphic"===this.type.mode?Object.create(null):void 0}print(){const e=this.type;switch(e.mode){case"root":case"object":return`${this.toString()}\n${Object.entries(this.keys).map((t=>{let[n,r]=t;return`.${n}: ${"__typename"===r.type?"":r.isNonNull?"!":"?"}${"__typename"===r.type?`__typename(${e.typeName})`:r.outputPlan.print().replace(/\n/g,"\n  ")}`})).join("\n")}`;case"polymorphic":return`${this.toString()}\n${Object.entries(this.childByTypeName).map((e=>{let[t,n]=e;return`? ${t}: ${n.print().replace(/\n/g,"\n  ")}`})).join("\n")}`;case"array":return`${this.toString()}\n  ${this.childIsNonNull?"!":"?"}${this.child.print().replace(/\n/g,"\n  ")}`;default:return this.toString()}}toString(){return`OutputPlan<${this.type.mode}∈${this.layerPlan.id}!${this.rootStep.id}>`}addChild(e,t,n){if("root"===this.type.mode||"object"===this.type.mode){if(l.isDev){if("string"!=typeof t)throw new Error(`GrafastInternalError<7334ec50-23dc-442a-8ffa-19664c9eb79f>: Key must be provided in ${this.type.mode} OutputPlan mode`);if(null==e)throw new Error(`GrafastInternalError<638cebef-4ec6-49f4-b681-2f390fb1c0fc>: Type must be provided in ${this.type.mode} OutputPlan mode.`);if(!v(e))throw new Error(`GrafastInternalError<eaa87576-1d50-49be-990a-345a9b57b998>: Type must provided in ${this.type.mode} OutputPlan mode must be an object type, instead saw '${e}'.`);if(i.ok(["root","object"].includes(this.type.mode),"Can only addChild on root/object output plans"),void 0!==this.keys[t])throw new Error(`GrafastInternalError<5ceecb19-8c2c-4797-9be5-9be1b207fa45>: child already set for key '${t}'`)}this.keys[t]="outputPlan"===n.type?{...n,layerPlanId:n.outputPlan.layerPlan.id}:n}else if("array"===this.type.mode){if(l.isDev){if(null!=t)throw new Error(`GrafastInternalError<7de67325-a02f-4619-b118-61bb2d84f33b>: Key must not be provided in ${this.type.mode} OutputPlan mode`);if(i.ok(null==e,"Array should not specify type"),null!==this.child)throw new Error("GrafastInternalError<07059d9d-a47d-441f-b834-683cca1d856a>: child already set")}if("outputPlan"!==n.type)throw new Error("GrafastInternalError<7525c854-9145-4c6d-8d60-79c14f040519>: Array child must be an outputPlan");this.child=n.outputPlan,this.childIsNonNull=n.isNonNull}else{if("polymorphic"!==this.type.mode)throw new Error(`GrafastInternalError<5667df5f-30b7-48d3-be3f-a0065ed9c05c>: Doesn't make sense to set a child in mode '${this.type.mode}'`);l.isDev&&(i.ok(e&&this.type.typeNames.includes(e.name),"GrafastInternalError<566a34ac-1138-4dbf-943e-f704819431dd>: polymorphic output plan can only addChild for a matching type"),i.strictEqual(t,null,"GrafastInternalError<4346ebda-a02d-4489-b767-7a6d621a73c7>: addChild for polymorphic OutputPlan should not specify a key"),i.ok("outputPlan"===n.type,"GrafastInternalError<b29285da-fb07-4943-9038-708edc785041>: polymorphic OutputPlan child must be an outputPlan"),i.ok("object"===n.outputPlan.type.mode,"GrafastInternalError<203469c6-4bfa-4cd1-ae82-cc5d0132ca16>: polymorphic OutputPlan child must be an object outputPlan")),this.childByTypeName[e.name]=n.outputPlan}}getLayerPlans(e){if(void 0===e&&(e=new Set),e.add(this.layerPlan),null!==this.child){if(this.child.layerPlan==this.layerPlan)throw new Error("GrafastInternalError<4013e05f-b8ed-41ea-a869-204232d02763>: how could the child be in the same layer?");this.child.getLayerPlans(e)}for(const t in this.keys){const n=this.keys[t];"outputPlan"===n.type&&n.outputPlan.layerPlan!==this.layerPlan&&(n.outputPlan.getLayerPlans(e),e.add(n.outputPlan.layerPlan))}return e}makeNextStepByLayerPlan(){const e=this.getLayerPlans(),t=Object.create(null);for(const n of e)t[n.id]=[];return t}execute(e,t,n,r){throw new Error("OutputPlan.execute has yet to be built!")}executeString(e,t,n,r){throw new Error("OutputPlan.executeString has yet to be built!")}optimize(){const e=this.layerPlan.operationPlan.dangerouslyGetStep(this.rootStep.id);if(e instanceof c.AccessStep&&void 0===e.fallback){const t=e.unbatchedExecute[f.expressionSymbol];if(void 0!==t){const n=e.getDep(0);this.layerPlan.operationPlan.stepTracker.setOutputPlanRootStep(this,n);const[r,a]=t;!function(e,t,n){const r=(void 0===t?"d":"f")+"_"+e.join("|"),a=Ye.get(r);if(void 0!==a)return void n(a);const s=Ze.get(r);if(void 0!==s)return void s.push(n);const i=[n];Ze.set(r,i);const l=[];for(let t=0,n=e.length;t<n;t++){const n=e[t];l.push(o.default.optionalGet(n))}const c=o.default.join(l,"");o.default.runInBatch(o.default`(value => (value${c})${void 0!==t?o.default` ?? ${o.default.lit(t)}`:o.default.blank})`,(e=>{Ye.set(r,e),Ze.delete(r);for(const t of i)t(e)}))}(r,a,(e=>{this.processRoot=e}))}}}finalize(){switch(this.type.mode){case"null":this.execute=$e,this.executeString=Ee;break;case"leaf":this.execute=_e,this.type.graphqlType.serialize===g.serialize||this.type.graphqlType.serialize===P.serialize?this.executeString=je:this.type.graphqlType.serialize===S.serialize?this.executeString=Le:this.type.graphqlType.serialize===m.serialize?this.executeString=ke:this.type.graphqlType.serialize===y.serialize?this.executeString=Ie:this.executeString=xe;break;case"introspection":this.execute=He,this.executeString=qe;break;case"polymorphic":this.execute=Te,this.executeString=Re;break;case"array":{if(!this.child)throw new Error("GrafastInternalError<48fabdc8-ce84-45ec-ac20-35a2af9098e0>: No child output plan for list bucket?");const e=this.childIsNonNull;let t=this.child.layerPlan;for(;t.parentLayerPlan!==this.layerPlan;){const e=t.parentLayerPlan;if(!e)throw new Error(`GrafastInternalError<d43e06d8-c533-4e7b-b3e7-af399f19c83f>: Invalid heirarchy - could not find direct layerPlan child of ${this}`);t=e}const n="listItem"===t.reason.type&&!!t.reason.stream;e?n?(this.execute=Fe,this.executeString=ze):(this.execute=Ce,this.executeString=Ve):n?(this.execute=Be,this.executeString=Me):(this.execute=De,this.executeString=Ge);break}case"root":case"object":{const e=this.type,t=Object.create(null);for(const[e,n]of Object.entries(this.keys))t[e]={fieldType:"__typename"===n.type?"__typename":n.isNonNull?"outputPlan!":"outputPlan?",sameBucket:"__typename"===n.type||n.outputPlan.layerPlan.id===this.layerPlan.id};We(e.typeName,t,this.deferredOutputPlans.length>0,"root"===e.mode,!1,(e=>{this.execute=e})),We(e.typeName,t,this.deferredOutputPlans.length>0,"root"===e.mode,!0,(e=>{this.executeString=e}));break}default:{const e=this.type;throw new Error(`GrafastInternalError<e88531b2-d9af-4d3a-8cd5-e9f034324341>: Could not build executor for OutputPlan with type ${(0,u.inspect)(e)}}`)}}}},t.coerceError=ge,t.nonNullError=Se,t.getChildBucketAndIndex=Pe;const $e=we({inner:o.default.cache`  return null;`,nameExtra:o.default.cache`null`,asString:!1}),Ee=we({inner:o.default.cache`  return "null";`,nameExtra:o.default.cache`null`,asString:!0}),_e=we({inner:o.default`\
  return this.type.graphqlType.serialize(bucketRootValue);
`,nameExtra:o.default.cache`leaf`,asString:!1}),xe=we({inner:o.default`\
  return ${I}(this.type.graphqlType.serialize(bucketRootValue));
`,nameExtra:o.default.cache`leaf`,asString:!0}),Ie=we({inner:o.default`\
  const val = this.type.graphqlType.serialize(bucketRootValue);
  return val === true ? 'true' : 'false';
`,nameExtra:o.default.cache`booleanLeaf`,asString:!0,skipNullHandling:!1,preamble:o.default`\
  if (bucketRootValue === true) return 'true';
  if (bucketRootValue === false) return 'false';
`}),Le=we({inner:o.default`\
  return '' + this.type.graphqlType.serialize(bucketRootValue);
`,nameExtra:o.default.cache`intLeaf`,asString:!0,skipNullHandling:!1,preamble:o.default`\
  if ((bucketRootValue | 0) === bucketRootValue) {
    return '' + bucketRootValue;
  }
`}),ke=we({inner:o.default`\
  return String(this.type.graphqlType.serialize(bucketRootValue));
`,nameExtra:o.default.cache`floatLeaf`,asString:!0,skipNullHandling:!1,preamble:o.default`\
  if (Number.isFinite(bucketRootValue)) {
    return '' + bucketRootValue;
  }
`}),je=we({inner:o.default`\
  return ${x}(this.type.graphqlType.serialize(bucketRootValue));
`,nameExtra:o.default.cache`stringLeaf`,asString:!0,skipNullHandling:!1,preamble:o.default`\
  if (typeof bucketRootValue === 'string') {
    return ${x}(bucketRootValue);
  }
`});function Ae(e){return we({inner:o.default`\
${l.isDev?o.default`\
  if (!${L}(bucketRootValue)) {
    throw ${E}(
      new Error(
        "GrafastInternalError<db7fcda5-dc39-4568-a7ce-ee8acb88806b>: Expected polymorphic data",
      ),
      this.locationDetails,
      mutablePath.slice(1),
    );
  }
`:o.default.blank}\
  const typeName = bucketRootValue[${k}];
  const childOutputPlan = this.childByTypeName[typeName];
  ${l.isDev?o.default`{
    ${j}.ok(
      typeName,
      "GrafastInternalError<fd3f3cf0-0789-4c74-a6cd-839c808896ed>: Could not determine concreteType for object",
    );
    ${j}.ok(
      childOutputPlan,
      \`GrafastInternalError<a46999ef-41ff-4a22-bae9-fa37ff6e5f7f>: Could not determine the OutputPlan to use for '\${typeName}' from '\${bucket.layerPlan}'\`,
    );
  }`:o.default.blank}

  const directChild = bucket.children[childOutputPlan.layerPlan.id];
  if (directChild !== undefined) {
    return childOutputPlan.${e?M:V}(root, mutablePath, directChild.bucket, directChild.map.get(bucketIndex));
  } else {
    const c = ${A}(
      childOutputPlan,
      this,
      bucket,
      bucketIndex,
    );
    if (!c) {
      throw new Error("GrafastInternalError<691509d8-31fa-4cfe-a6df-dcba21bd521f>: polymorphic executor couldn't determine child bucket");
    }
    const [childBucket, childBucketIndex] = c;
    return childOutputPlan.${e?M:V}(root, mutablePath, childBucket, childBucketIndex);
  }
`,nameExtra:z,asString:e})}const Te=Ae(!1),Re=Ae(!0);function Ne(e,t,n){return we({inner:o.default`\
  if (!Array.isArray(bucketRootValue)) {
    console.warn(\`Hit fallback for value \${${T}(bucketRootValue)} coercion to mode 'array'\`);
    return ${n?B:C};
  }

  const childOutputPlan = this.child;
  const l = bucketRootValue.length;
  let fieldResult;
  ${n?le:ce}
  if (l === 0) {
${n?ue:de}
  } else {
${n?pe:o.default.blank}\
    const mutablePathIndex = mutablePath.push(-1) - 1;

    // Now to populate the children...
    const directChild = bucket.children[childOutputPlan.layerPlan.id];
    let childBucket, childBucketIndex, lookup;
    if (directChild !== undefined) {
      childBucket = directChild.bucket;
      lookup = directChild.map.get(bucketIndex)
    }
    for (let i = 0; i < l; i++) {
      if (directChild !== undefined) {
        childBucketIndex = lookup[i];
      } else {
        const c = ${A}(
          childOutputPlan,
          this,
          bucket,
          bucketIndex,
          i,
        );
        if (c !== null) {
          ([childBucket, childBucketIndex] = c);
        } else {
          childBucket = childBucketIndex = null;
        }
      }

      mutablePath[mutablePathIndex] = i;
${n?fe:o.default.blank}
${Oe(n?H:he,Y,ye,e,n)}
    }

    mutablePath.length = mutablePathIndex;
${n?Q:o.default.blank}
  }
${t?o.default`\
  const stream = bucketRootValue[${R}] /* as | AsyncIterableIterator<any> | undefined*/;
  if (stream !== undefined) {
    root.streams.push({
      root,
      path: mutablePath.slice(1),
      bucket,
      bucketIndex,
      outputPlan: childOutputPlan,
      label: childOutputPlan.layerPlan.reason.stream?.label,
      stream,
      startIndex: bucketRootValue.length,
    });
  }`:o.default.blank}

  return ${n?ne:se};
`,nameExtra:o.default`array${e?be:o.default.blank}${t?me:o.default.blank}`,asString:n})}const De=Ne(!1,!1,!1),Be=Ne(!1,!0,!1),Ce=Ne(!0,!1,!1),Fe=Ne(!0,!0,!1),Ge=Ne(!1,!1,!0),Me=Ne(!1,!0,!0),Ve=Ne(!0,!1,!0),ze=Ne(!0,!0,!0),Ue=o.default.ref(((e,t,n,r)=>{const{locationDetails:a}=t,{field:s,introspectionCacheByVariableValues:o,variableNames:i}=t.type,l={...s,alias:{kind:w.NAME,value:"a"}},c={definitions:[{kind:w.OPERATION_DEFINITION,operation:O.QUERY,selectionSet:{kind:w.SELECTION_SET,selections:[l]},variableDefinitions:t.layerPlan.operationPlan.operation.variableDefinitions?.filter((e=>i.includes(e.variable.name.value)))},...Object.values(t.layerPlan.operationPlan.fragments)],kind:w.DOCUMENT},u=Object.create(null),p=[...i].sort();for(const t of p)u[t]=e.variables[t];const d=JSON.stringify(u),f=o.get(d);if(void 0!==f)return r?JSON.stringify(f):f;const y=h({schema:t.layerPlan.operationPlan.schema,document:c,variableValues:u});if(void 0!==y.errors){console.error("INTROSPECTION FAILED!"),console.error(y);const{node:e}=a;throw new b("INTROSPECTION FAILED!",e,null,null,n.slice(1),null,null)}const m=y.data.a;return o.set(d,m),r?JSON.stringify(m):m}),"introspect"),He=we({inner:o.default`  return ${Ue}(root, this, mutablePath, false)`,nameExtra:o.default.cache`introspection`,asString:!1,skipNullHandling:!0}),qe=we({inner:o.default`  return ${Ue}(root, this, mutablePath, true)`,nameExtra:o.default.cache`introspection`,asString:!0,skipNullHandling:!0}),Qe=/^[A-Za-z_][A-Za-z0-9_]*$/;function We(e,t,n,r,a,s){if(!Qe.test(e))throw new Error(`Unsafe type name: ${e}; doesn't conform to 'Name' in the GraphQL spec`);const i=[],l=[];let c=(a?"s":"o")+(r?"r":"")+(n?"d":""),u=!1;for(const[e,n]of Object.entries(t)){if(!Qe.test(e))throw new Error(`Unsafe key: ${e}; doesn't conform to 'Name' in the GraphQL spec`);i.push(e),l.push(n);const{fieldType:t,sameBucket:r}=n;switch(t){case"__typename":c+="_";break;case"outputPlan?":c+="?";break;case"outputPlan!":c+="!";break;default:throw new Error(`Unsupported field type '${t}'`)}r||(u=!0,c+="~")}!function(e,t,n,r,a,s,i){const l=Ke.get(e);if(void 0!==l)return i(l);const c=Je.get(e);if(void 0!==c)return void c.push(i);const u=[i];Je.set(e,u);const p=o.default`\
  ${a?U:W}
  const { keys } = this;
  const mutablePathIndex = mutablePath.push("!") - 1;
  let spec${s?ie:o.default.blank}, fieldResult;

${o.default.join(t.map(((e,t)=>{let{fieldType:n,sameBucket:r}=e;const s=o.default.identifier(`fieldName_${t}`);switch(n){case"__typename":return a?o.default`  string += \`${0===t?o.default.blank:K}"\${${s}}":"\${typeName}"\`;\n`:o.default`  obj[${s}] = typeName;\n`;case"outputPlan!":case"outputPlan?":return o.default`\
  mutablePath[mutablePathIndex] = ${s};
  spec = keys[${s}];
${a?o.default`  string += \`${0===t?o.default.blank:K}"\${${s}}":\`;
`:o.default.blank}\
${r?o.default`\
${Oe(a?H:o.default`obj[${s}] =`,J,Z,"outputPlan!"===n,a,X,ee)}`:o.default`\
  directChild = bucket.children[spec.outputPlan.layerPlanId];
  if (directChild !== undefined) {
    childBucket = directChild.bucket;
    childBucketIndex = directChild.map.get(bucketIndex);
  } else {
    const c = ${A}(
      spec.outputPlan,
      this,
      bucket,
      bucketIndex,
    );
    if (c !== null) {
      ([childBucket, childBucketIndex] = c);
    } else {
      childBucket = childBucketIndex = null;
    }
  }
${Oe(a?H:o.default`obj[${s}] =`,J,Z,"outputPlan!"===n,a)}`}
`;default:throw new Error(`GrafastInternalError<879082f4-fe6f-4112-814f-852b9932ca83>: unsupported key type ${n}`)}})),"\n")}

  mutablePath.length = mutablePathIndex;
${a?q:o.default.blank}\
${n?te:o.default.blank}
  return ${a?ne:ae};`,d=ve({inner:p,nameExtra:re,asString:a,skipNullHandling:r,preamble:o.default.blank}),f=o.default`\
function objectExecutorFactory(typeName${o.default.join(t.map(((e,t)=>o.default`, ${o.default.identifier(`fieldName_${t}`)}`)),"")}) {
  return ${d};
}`;o.default.runInBatch(f,(t=>{Ke.set(e,t),Je.delete(e);for(const e of u)e(t)}))}(c,l,n,r,a,u,(t=>{const n=t(e,...i);s(n)}))}const Ke=new a.default({maxLength:1e3}),Je=new Map;const Ye=new a.default({maxLength:1e3}),Ze=new Map},71476:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StepTracker=void 0;const r=n(79554),a=n(4730),s=n(40354),o=n(28326),i=n(22722),l=n(44026);t.StepTracker=class StepTracker{constructor(e){this.operationPlan=e,this.stepCount=0,this.lockedStepCount=0,this.activeSteps=new Set,this.stepById=[],this.aliasesById=[],this.stepsWithNoDependencies=new Set,this.outputPlansByRootStep=new Map,this.layerPlansByRootStep=new Map,this.layerPlansByParentStep=new Map,this.layerPlans=[],this.allOutputPlans=[],this.nextStepIdToDeduplicate=0}newStepsSince(e){return this.stepById.slice(e)}forbid(e){this[e]=()=>{throw new Error(`StepTracker.${e}(...) is forbidden after 'finalize' phase`)}}finalizeSteps(){this.forbid("addStep"),this.forbid("addLayerPlan"),this.forbid("addOutputPlan"),this.forbid("deleteLayerPlan"),this.forbid("addStepDependency"),this.forbid("setLayerPlanRootStep"),this.forbid("replaceStep")}finalizeOutputPlans(){this.forbid("setOutputPlanRootStep")}addStep(e){const t=this.stepCount++;return this.activeSteps.add(e),this.stepsWithNoDependencies.add(e),this.stepById[t]=e,this.aliasesById[t]=void 0,this.addStepToItsLayerPlan(e),t}addLayerPlan(e){const t=this.layerPlans.push(e)-1;switch(e.reason.type){case"root":case"subscription":case"mutationField":case"defer":break;case"nullableBoundary":case"listItem":case"polymorphic":{const t=this.layerPlansByParentStep.get(e.reason.parentStep);if(void 0!==t)t.add(e);else{const t=new Set;t.add(e),this.layerPlansByParentStep.set(e.reason.parentStep,t)}break}case"subroutine":{const t=e.reason.parentStep;if(null!==t[s.$$subroutine])throw new Error("Steps may currently only have one subroutine. If you have need for a step with multiple subroutines, please get in touch.");t[s.$$subroutine]=e;break}default:{const t=e.reason;throw new Error(`Unexpected layerPlan reason ${t.type}`)}}return t}addOutputPlan(e){if(r.isDev&&!this.activeSteps.has(e.rootStep))throw new Error(`GrafastInternalError<84485250-c4f3-4175-ab0c-360e073fa69f>: Root step '${e.rootStep}' is not active; perhaps it was replaced (replacement: ${this.getStepById(e.rootStep.id)})`);this.allOutputPlans.push(e);const t=this.outputPlansByRootStep.get(e.rootStep);if(void 0!==t)t.add(e);else{const t=new Set;t.add(e),this.outputPlansByRootStep.set(e.rootStep,t)}}deleteLayerPlan(e){if(r.isDev){if(e.children.length>0)throw new Error("This layer plan has children... should we really be deleting it?!");this.allOutputPlans.forEach((t=>{if(t.layerPlan===e)throw new Error("An output plan depends on this layer plan... should we really be deleting it?!")}))}if(this.layerPlans[e.id]=null,null!==e.parentLayerPlan){const t=e.parentLayerPlan.children.indexOf(e);t>=0&&e.parentLayerPlan.children.splice(t,1)}const t=e.rootStep;if(t&&this.layerPlansByRootStep.get(t).delete(e),"subroutine"!==e.reason.type){const t="parentStep"in e.reason?e.reason.parentStep:null;t&&this.layerPlansByParentStep.get(t).delete(e)}const n=new Set,a=t=>{if(!n.has(t)){n.add(t);for(const n of t.dependents)n.step.layerPlan===e&&a(n.step);this.eradicate(t)}};for(const t of this.activeSteps)t.layerPlan===e&&a(t)}getStepById(e,t){void 0===t&&(t=!1);const n=this.stepById[e];if(!n&&!t)throw new Error(`Illegal step access? Step with id ${e} doesn't exist`);if(r.isDev&&n&&!this.activeSteps.has(n))throw new Error(`${n} is not active, but we retrieved it from stepTracker.getStepById(${e}, ${t})`);return n}addStepDependency(e,t){const n=(0,i.sudo)(e),l=(0,i.sudo)(t.step);if(!this.activeSteps.has(n))throw new Error(`Cannot add ${l} as a dependency of ${n}; the latter is deleted!`);if(!this.activeSteps.has(l))throw new Error(`Cannot add ${l} as a dependency of ${n}; the former is deleted!`);if(n.isFinalized)throw new Error("You cannot add a dependency after the step is finalized.");if(!(l instanceof o.ExecutableStep))throw new Error(`Error occurred when adding dependency for '${n}', value passed was not a step, it was '${(0,a.inspect)(l)}'`);if(r.isDev&&!n.layerPlan.ancestry.includes(l.layerPlan))throw new Error(`Attempted to add '${l}' (${l.layerPlan}) as a dependency of '${n}' (${n.layerPlan}), but we cannot because that LayerPlan isn't an ancestor`);const c=(0,i.writeableArray)(n.dependencies),u=(0,i.writeableArray)(n.dependencyForbiddenFlags),p=(0,i.writeableArray)(n.dependencyOnReject),{skipDeduplication:d,acceptFlags:f=s.ALL_FLAGS&~n.defaultForbiddenFlags,onReject:h}=t;if(!1===d){const e=c.indexOf(l);if(e>=0)return e}if(!l._isUnary&&n._isUnary){if(n._isUnaryLocked)throw new Error(`Attempted to add non-unary step ${l} as a dependency of ${n}; but the latter is unary, so it cannot depend on batch steps`);n._isUnary=!1}const y=s.ALL_FLAGS&~(f&s.TRAPPABLE_FLAGS);this.stepsWithNoDependencies.delete(n);const b=c.push(l)-1;return u[b]=y,p[b]=h,(0,i.writeableArray)(l.dependents).push({step:n,dependencyIndex:b}),b}addStepUnaryDependency(e,t){const n=t.step;if(!n._isUnary)throw new Error(`${e} attempted to create a unary step dependency on ${n}, but that step is not unary. You may use \`.addDependency()\` instead of \`.addUnaryDependency()\`.`);return n._isUnaryLocked=!0,this.addStepDependency(e,t)}setOutputPlanRootStep(e,t){if(!this.activeSteps.has(t))throw new Error(`Cannot add ${t} to ${e} because it's deleted`);const n=e.rootStep;if(n){const t=this.outputPlansByRootStep.get(n);if(!t)throw new Error(`GrafastInternalError<f39690fc-f565-40d9-a781-e68a3bf5e84a>: ${e}.rootStep (${n}) isn't in 'outputPlansByRootStep'`);t.delete(e),t.size}e.rootStep=t;const r=this.outputPlansByRootStep.get(t);if(void 0!==r)r.add(e);else{const n=new Set;n.add(e),this.outputPlansByRootStep.set(t,n)}}setLayerPlanRootStep(e,t){if(!this.activeSteps.has(t))throw new Error(`Cannot add ${t} to ${e} because it's deleted`);const n=e.rootStep;if(n){const t=this.layerPlansByRootStep.get(n);if(!t)throw new Error(`GrafastInternalError<7b5b7fe6-d403-48bd-a75f-1c9557b9a030>: ${e}.rootStep (${n}) isn't in 'layerPlansByRootStep'`);t.delete(e),0===t.size&&this.layerPlansByRootStep.delete(n)}e.rootStep=t;const r=this.layerPlansByRootStep.get(t);if(void 0!==r)r.add(e);else{const n=new Set;n.add(e),this.layerPlansByRootStep.set(t,n)}}replaceStep(e,t){if(!this.activeSteps.has(e))return;const n=this.aliasesById[e.id],r=this.aliasesById[t.id]??[t.id];if(this.aliasesById[t.id]=r,void 0!==n){for(const e of n)this.stepById[e]=t,r.push(e);this.aliasesById[e.id]=void 0}else this.stepById[e.id]=t,r.push(e.id);{const n=e.dependents;if(n.length>0){const r=(0,i.writeableArray)(t.dependents);for(const e of n)(0,i.writeableArray)((0,i.sudo)(e.step).dependencies)[e.dependencyIndex]=t,r.push(e);e.dependents=[]}}{const n=this.outputPlansByRootStep.get(e);if(n?.size){let e=this.outputPlansByRootStep.get(t);e||(e=new Set,this.outputPlansByRootStep.set(t,e));for(const r of n)r.rootStep=t,e.add(r);n.clear()}}{const n=this.layerPlansByRootStep.get(e);if(n?.size){let e=this.layerPlansByRootStep.get(t);e||(e=new Set,this.layerPlansByRootStep.set(t,e));for(const r of n)r.rootStep=t,e.add(r);n.clear()}}{const n=this.layerPlansByParentStep.get(e);if(n?.size){let e=this.layerPlansByParentStep.get(t);e||(e=new Set,this.layerPlansByParentStep.set(t,e));for(const r of n)r.reason.parentStep=t,e.add(r);n.clear()}}this.eradicate(e)}treeShakeSteps(){for(const e of this.activeSteps)this.isNotNeeded(e)&&this.eradicate(e)}isNotNeeded(e){if(0!==e.dependents.length)return!1;if(e.hasSideEffects)return!1;const t=this.outputPlansByRootStep.get(e);if(t&&0!==t.size)return!1;const n=this.layerPlansByRootStep.get(e);if(n&&0!==n.size)return!1;const r=this.layerPlansByParentStep.get(e);return!r||0===r.size}purgeBackTo(e){const t=this.stepCount,n=new Set;for(let r=e;r<t;r++){const e=this.stepById[r];e&&n.add(e)}const r=t=>{if(this.stepById[t.id]===t&&n.has(t)){for(const n of t.dependents)n.step.id>=e&&r(n.step);this.eradicate(t),n.delete(t)}};for(const e of n)r(e)}eradicate(e){null!==e[s.$$subroutine]&&this.deleteLayerPlan(e[s.$$subroutine]),this.removeStepFromItsLayerPlan(e);const t=this.aliasesById[e.id];if(void 0!==t){for(const e of t)this.stepById[e]=null;this.aliasesById[e.id]=void 0}else this.stepById[e.id]===e&&(this.stepById[e.id]=null);const n=(0,i.sudo)(e).dependencies;for(const t of n)t.dependents=t.dependents.filter((t=>t.step!==e)),"plan"!==this.operationPlan.phase&&this.isNotNeeded(t)&&this.eradicate(t);if(r.isDev){if(e.dependents.length>0)throw new Error(`${e} eradicated, but it is needed by ${e.dependents.map((e=>e.step))}`);const t=this.outputPlansByRootStep.get(e);if(t&&0!==t.size)throw new Error(`${e} eradicated, but it is needed by ${[...t]}`);const n=this.layerPlansByRootStep.get(e);if(n&&0!==n.size)throw new Error(`${e} eradicated, but it is needed by ${[...n]}`);const r=this.layerPlansByParentStep.get(e);if(r&&0!==r.size)throw new Error(`${e} eradicated, but it is needed by ${[...r]}`)}this.stepsWithNoDependencies.delete(e),this.outputPlansByRootStep.delete(e),this.layerPlansByRootStep.delete(e),this.layerPlansByParentStep.delete(e),this.activeSteps.delete(e),e.destroy()}moveStepToLayerPlan(e,t){this.removeStepFromItsLayerPlan(e),e.layerPlan=t,this.addStepToItsLayerPlan(e)}addStepToItsLayerPlan(e){const{layerPlan:{stepsByConstructor:t},constructor:n}=e;let r=t.get(n);r||(r=new Set,t.set(n,r)),r.add(e)}removeStepFromItsLayerPlan(e){e.layerPlan.stepsByConstructor.get(e.constructor).delete(e)}lockNewSteps(){if(r.isDev){for(let e=this.lockedStepCount;e<this.stepCount;e++){const t=this.getStepById(e,!0);t&&t.id===e&&(0,l.lock)(t)}this.lockedStepCount=this.stepCount}}}},61258:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unaryExecutionValue=t.batchExecutionValue=t.bucketToString=t.newBucket=t.executeBucket=void 0;const r=n(22970),a=n(40835),s=r.__importStar(n(48282)),o=n(79554),i=n(40549),l=n(4730),c=n(40354),u=n(28326),p=n(62408),d=n(22722),f=Object.freeze(new i.SafeError("Execution timeout exceeded, please simplify or add limits to your request.",Object.freeze({[c.$$timeout]:!0})));function h(){}function y(e,t,n){const r=[],a=[];let s=0;for(let o=0;o<n;o++){const n=t.flags[o];if(void 0!==n){const e=t.results[o];a[o]=e,r[o]=n}else a[o]=e[s++],r[o]=0}return{flags:r,results:a}}function b(){return`Bucket<${this.layerPlan}>`}function m(e,t){void 0===t&&(t=(0,d.arrayOfLength)(e.length,0));let n=null;return{at:g,isBatch:!0,entries:e,_flags:t,_flagsAt:S,_getStateUnion:()=>(null===n&&(n=t.reduce(v,c.NO_FLAGS)),n),_setResult:P,_copyResult:w}}function g(e){return this.entries[e]}function S(e){return this._flags[e]}function P(e,t,n){this.entries[e]=t,this._flags[e]=n}function v(e,t){return e|t}function w(e,t,n){this._setResult(e,t.at(n),t._flagsAt(n))}function O(e,t){return void 0===t&&(t=0),{at:$,isBatch:!1,value:e,_entryFlags:t,_flagsAt:E,_getStateUnion:_,_setResult:x,_copyResult:w}}function $(){return this.value}function E(){return this._entryFlags}function _(){return this._entryFlags}function x(e,t,n){if(0!==e)throw new Error("Unary step only expects one result");this.value=t,this._entryFlags=n}t.executeBucket=function e(t,n){function r(e,t,n,r){const a=I(e,t,n,r),s=(0,d.arrayOfLength)(e,c.NO_FLAGS);return(0,d.isPromiseLike)(a)?a.then((e=>({flags:s,results:e}))):{flags:s,results:a}}const{stopTime:b,eventEmitter:g}=n,{metaByMetaKey:S,size:P,store:v,layerPlan:{phases:w,children:O}}=t,$=w.length;let E=null;const _=e=>{if(e>=$)return;const r=w[e],{_allSteps:u}=r;let h=[],y=null,v=null,O=null;const x=[];if(r.checkTimeout&&null!==b&&p.timeSource.now()>=b){if(void 0!==r.normalSteps){for(let e=0,n=r.normalSteps.length;e<n;e++){const n=f,r=(0,d.arrayOfLength)(t.size,n),a=(0,d.arrayOfLength)(t.size,c.FLAG_ERROR);x[e]={flags:a,results:r},h.push(e),t.flagUnion|=c.FLAG_ERROR}}}else if(void 0!==r.normalSteps){const e=r.normalSteps;for(let n=0,r=e.length;n<r;n++){const r=e[n].step;r.hasSideEffects&&(null===v?v=[r]:v.push(r));try{const e=k(r);if((0,d.isPromiseLike)(e))if(x[n]=void 0,y){O[y.push(e)-1]=n}else y=[e],O=[n];else x[n]=e,h.push(n)}catch(e){const r=e,a=(0,d.arrayOfLength)(t.size,r),s=(0,d.arrayOfLength)(t.size,c.FLAG_ERROR);x[n]={flags:s,results:a},h.push(n),t.flagUnion|=c.FLAG_ERROR}}}const I=()=>{E||(E=t.polymorphicPathList.reduce(((e,t)=>(e[t??""]=[],e)),Object.create(null)));for(const e of v)if(e.polymorphicPaths)for(const t of e.polymorphicPaths)E[t].push(e);else E[""].push(e)},L=()=>_(e+1),j=()=>{if(0===h.length)return;const e=h;h=[];for(const n of e){const e=u[n],r=x[n];if(!r)throw new Error(`GrafastInternalError<166ef53d-b80d-4bea-8b54-803c2694112a>: Result from ${e} should exist`);const{results:a}=r,s=a?.length,o=e._isUnary?1:P;if(s!==o){if(!Array.isArray(a))throw new Error(`Result from ${e} should be an array, instead received ${(0,l.inspect)(a,{colors:!0})}`);throw new Error(`Result array from ${e} should have length ${o}${e._isUnary?" (because it's unary)":""}, instead it had length ${a.length}`)}e._isUnary||t.store.set(e.id,m((0,d.arrayOfLength)(P)))}let n,r,s;const o=(e,t,r,s,o)=>{if("object"!=typeof s)return void t.setResult(e,r,s,o);if(null===s){const n=o|c.FLAG_NULL;return void t.setResult(e,r,null,n)}if((0,i.isFlaggedValue)(s)){const n=o|s.flags;return void t.setResult(e,r,s.value,n)}let l;if(e._stepOptions.stream&&((l=(0,a.isAsyncIterable)(s))||(0,a.isIterable)(s))){const a=e._stepOptions.stream,i=a?a.initialCount:1/0,u=l?s[Symbol.asyncIterator]():s[Symbol.iterator]();if(t.iterators[r]||(t.iterators[r]=new Set),t.iterators[r].add(u),0===i){const n=[];n[c.$$streamMore]=u,t.setResult(e,r,n,o)}else{const a=(async()=>{try{let n=0;const a=[];let s;for(;s=u.next();){const e=await s;if(e.done)break;if(a.push(await e.value),++n>=i){a[c.$$streamMore]=u;break}}t.setResult(e,r,a,o)}catch(n){t.setResult(e,r,n,o|c.FLAG_ERROR)}})();n?n.push(a):n=[a]}}else t.setResult(e,r,s,o)};for(const n of e){const e=u[n],a=x[n];if(!a)throw new Error(`GrafastInternalError<b82038d6-ca4e-4b55-8ed4-4d7c879f5dc2>: Result from ${e} should exist`);const{flags:i,results:c}=a,p=e._isUnary?1:P;for(let a=0;a<p;a++){const u=c[a];if(e.isSyncAndSafe||!(0,d.isPromiseLike)(u)){if(null==i[a])throw new Error(`GraphileInternalError<75df71bb-0f76-4a98-9664-9167d502296a>: result for ${e} has no flag at index ${a} (value = ${(0,l.inspect)(u)})`);o(e,t,a,u,i[a])}else r?(r.push(u),s.push({s:n,i:a})):(r=[u],s=[{s:n,i:a}])}}return void 0!==r?Promise.allSettled(r).then((e=>{for(let n=0,r=e.length;n<r;n++){const r=e[n],{s:a,i}=s[n],l=u[a];if("fulfilled"===r.status)o(l,t,i,r.value,c.NO_FLAGS);else{const e=r.reason;t.setResult(l,i,e,c.FLAG_ERROR)}}return(t.flagUnion&c.FLAG_ERROR)===c.FLAG_ERROR&&v&&I(),n?Promise.all(n):void 0})).then(null,(e=>{console.error(`GrafastInternalError<1e9731b4-005e-4b0e-bc61-43baa62e6444>: this error should never occur! Please file an issue against grafast. Details: ${e}`),t.flagUnion|=c.FLAG_ERROR;for(let e=0,n=r.length;e<n;e++){const{s:n,i:r}=s[e],a=u[n],o=new Error(`GrafastInternalError<1e9731b4-005e-4b0e-bc61-43baa62e6444>: error occurred whilst performing completedStep(${a.id})`);t.setResult(a,r,o,c.FLAG_ERROR)}})):((t.flagUnion&c.FLAG_ERROR)===c.FLAG_ERROR&&v&&I(),n?Promise.all(n):void 0)},A=()=>{const e=x.length;if(o.isDev&&s.strictEqual(e,r.normalSteps?.length??0,"Expected only and all normalSteps to have executed"),!r.unbatchedSyncAndSafeSteps)return L();const a=u.length,l=[];for(let r=e;r<a;r++){const e=u[r],a=void 0!==e.metaKey?S[e.metaKey]:void 0;l[r]={stopTime:b,meta:a,eventEmitter:g,_bucket:t,_requestContext:n},e._isUnary||t.store.set(e.id,m((0,d.arrayOfLength)(P)))}e:for(let n=0;n<P;n++){if(E){const r=t.polymorphicPathList[n];for(const s of E[r??""]){const r=t.store.get(s.id),o=r._flagsAt(n);if((o&c.FLAG_POLY_SKIPPED)===c.FLAG_POLY_SKIPPED);else if((o&c.FLAG_ERROR)===c.FLAG_ERROR){for(let s=e;s<a;s++){const e=u[s];if(e._isUnary)t.store.set(e.id,r),t.flagUnion|=o;else{const a=r.at(n);t.setResult(e,n,a,o)}}continue e}}}t:for(let r=e;r<a;r++){const e=(0,d.sudo)(u[r]);try{const a=[],s=l[r];let o,u,p,d,f=c.NO_FLAGS;for(let r=0,s=e.dependencies.length;r<s;r++){const s=e.dependencies[r],i=e.dependencyForbiddenFlags[r],l=e.dependencyOnReject[r],p=t.store.get(s.id),d=p._flagsAt(n),h=d&i;if(h){if(f|=h,void 0!==l&&(h&(c.FLAG_INHIBITED|c.FLAG_ERROR))===c.NO_FLAGS&&(u||=l),null==o)if(0!=(d&c.FLAG_ERROR)){o=p.at(n)}else o=null}else{const r=p.at(n);let s;if((t.flagUnion&c.FLAG_ERROR)===c.FLAG_ERROR&&((s=p._flagsAt(n))&c.FLAG_ERROR)===c.FLAG_ERROR){e._isUnary?(t.store.set(e.id,p),t.flagUnion|=s):t.setResult(e,n,r,c.FLAG_ERROR);continue t}a.push(r)}}if(void 0!==o)null==o&&null!=u?(f|=c.FLAG_ERROR,o=u):f|=c.FLAG_INHIBITED,p=o,d=f;else{const t=e.unbatchedExecute(s,...a);"object"==typeof t&&null!==t&&(0,i.isFlaggedValue)(t)?(p=t.value,d=t.flags):(p=t,d=null==t?c.FLAG_NULL:c.NO_FLAGS)}t.setResult(e,n,p,d)}catch(r){t.setResult(e,n,r,c.FLAG_ERROR)}}}return L()};if(null!==y){const e=[];if(h.length>0){const t=j();(0,d.isPromiseLike)(t)&&e.push(t)}for(let t=0,n=y.length;t<n;t++){const n=y[t],r=O[t];e.push(n.then((e=>(x[r]=e,h.push(r),j()))))}return Promise.all(e).then(A)}{const e=j();return(0,d.isPromiseLike)(e)?e.then(A):A()}},x=_(0);return(0,d.isPromiseLike)(x)?x.then(A):A();function I(e,t,n,r){if(o.isDev&&t._isUnary&&1!==e)throw new Error(`GrafastInternalError<84a6cdfa-e8fe-4dea-85fe-9426a6a78027>: ${t} is a unary step, but we're attempting to pass it ${e} (!= 1) values`);const a=t._stepOptions.stream;if(a&&(0,u.isStreamableStep)(t)){if(t.stream.length>1)throw new Error(`${t} is using a legacy form of 'stream' which accepts multiple arguments, please see https://err.red/gev2`);return t.stream({indexMap:L(e),indexForEach:j(e),count:e,values:n,extra:r,streamOptions:a})}if(t.execute.length>1)throw new Error(`${t} is using a legacy form of 'execute' which accepts multiple arguments, please see https://err.red/gev2`);return t.execute({indexMap:L(e),indexForEach:j(e),count:e,values:n,extra:r})}function k(e){try{const a=void 0!==e.metaKey?S[e.metaKey]:void 0,i={stopTime:b,meta:a,eventEmitter:g,_bucket:t,_requestContext:n},l=[],u=[],p=[],f=l;let h=!1;const w=(0,d.sudo)(e).defaultForbiddenFlags,O=(e,n,r)=>{const a=v.get(e.id);if(l.push(a),u.push(n),p.push(r),!h&&0!=(t.flagUnion&n)){const e=a._getStateUnion();h=0!=(e&n)}},$=(0,d.sudo)(e),_=$.dependencies.length;if(_>0||null!==E){for(let e=0,t=_;e<t;e++){O($.dependencies[e],$.dependencyForbiddenFlags[e],$.dependencyOnReject[e])}if(null!==E)if($.polymorphicPaths)for(const e of $.polymorphicPaths)for(const t of E[e])O(t,w,void 0);else for(const e of E[""])O(e,w,void 0)}if(o.isDev&&"polymorphic"===e.layerPlan.reason.type&&null===e.polymorphicPaths)throw new Error("GrafastInternalError<c33328fe-6758-4699-8ac6-7be41ce58bfb>: a step without polymorphic paths cannot belong to a polymorphic bucket");if(!h){const t="polymorphic"===e.layerPlan.reason.type&&e.polymorphicPaths.size!==e.layerPlan.reason.polymorphicPaths.size;h||=t}const x=h?function(e,t,n,a,i,l){const u=e._isUnary?1:P,p={flags:(0,d.arrayOfLength)(u,void 0),results:(0,d.arrayOfLength)(u,void 0)};let f=!1,h=0;const b=e.polymorphicPaths,g=(0,d.sudo)(e).dependencies.length;let S=E?t.slice(0,g):t;for(let e=0;e<u;e++){let r,s,o=c.NO_FLAGS;if(null===b||b.has(i[e])){if(l._bucket.flagUnion)for(let i=0,l=t.length;i<l;i++){const l=t[i],u=n[i],p=a[i],d=l._flagsAt(e),f=d&u;if(f){o|=f,void 0!==p&&(f&(c.FLAG_INHIBITED|c.FLAG_ERROR))===c.NO_FLAGS&&(s||=p),null==r&&(r=0!=(d&c.FLAG_ERROR)?l.at(e):null);break}}}else o|=c.FLAG_POLY_SKIPPED,r=null;if(void 0!==r)f||(f=!0,S=S.map((t=>t.isBatch?m(t.entries.slice(0,e)):t))),null==r&&null!=s?(o|=c.FLAG_ERROR,r=s):o|=c.FLAG_INHIBITED,p.flags[e]=o,p.results[e]=r;else if(h++,f)for(let n=0;n<g;n++){const r=S[n];if(r.isBatch){const a=t[n];r.entries.push(a.at(e)),r._flags.push(a._flagsAt(e))}}}if(0===h)return p;if(f){const t=I(h,e,S,l);return(0,d.isPromiseLike)(t)?t.then((e=>y(e,p,u))):y(t,p,u)}return o.isDev&&s.ok(h===u,"GrafastInternalError<47fca4ab-069c-428f-8374-267479c7fd27>: Expected newSize to equal expectedSize"),r(h,e,S,l)}(e,f,u,p,t.polymorphicPathList,i):r(e._isUnary?1:P,e,f,i);return(0,d.isPromiseLike)(x)?x.then(null,(e=>({flags:(0,d.arrayOfLength)(P,c.FLAG_ERROR|c.FLAG_STOPPED),results:(0,d.arrayOfLength)(P,e)}))):x}catch(e){return{flags:(0,d.arrayOfLength)(P,c.FLAG_ERROR|c.FLAG_STOPPED),results:(0,d.arrayOfLength)(P,e)}}}function A(){const r=[];let a=null;const s=e=>{const t=(a??Promise.resolve()).then(e);return a=t.then(h,h),t};e:for(const a of O)switch(a.reason.type){case"nullableBoundary":case"listItem":case"polymorphic":{const s=a.newBucket(t);if(null!==s){const t=e(s,n);(0,d.isPromiseLike)(t)&&r.push(t)}break}case"mutationField":{const o=a.newBucket(t);if(null!==o){const t=s((()=>e(o,n)));r.push(t)}break}case"subroutine":case"subscription":case"defer":continue e;case"root":throw new Error("GrafastInternalError<05fb7069-81b5-43f7-ae71-f62547d2c2b7>: root cannot be not the root (...)");default:{const e=a.reason;throw new Error(`GrafastInternalError<c6984a96-050e-4d40-ab18-a8c5dc7e239b>: unhandled reason '${(0,l.inspect)(e)}'`)}}return r.length>0?Promise.all(r).then((()=>{t.isComplete=!0})):void(t.isComplete=!0)}},t.newBucket=function(e,t){if(o.isDev){if(!(e.size>0))throw new Error("GrafastInternalError<eb5c962d-c748-4759-95e3-52c50c873593>: No need to create an empty bucket!");s.strictEqual(e.polymorphicPathList.length,e.size,"polymorphicPathList length must match bucket size");for(const[t,n]of e.store.entries())s.ok("boolean"==typeof n.isBatch,`Store entry for step '${t}' for layerPlan '${e.layerPlan.id}' should be an ExecutionValue`),n.isBatch&&s.strictEqual(n.entries.length,e.size,`Store entry for step '${t}' for layerPlan '${e.layerPlan.id}' should have same length as bucket`);if(!e.iterators)throw new Error("newBucket called but no iterators array was specified")}const n=e.layerPlan.reason.type,r=null===t||"root"===n||"mutationField"===n||"subscription"===n?e.layerPlan.operationPlan.makeMetaByMetaKey():t,{layerPlan:a,store:i,size:l,flagUnion:c,polymorphicPathList:u,iterators:p}=e,d=Object.create(null);return{toString:b,layerPlan:a,store:i,size:l,flagUnion:c,polymorphicPathList:u,iterators:p,metaByMetaKey:r,isComplete:!1,children:d,setResult(e,t,n,r){const s=e.id;if(t>=l)throw new Error(`GrafastInternalError<9465db89-cc9d-415c-97e7-57bb19ddebe0>: attempt to write to out of bounds index ${t} for bucket of size ${l} for step ${e}`);if(0!==r&&(this.flagUnion|=r),e._isUnary){if(o.isDev&&i.has(s)){const t=i.get(s);console.error(`GrafastInternalWarning<603e635f-af46-4feb-abb1-bac184bf7ef2>: value for step ${e} has already been stored to bucket ${a}; overwriting.`,{isBatch:t?.isBatch,value0:t?.at(0),flags0:t?._flagsAt(0)},{isBatch:!1,value:n,flags:r})}const t=O(n,r);i.set(s,t)}else{const a=i.get(s);if(!a||!a.isBatch)throw a?new Error(`GrafastInternalError<f587d317-8919-4f14-905a-ab7bb338dd2b>: value for step ${e} expected to be a batch value, but is unary (non-batch)`):new Error(`GrafastInternalError<e2ba1e4a-5391-4f81-bb21-fb200e29aea2>: value for step ${e} expected to be a batch value, but is not set`);a._setResult(t,n,r)}}}},t.bucketToString=b,t.batchExecutionValue=m,t.unaryExecutionValue=O;const I=new Map;function L(e){const t=I.get(e);if(void 0!==t)return t;const n=t=>{const n=[];for(let r=0;r<e;r++)n.push(t(r));return n};return e<=100&&I.set(e,n),n}const k=new Map;function j(e){const t=k.get(e);if(void 0!==t)return t;const n=t=>{for(let n=0;n<e;n++)t(n)};return e<=100&&k.set(e,n),n}},80569:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.executeOutputPlan=void 0;const r=n(22970),a=r.__importDefault(n(25130)),s=r.__importStar(n(48282)),o=n(79554),i=(0,a.default)("grafast:OutputPlan").extend("verbose");t.executeOutputPlan=function(e,t,n,r,a){i.enabled&&i("Executing %c with data:\n%c",t,n),o.isDev&&s.strictEqual(n.isComplete,!0,"Can only process an output plan for a completed bucket");const l=["SOMEONE_FORGOT_TO_SLICE_THE_PATH!",...e.path];return a?t.executeString(e.root,l,n,r):t.execute(e.root,l,n,r)}},35616:(e,t)=>{"use strict";let n,r;Object.defineProperty(t,"__esModule",{value:!0}),t.isUnaryStep=t.currentPolymorphicPaths=t.currentLayerPlan=t.withGlobalLayerPlan=void 0,t.withGlobalLayerPlan=function(e,t,a,s){const o=n;n=e;const i=r;r=t;try{for(var l=arguments.length,c=new Array(l>4?l-4:0),u=4;u<l;u++)c[u-4]=arguments[u];return a.apply(s,c)}finally{n=o,r=i}},t.currentLayerPlan=function(){if(void 0===n)throw new Error("Now is not a valid time to call `currentLayerPlan`. This error typically occurs when you attempt to call a Grafast step function from outside of the planning lifecycle - it's important to note that Grafast plans must be resolved synchronously, so check for 'async' or 'setTimeout' or any location where a step function is called outside of a plan resolver. For more information, read about plan resolvers: https://grafast.org/grafast/plan-resolvers");return n},t.currentPolymorphicPaths=function(){if(void 0===r)throw new Error("GrafastInternalError<b0b05743-8b21-42c6-9b53-925013d88bd1>: currentPolymorphicPaths called out of turn; must only called within a withGlobalLayerPlan callback");return r},t.isUnaryStep=function(e){return e._isUnary}},44026:(e,t)=>{"use strict";function n(e){return void 0!==e[t.$$unlock]}function r(){throw new Error("Only Grafast may call a step's optimize method; rather than calling optimize on the steps your class depends on, consider opting in to multiple optimization passes via `allowMultipleOptimizations`.")}function a(){throw new Error("Only Grafast may call a step's finalize method; steps should not attempt to interact with other steps during finalize.")}function s(){throw new Error("Only Grafast may call a step's deduplicate method.")}function o(){throw new Error("Only Grafast may call a step's deduplicatedWith method.")}Object.defineProperty(t,"__esModule",{value:!0}),t.unlock=t.lock=t.$$unlock=void 0,t.$$unlock=Symbol("unlock"),t.lock=function(e){if(!n(e)){const{optimize:n,finalize:i,deduplicate:l,deduplicatedWith:c}=e;n&&(e.optimize=r),"function"==typeof i&&(e.finalize=a),l&&(e.deduplicate=s),c&&(e.deduplicatedWith=o),e[t.$$unlock]=()=>{e[t.$$unlock]=void 0,n&&e.optimize!==r?console.warn(`Warning: ${e}'s optimize method changed whilst locked`):e.optimize=n,"function"==typeof i&&e.finalize!==a?console.warn(`Warning: ${e}'s finalize method changed whilst locked`):e.finalize=i,l&&e.deduplicate!==s?console.warn(`Warning: ${e}'s deduplicate method changed whilst locked`):e.deduplicate=l,c&&e.deduplicatedWith!==o?console.warn(`Warning: ${e}'s deduplicatedWith method changed whilst locked`):e.deduplicatedWith=c}}},t.unlock=function(e){return!!n(e)&&(e[t.$$unlock](),!0)}},40549:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isSafeError=t.SafeError=t.isFlaggedValue=t.flagError=t.$$inhibit=void 0;const a=n(79554),s=n(4730),o=n(40354),i=Symbol("grafastFlaggedValue");function l(){return this.flags&o.FLAG_ERROR&&this.value instanceof Error?String(this.value):this.flags&o.FLAG_INHIBITED&&null===this.value?"INHIBIT":`${this.flags}/${(0,s.inspect)(this.value)}`}function c(e,t,n){if(a.isDev){if(null===t&&!(e&o.FLAG_NULL))throw new Error("flaggedValue called with null, but not flagged as null.");if(null===t&&!(e&o.FLAG_INHIBITED))throw new Error("flaggedValue called with null, but not flagged as inhibited.")}return{[i]:!0,flags:e,value:t,planId:n,toString:l}}t.$$inhibit=c(o.FLAG_NULL|o.FLAG_INHIBITED,null,null),t.flagError=function(e,t){return void 0===t&&(t=null),c(o.FLAG_ERROR,e,t)},t.isFlaggedValue=function(e){return Object.hasOwn(e,i)};class SafeError extends Error{static#e=r=o.$$safeError;static#t=this.$$export={moduleName:"grafast",exportName:"SafeError"};constructor(e,t,n){void 0===t&&(t=void 0),super(e,n),this.extensions=t,this[r]=!0,Object.setPrototypeOf(this,SafeError.prototype)}}t.SafeError=SafeError,t.isSafeError=function(e){return e[o.$$safeError]}},96574:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.establishOperationPlan=void 0;const r=n(22970),a=r.__importDefault(n(53870)),s=r.__importDefault(n(25130)),o=n(38456),i=n(79554),l=n(46510),c=n(40354),u=n(62408),p=(0,s.default)("grafast:establishOperationPlan"),d=("undefined"!=typeof process&&"string"==typeof process.env.GRAFAST_TIMEOUT_VALIDITY_MS?parseInt(process.env.GRAFAST_TIMEOUT_VALIDITY_MS,10):null)||6e4;const f=i.isDev?function(e,t){if(e!==t){p("fragments aren't `===` for same operation");const n=Object.keys(e).sort(),r=Object.keys(t).sort(),a=n.join(","),s=r.join(",");if(a.length!==s.length)throw new Error(`Inconsistency error: operation matches, but fragment keys differ: '${a}' != '${s}'.`);for(const n of r)if(e[n]!==t[n])throw new Error(`Inconsistency error: operation matches, fragment names match, but fragment '${n}' is not '===' to the previous value.`)}}:i.noop;function h(e,t,n,r){const{variableValuesConstraints:a,contextConstraints:s,rootValueConstraints:i}=e;return!!(0,o.matchesConstraints)(a,t)&&(!!(0,o.matchesConstraints)(s,n)&&!!(0,o.matchesConstraints)(i,r))}t.establishOperationPlan=function(e,t,n,r,s,o,i){void 0===i&&(i=null);let p,y,b=e.extensions.grafast?.[c.$$cacheByOperation],m=b?.get(t),g=0,S=null;if(void 0!==m){f(m.fragments,n);let e=null,t=m.possibleOperationPlans;for(;t;){const n=t.value;if(n instanceof l.SafeError){if(null==n.extensions?.[c.$$timeout])throw n;if(n.extensions[c.$$ts]<u.timeSource.now()-d){t=t.next,null!==e?e.next=t:m.possibleOperationPlans=t;continue}if(null!==i&&n.extensions[c.$$timeout]>=i)throw n}else{if(n instanceof Error)throw n;if(h(n,r,s,o))return null!==e&&(e.next=t.next,t.next=m.possibleOperationPlans,m.possibleOperationPlans=t),n}g++,S=e,e=t,t=t.next}}try{p=new l.OperationPlan(e,t,n,r,s,o,i)}catch(e){y=e}b||(e.extensions.grafast||(e.extensions.grafast=Object.create(null)),b=new a.default({maxLength:e.extensions.grafast.operationsCacheMaxLength??500}),e.extensions.grafast[c.$$cacheByOperation]=b);const P=p??y;if(m){g>=(e.extensions.grafast.operationOperationPlansCacheMaxLength??50)&&(S.next=null,g--),m.possibleOperationPlans={value:P,next:m.possibleOperationPlans}}else m={fragments:n,possibleOperationPlans:{value:P,next:null}},b.set(t,m);if(void 0!==y)throw y;return p}},11663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.execute=t.withGrafastArgs=void 0;const r=n(22970).__importDefault(n(10161)),a=n(94932),s=n(79554),o=n(4730),i=n(40354),l=n(37433),c=n(22722);function u(e,t,n){const a=t?.grafast;if(s.isDev&&null!=e.rootValue&&("object"!=typeof e.rootValue||Object.keys(e.rootValue).length>0))throw new Error(`Grafast executor doesn't support there being a rootValue (found ${(0,o.inspect)(e.rootValue)})`);if(null==e.rootValue&&(e.rootValue=Object.create(null)),"object"!=typeof e.rootValue||null==e.rootValue)throw new Error("Grafast requires that the 'rootValue' be an object");const u=a?.explain;let p=null;if(!!u){const t=new r.default,n=[];e.rootValue=Object.assign(Object.create(null),e.rootValue,{[i.$$eventEmitter]:t,[i.$$extensions]:{explain:{operations:n}}});const a=e=>{let{operation:t}=e;(!0===u||u&&u.includes(t.type))&&n.push(t)};t.on("explainOperation",a),p=()=>{t.removeListener("explainOperation",a)}}const d=(0,l.grafastPrepare)(e,{explain:a?.explain,outputDataAsString:n,timeouts:a?.timeouts});return null!==p&&Promise.resolve(d).then(p,p),(0,c.isPromiseLike)(d)?Promise.resolve(d):d}t.withGrafastArgs=u,t.execute=function(e,t,n){return u(e,e.resolvedPreset??t??a.NULL_PRESET,e.outputDataAsString??n??!1)}},24586:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportAsMany=t.exportAs=void 0;const r=n(22722);function a(e,t,n){if("$$export"in t){const a=t.$$export;if(a.moduleName!==e)throw new Error(`Attempted to export ${t} as '${e}.${n}', but it's already exported as '${a.moduleName}.${a.exportName}' (module name mismatch)`);if("string"==typeof a.exportName||"string"===n){if(a.exportName!==n)throw new Error(`Attempted to export ${t} as '${e}.${n}', but it's already exported as '${a.moduleName}.${a.exportName}' (export name mismatch)`)}else if(!Array.isArray(a.exportName)||!Array.isArray(n)||!(0,r.arraysMatch)(a.exportName,n))throw new Error(`Attempted to export ${t} as '${e}.${n}', but it's already exported as '${a.moduleName}.${a.exportName}' (export name path mismatch)`)}else Object.defineProperty(t,"$$export",{value:{moduleName:e,exportName:n}});return t}t.exportAs=a,t.exportAsMany=function(e,t){for(const n of Object.keys(t)){const r=t[n];"object"!=typeof r&&"function"!=typeof r||null===r||a(e,t[n],n)}}},60977:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDebug=t.setDebug=void 0;let n=!1;t.setDebug=function(e){n=e},t.getDebug=function(){return n}},91457:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.grafastSync=t.grafast=void 0;const r=n(22970),a=r.__importDefault(n(53870)),s=r.__importStar(n(45290)),o=n(40549),i=n(11663),l=n(46510),c=n(40354),u=n(22722),{GraphQLError:p,parse:d,Source:f,validate:h,validateSchema:y}=s,b=Math.max(2,Math.ceil(524.288));let m;try{let e,t;const r=n(14015).createHash;if("function"!=typeof r)throw new Error("Failed to load createHash");m=n=>(n!==e&&(e=n,t=r("sha1").update(n).digest("base64")),t)}catch{m=e=>e}const g=(e,t)=>{let n=e.extensions.grafast?.[c.$$queryCache];if(!n){const t=e.extensions.grafast?.queryCacheMaxLength??b;n=new a.default({maxLength:t}),e.extensions.grafast||(e.extensions.grafast=Object.create(null)),e.extensions.grafast[c.$$queryCache]=n}const r=m("string"==typeof t?t:t.body),s=n.get(r);if(void 0!==s)return s;{const a="string"==typeof t?new f(t,"GraphQL Http Request"):t;let s;try{s=d(a);const t=h(e,s),o=t.length>0?t:s;return n.set(r,o),o}catch(e){const t=[e instanceof p?e:new p("Validation error occurred",void 0,void 0,void 0,void 0,e)];return n.set(r,t),t}}};function S(e,t,n){const{schema:r,source:a,rootValue:s,contextValue:o,variableValues:c,operationName:p,fieldResolver:d,typeResolver:f,resolvedPreset:h=t,requestContext:b=n}=e,m=y(r);if(m.length>0)return{errors:m};const S=g(r,a);if(Array.isArray(S))return{errors:S};const P={schema:r,document:S,rootValue:s,contextValue:o,variableValues:c,operationName:p,fieldResolver:d,typeResolver:f};if(h&&b){const e=(0,l.hookArgs)(P,h,b);return(0,u.isPromiseLike)(e)?Promise.resolve(e).then((e=>(0,i.execute)(e,h))):(0,i.execute)(e,h)}return(0,i.execute)(P,h)}t.grafast=S,t.grafastSync=function(e,t,n){const r=S(e,t,n);if((0,u.isPromiseLike)(r))throw new o.SafeError("Grafast execution failed to complete synchronously.");return r}},48285:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ansiPad=t.grafastPrint=t.grafastColor=t.printStore=t.recursivePrintBucket=t._grafastPrint=void 0;const r=n(22970).__importDefault(n(2645)),a=n(61258),s=n(38769),o=n(4730),i=n(28326),l=n(73376),c=n(22722),u=[r.default.yellow,r.default.magenta,r.default.red,r.default.greenBright,r.default.yellowBright,r.default.blueBright,r.default.magentaBright,r.default.cyanBright,r.default.redBright,r.default.blue,r.default.green],p=[r.default.visible,r.default.underline];function d(e,t){if((0,c.isDeferred)(e))return r.default.gray`<Deferred>`;if((0,c.isPromise)(e))return r.default.gray`<Promise>`;if(e===c.ROOT_VALUE_OBJECT)return r.default.gray`(blank)`;if(e instanceof i.ExecutableStep)return String(e);if(Array.isArray(e))return t.has(e)?r.default.gray`(loop)`:(t.add(e),`[${e.map(((e,n)=>p[n%p.length](d(e,new Set(t))))).join(", ")}]`);if(e instanceof Map){if(t.has(e))return r.default.gray`(loop)`;t.add(e);const n=[];let a=0;for(const[r,s]of e.entries())n.push(p[a%p.length](`${d(r,new Set(t))}: ${d(s,new Set(t))}`)),a++;return`Map{${n.join(", ")}}`}return"object"==typeof(n=e)&&null!==n&&n.toString===a.bucketToString?h(e):"object"==typeof e&&e?e instanceof Error?r.default.red(`ERROR<${(0,l.stripAnsi)(String(e.message)).replace(/\s+/g," ").substring(0,30)+"..."}>`):e instanceof s.OutputPlan?e.print():[null,Object.prototype,c.sharedNull].includes(Object.getPrototypeOf(e))?t.has(e)?r.default.gray`(loop)`:(t.add(e),`{${[...Object.keys(e),...Object.getOwnPropertySymbols(e)].map(((n,r)=>p[r%p.length](`${d(n,new Set(t))}: ${d(e[n],new Set(t))}`))).join(", ")}}`):r.default.red(`OBJECT<${(0,l.stripAnsi)(String(e))}>`):"symbol"!=typeof e?(0,o.inspect)(e,{colors:!0}):function(e){const t=function(e){if(!e.description)return r.default.green("Symbol()");const t=e.description?.replace(/[^0-9]/g,"")||"",n=parseInt(t,10)||0;return n>0?m(e.description,n):r.default.cyan(`$$${e.description}`)}(e);S||(S=setTimeout((()=>{S=null,g.clear()}),200));const n=g.get(t);if(!n)return g.set(t,[e]),t;let a=n.indexOf(e);if(0===a)return t;a<0&&(a=n.push(e)-1);return`${t}${r.default.gray(`:${a+1}`)}`}(e);var n}function f(e,t){return" ".repeat(e)+t.replace(/\n/g,`\n${" ".repeat(e)}`)}function h(e,t){return void 0===t&&(t=0),f(t,`Bucket for ${e.layerPlan} (size = ${e.size}):\n  Store:\n${f(4,b(e))}\n  Children:\n${Object.entries(e.children).map((e=>{let[t,{bucket:n}]=e;return f(4,h(n))})).join("\n")}`)}t._grafastPrint=d,t.recursivePrintBucket=h;const y={colors:!0,depth:0,showHidden:!1,maxArrayLength:5,maxStringLength:50};function b(e){const t=[];for(const[n,r]of e.store){const a=String(n).padStart(3," ");if(e.layerPlan.copyStepIds.includes(n))t.push(`${a} (copy)`);else if(r.isBatch){const s=e.layerPlan.operationPlan.stepTracker.getStepById(n,!0);t.push(`${a} (BATCH): ${s??"-"}\n${f(2,r.entries.map(((e,t)=>{return`${String(t).padStart(3," ")}: flags=${String(r._flagsAt(t)).padStart(2," ")} value=${n=(0,o.inspect)(r.at(t),y),n.includes("\n")?f(4,"\n"+n):n}`;var n})).join("\n"))}`)}else{const s=e.layerPlan.operationPlan.stepTracker.getStepById(n,!0);t.push(`${a} (UNARY/${String(r._entryFlags).padStart(2," ")}) ${s??"-"}\n${f(4,(0,o.inspect)(r.value,y))}`)}}return t.join("\n")||"EMPTY"}function m(e,t){return(0,u[Math.abs(t)%u.length])(e)}t.printStore=b,t.grafastColor=m;const g=new Map;let S=null;t.grafastPrint=function(e){return d(e,new Set)},t.ansiPad=function(e,t,n,r){const a=t-(0,l.stripAnsi)(e).length;if(a>=0){const t=n.repeat(a);return"start"===r?t+e:e+t}return e}},89159:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.graphqlCollectFields=t.evalDirectiveArgDirect=t.evalDirectiveArg=void 0;const r=n(22970).__importStar(n(45290)),a=n(40549),{GraphQLError:s,GraphQLInterfaceType:o,GraphQLObjectType:i,GraphQLUnionType:l}=r;function c(e,t,n,r,a){const s=function(e,t){return e.directives?.find((e=>e.name.value===t))}(e,t);if(s)return u(s,n,r,a)}function u(e,t,n,r){if(!e.arguments)return r;const s=e.arguments.find((e=>e.name.value===t));if(void 0===s)return r;{const r=s.value;switch(r.kind){case"Variable":return n.get(r.name.value).eval();case"BooleanValue":return r.value;case"IntValue":return parseInt(r.value,10);case"NullValue":return null;default:throw new a.SafeError(`Unsupported @${e.name}(${t}:) argument; expected Variable, Boolean or null; but received '${r.kind}'`)}}}function p(e,t){if(t instanceof i)return e===t;if(t instanceof o){return e.getInterfaces().includes(t)}if(t instanceof l){return t.getTypes().includes(e)}throw new Error("Invalid call to graphqlDoesFragmentTypeApply")}t.evalDirectiveArg=c,t.evalDirectiveArgDirect=u;const d=(e,t,n,r,a,s,o,i)=>{const l=e.trackedVariableValuesStep,c=s.directives?.find((e=>"defer"===e.name.value)),p=c?u(c,"if",l,!0)??!0:void 0,d=c?u(c,"label",l,null)??void 0:void 0,h=!0===p?{label:d,fields:new Map,deferred:void 0}:null;null!==h&&(void 0===a.deferred?a.deferred=[h]:a.deferred.push(h)),f(e,t,n,o.selections,r,i,h??a)};function f(e,t,n,r,a,o,l){void 0===a&&(a=!1),void 0===o&&(o=Object.create(null)),void 0===l&&(l={label:void 0,fields:new Map,deferred:void 0});const u=e.trackedVariableValuesStep;for(let f=0,h=r.length;f<h;f++){const h=r[f];if(void 0!==h.directives){if(!0===c(h,"skip","if",u,!0))continue;if(!1===c(h,"include","if",u,!0))continue}switch(h.kind){case"Field":{const e=h,t=e.alias?e.alias.value:e.name.value;let n=l.fields.get(t);void 0===n?(n=[e],l.fields.set(t,n)):n.push(e);break}case"FragmentSpread":{const r=h.name.value;if(o[r])continue;const s=e.fragments[r];if(null==s)continue;const c=s.typeCondition.name.value;if(c===n.name);else{const t=e.schema.getType(c);if(!t)continue;if(t.constructor===i||!p(n,t))continue}const u=s.selectionSet,f=Object.assign(Object.create(null),o);f[r]=!0,d(e,t,n,a,l,h,u,f);break}case"InlineFragment":{const r=h.typeCondition;if(null!=r){const t=r.name.value;if(t===n.name);else{const r=e.schema.getType(t);if(null==r)throw new s(`We don't have a type named '${t}'`);if(r.constructor===i||!p(n,r))continue}}const c=h.selectionSet;d(e,t,n,a,l,h,c,o);break}}}return l}t.graphqlCollectFields=f},46534:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fieldSelectionsForType=void 0;const r=n(22970).__importStar(n(45290)),a=n(4730),{Kind:s}=r;function o(e,t,n){const r=n.name.value;return t.name===r||(!!t.getInterfaces().some((e=>e.name===r))||!!e.unionsContainingObjectType[t.name].some((e=>e.name===r)))}t.fieldSelectionsForType=function e(t,n,r,i){void 0===i&&(i=[]);for(let l=0,c=r.length;l<c;l++){const c=r[l];switch(c.kind){case s.FRAGMENT_SPREAD:{const r=t.fragments[c.name.value];o(t,n,r.typeCondition)&&e(t,n,r.selectionSet.selections,i);break}case s.INLINE_FRAGMENT:{const r=c.typeCondition;r&&!o(t,n,r)||e(t,n,c.selectionSet.selections,i);break}case s.FIELD:i.push(c);break;default:{const e=c;throw new Error(`GrafastInternalError<10b01e35-cf2b-4f48-9c66-486cdef00323>: cannot process selection '${(0,a.inspect)(e)}'`)}}}return i}},46510:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getEnumValueConfig=t.flagError=t.FirstStep=t.first=t.filter=t.exportAsMany=t.exportAs=t.execute=t.ExecutableStep=t.ErrorStep=t.error=t.EdgeStep=t.each=t.defer=t.debugPlans=t.context=t.ConstantStep=t.constant=t.ConnectionStep=t.connection=t.ConditionStep=t.condition=t.BaseStep=t.assertPageInfoCapableStep=t.assertNotNull=t.assertModifierStep=t.assertListCapableStep=t.assertExecutableStep=t.assertEdgeCapableStep=t.arraysMatch=t.arrayOfLength=t.ApplyTransformsStep=t.applyTransforms=t.AccessStep=t.access=t.$$verbatim=t.$$inhibit=t.$$idempotent=t.$$extensions=t.$$eventEmitter=t.$$bypassGraphQL=t.__ValueStep=t.__TrackedValueStep=t.__ListTransformStep=t.__ItemStep=t.__InputStaticLeafStep=t.__InputObjectStep=t.__InputListStep=t.__FlagStep=t.isAsyncIterable=void 0,t.ObjectStep=t.objectSpec=t.objectFieldSpec=t.object=t.noop=t.NodeStep=t.node=t.newObjectTypeBuilder=t.newInputObjectTypeBuilder=t.newGrafastFieldConfigBuilder=t.ModifierStep=t.makeGrafastSchema=t.makeDecodeNodeId=t.LoadStep=t.loadOneCallback=t.loadOne=t.loadManyCallback=t.loadMany=t.LoadedRecordStep=t.listTransform=t.ListStep=t.ListenStep=t.listen=t.list=t.LastStep=t.last=t.LambdaStep=t.lambda=t.isUnaryStep=t.isStreamableStep=t.isSafeError=t.isPromiseLike=t.isObjectLikeStep=t.isModifierStep=t.isListLikeStep=t.isListCapableStep=t.isExecutableStep=t.isDev=t.inputObjectFieldSpec=t.inhibitOnNull=t.groupBy=t.GraphQLResolverStep=t.graphqlResolver=t.graphqlItemHandler=t.GraphQLItemHandler=t.grafastSync=t.grafastPrint=t.grafastGraphqlSync=t.grafastGraphql=t.grafast=void 0,t.DeepEvalStep=t.deepEval=t.version=t.hookArgs=t.UnbatchedExecutableStep=t.TRAP_INHIBITED=t.TRAP_ERROR_OR_INHIBITED=t.TRAP_ERROR=t.trap=t.trackedRootValue=t.trackedContext=t.subscribe=t.stripAnsi=t.stringifyPayload=t.stepsAreInSamePhase=t.stepAMayDependOnStepB=t.stepADependsOnStepB=t.specFromNodeId=t.SideEffectStep=t.sideEffect=t.SetterStep=t.setter=t.SafeError=t.rootValue=t.ReverseStep=t.reverseArray=t.reverse=t.RemapKeysStep=t.remapKeys=t.ProxyStep=t.proxy=t.polymorphicWrap=t.PolymorphicBranchStep=t.polymorphicBranch=t.partitionByIndex=t.operationPlan=t.OperationPlan=void 0;const r=n(22970);n(51086);const a=r.__importDefault(n(25130)),s=n(24586);Object.defineProperty(t,"exportAs",{enumerable:!0,get:function(){return s.exportAs}}),Object.defineProperty(t,"exportAsMany",{enumerable:!0,get:function(){return s.exportAsMany}});const o=n(48285);Object.defineProperty(t,"grafastPrint",{enumerable:!0,get:function(){return o.grafastPrint}});const i=n(3030);Object.defineProperty(t,"makeGrafastSchema",{enumerable:!0,get:function(){return i.makeGrafastSchema}}),a.default.formatters.c=o.grafastPrint;const l=n(47655);Object.defineProperty(t,"defer",{enumerable:!0,get:function(){return l.defer}});const c=n(79554);Object.defineProperty(t,"isDev",{enumerable:!0,get:function(){return c.isDev}}),Object.defineProperty(t,"noop",{enumerable:!0,get:function(){return c.noop}});const u=n(35616);Object.defineProperty(t,"isUnaryStep",{enumerable:!0,get:function(){return u.isUnaryStep}});const p=n(54173);Object.defineProperty(t,"OperationPlan",{enumerable:!0,get:function(){return p.OperationPlan}});const d=n(40549);Object.defineProperty(t,"$$inhibit",{enumerable:!0,get:function(){return d.$$inhibit}}),Object.defineProperty(t,"flagError",{enumerable:!0,get:function(){return d.flagError}}),Object.defineProperty(t,"isSafeError",{enumerable:!0,get:function(){return d.isSafeError}}),Object.defineProperty(t,"SafeError",{enumerable:!0,get:function(){return d.SafeError}});const f=n(11663);Object.defineProperty(t,"execute",{enumerable:!0,get:function(){return f.execute}});const h=n(91457);Object.defineProperty(t,"grafast",{enumerable:!0,get:function(){return h.grafast}}),Object.defineProperty(t,"grafastGraphql",{enumerable:!0,get:function(){return h.grafast}}),Object.defineProperty(t,"grafastGraphqlSync",{enumerable:!0,get:function(){return h.grafastSync}}),Object.defineProperty(t,"grafastSync",{enumerable:!0,get:function(){return h.grafastSync}});const y=n(40354);Object.defineProperty(t,"$$bypassGraphQL",{enumerable:!0,get:function(){return y.$$bypassGraphQL}}),Object.defineProperty(t,"$$eventEmitter",{enumerable:!0,get:function(){return y.$$eventEmitter}}),Object.defineProperty(t,"$$extensions",{enumerable:!0,get:function(){return y.$$extensions}}),Object.defineProperty(t,"$$idempotent",{enumerable:!0,get:function(){return y.$$idempotent}}),Object.defineProperty(t,"$$verbatim",{enumerable:!0,get:function(){return y.$$verbatim}});const b=n(68415);Object.defineProperty(t,"polymorphicWrap",{enumerable:!0,get:function(){return b.polymorphicWrap}});const m=n(28326);Object.defineProperty(t,"assertExecutableStep",{enumerable:!0,get:function(){return m.assertExecutableStep}}),Object.defineProperty(t,"assertListCapableStep",{enumerable:!0,get:function(){return m.assertListCapableStep}}),Object.defineProperty(t,"assertModifierStep",{enumerable:!0,get:function(){return m.assertModifierStep}}),Object.defineProperty(t,"BaseStep",{enumerable:!0,get:function(){return m.BaseStep}}),Object.defineProperty(t,"ExecutableStep",{enumerable:!0,get:function(){return m.ExecutableStep}}),Object.defineProperty(t,"isExecutableStep",{enumerable:!0,get:function(){return m.isExecutableStep}}),Object.defineProperty(t,"isListCapableStep",{enumerable:!0,get:function(){return m.isListCapableStep}}),Object.defineProperty(t,"isListLikeStep",{enumerable:!0,get:function(){return m.isListLikeStep}}),Object.defineProperty(t,"isModifierStep",{enumerable:!0,get:function(){return m.isModifierStep}}),Object.defineProperty(t,"isObjectLikeStep",{enumerable:!0,get:function(){return m.isObjectLikeStep}}),Object.defineProperty(t,"isStreamableStep",{enumerable:!0,get:function(){return m.isStreamableStep}}),Object.defineProperty(t,"ModifierStep",{enumerable:!0,get:function(){return m.ModifierStep}}),Object.defineProperty(t,"UnbatchedExecutableStep",{enumerable:!0,get:function(){return m.UnbatchedExecutableStep}});const g=n(76241);Object.defineProperty(t,"__FlagStep",{enumerable:!0,get:function(){return g.__FlagStep}}),Object.defineProperty(t,"__InputListStep",{enumerable:!0,get:function(){return g.__InputListStep}}),Object.defineProperty(t,"__InputObjectStep",{enumerable:!0,get:function(){return g.__InputObjectStep}}),Object.defineProperty(t,"__InputStaticLeafStep",{enumerable:!0,get:function(){return g.__InputStaticLeafStep}}),Object.defineProperty(t,"__ItemStep",{enumerable:!0,get:function(){return g.__ItemStep}}),Object.defineProperty(t,"__ListTransformStep",{enumerable:!0,get:function(){return g.__ListTransformStep}}),Object.defineProperty(t,"__TrackedValueStep",{enumerable:!0,get:function(){return g.__TrackedValueStep}}),Object.defineProperty(t,"__ValueStep",{enumerable:!0,get:function(){return g.__ValueStep}}),Object.defineProperty(t,"access",{enumerable:!0,get:function(){return g.access}}),Object.defineProperty(t,"AccessStep",{enumerable:!0,get:function(){return g.AccessStep}}),Object.defineProperty(t,"applyTransforms",{enumerable:!0,get:function(){return g.applyTransforms}}),Object.defineProperty(t,"ApplyTransformsStep",{enumerable:!0,get:function(){return g.ApplyTransformsStep}}),Object.defineProperty(t,"assertEdgeCapableStep",{enumerable:!0,get:function(){return g.assertEdgeCapableStep}}),Object.defineProperty(t,"assertNotNull",{enumerable:!0,get:function(){return g.assertNotNull}}),Object.defineProperty(t,"assertPageInfoCapableStep",{enumerable:!0,get:function(){return g.assertPageInfoCapableStep}}),Object.defineProperty(t,"condition",{enumerable:!0,get:function(){return g.condition}}),Object.defineProperty(t,"ConditionStep",{enumerable:!0,get:function(){return g.ConditionStep}}),Object.defineProperty(t,"connection",{enumerable:!0,get:function(){return g.connection}}),Object.defineProperty(t,"ConnectionStep",{enumerable:!0,get:function(){return g.ConnectionStep}}),Object.defineProperty(t,"constant",{enumerable:!0,get:function(){return g.constant}}),Object.defineProperty(t,"ConstantStep",{enumerable:!0,get:function(){return g.ConstantStep}}),Object.defineProperty(t,"context",{enumerable:!0,get:function(){return g.context}}),Object.defineProperty(t,"debugPlans",{enumerable:!0,get:function(){return g.debugPlans}}),Object.defineProperty(t,"each",{enumerable:!0,get:function(){return g.each}}),Object.defineProperty(t,"EdgeStep",{enumerable:!0,get:function(){return g.EdgeStep}}),Object.defineProperty(t,"error",{enumerable:!0,get:function(){return g.error}}),Object.defineProperty(t,"ErrorStep",{enumerable:!0,get:function(){return g.ErrorStep}}),Object.defineProperty(t,"filter",{enumerable:!0,get:function(){return g.filter}}),Object.defineProperty(t,"first",{enumerable:!0,get:function(){return g.first}}),Object.defineProperty(t,"FirstStep",{enumerable:!0,get:function(){return g.FirstStep}}),Object.defineProperty(t,"GraphQLItemHandler",{enumerable:!0,get:function(){return g.GraphQLItemHandler}}),Object.defineProperty(t,"graphqlItemHandler",{enumerable:!0,get:function(){return g.graphqlItemHandler}}),Object.defineProperty(t,"graphqlResolver",{enumerable:!0,get:function(){return g.graphqlResolver}}),Object.defineProperty(t,"GraphQLResolverStep",{enumerable:!0,get:function(){return g.GraphQLResolverStep}}),Object.defineProperty(t,"groupBy",{enumerable:!0,get:function(){return g.groupBy}}),Object.defineProperty(t,"inhibitOnNull",{enumerable:!0,get:function(){return g.inhibitOnNull}}),Object.defineProperty(t,"lambda",{enumerable:!0,get:function(){return g.lambda}}),Object.defineProperty(t,"LambdaStep",{enumerable:!0,get:function(){return g.LambdaStep}}),Object.defineProperty(t,"last",{enumerable:!0,get:function(){return g.last}}),Object.defineProperty(t,"LastStep",{enumerable:!0,get:function(){return g.LastStep}}),Object.defineProperty(t,"list",{enumerable:!0,get:function(){return g.list}}),Object.defineProperty(t,"listen",{enumerable:!0,get:function(){return g.listen}}),Object.defineProperty(t,"ListenStep",{enumerable:!0,get:function(){return g.ListenStep}}),Object.defineProperty(t,"ListStep",{enumerable:!0,get:function(){return g.ListStep}}),Object.defineProperty(t,"listTransform",{enumerable:!0,get:function(){return g.listTransform}}),Object.defineProperty(t,"LoadedRecordStep",{enumerable:!0,get:function(){return g.LoadedRecordStep}}),Object.defineProperty(t,"loadMany",{enumerable:!0,get:function(){return g.loadMany}}),Object.defineProperty(t,"loadManyCallback",{enumerable:!0,get:function(){return g.loadManyCallback}}),Object.defineProperty(t,"loadOne",{enumerable:!0,get:function(){return g.loadOne}}),Object.defineProperty(t,"loadOneCallback",{enumerable:!0,get:function(){return g.loadOneCallback}}),Object.defineProperty(t,"LoadStep",{enumerable:!0,get:function(){return g.LoadStep}}),Object.defineProperty(t,"makeDecodeNodeId",{enumerable:!0,get:function(){return g.makeDecodeNodeId}}),Object.defineProperty(t,"node",{enumerable:!0,get:function(){return g.node}}),Object.defineProperty(t,"NodeStep",{enumerable:!0,get:function(){return g.NodeStep}}),Object.defineProperty(t,"object",{enumerable:!0,get:function(){return g.object}}),Object.defineProperty(t,"ObjectStep",{enumerable:!0,get:function(){return g.ObjectStep}}),Object.defineProperty(t,"operationPlan",{enumerable:!0,get:function(){return g.operationPlan}}),Object.defineProperty(t,"partitionByIndex",{enumerable:!0,get:function(){return g.partitionByIndex}}),Object.defineProperty(t,"polymorphicBranch",{enumerable:!0,get:function(){return g.polymorphicBranch}}),Object.defineProperty(t,"PolymorphicBranchStep",{enumerable:!0,get:function(){return g.PolymorphicBranchStep}}),Object.defineProperty(t,"proxy",{enumerable:!0,get:function(){return g.proxy}}),Object.defineProperty(t,"ProxyStep",{enumerable:!0,get:function(){return g.ProxyStep}}),Object.defineProperty(t,"remapKeys",{enumerable:!0,get:function(){return g.remapKeys}}),Object.defineProperty(t,"RemapKeysStep",{enumerable:!0,get:function(){return g.RemapKeysStep}}),Object.defineProperty(t,"reverse",{enumerable:!0,get:function(){return g.reverse}}),Object.defineProperty(t,"reverseArray",{enumerable:!0,get:function(){return g.reverseArray}}),Object.defineProperty(t,"ReverseStep",{enumerable:!0,get:function(){return g.ReverseStep}}),Object.defineProperty(t,"rootValue",{enumerable:!0,get:function(){return g.rootValue}}),Object.defineProperty(t,"setter",{enumerable:!0,get:function(){return g.setter}}),Object.defineProperty(t,"SetterStep",{enumerable:!0,get:function(){return g.SetterStep}}),Object.defineProperty(t,"sideEffect",{enumerable:!0,get:function(){return g.sideEffect}}),Object.defineProperty(t,"SideEffectStep",{enumerable:!0,get:function(){return g.SideEffectStep}}),Object.defineProperty(t,"specFromNodeId",{enumerable:!0,get:function(){return g.specFromNodeId}}),Object.defineProperty(t,"trackedContext",{enumerable:!0,get:function(){return g.trackedContext}}),Object.defineProperty(t,"trackedRootValue",{enumerable:!0,get:function(){return g.trackedRootValue}}),Object.defineProperty(t,"trap",{enumerable:!0,get:function(){return g.trap}}),Object.defineProperty(t,"TRAP_ERROR",{enumerable:!0,get:function(){return g.TRAP_ERROR}}),Object.defineProperty(t,"TRAP_ERROR_OR_INHIBITED",{enumerable:!0,get:function(){return g.TRAP_ERROR_OR_INHIBITED}}),Object.defineProperty(t,"TRAP_INHIBITED",{enumerable:!0,get:function(){return g.TRAP_INHIBITED}});const S=n(15306);Object.defineProperty(t,"stringifyPayload",{enumerable:!0,get:function(){return S.stringifyPayload}});const P=n(73376);Object.defineProperty(t,"stripAnsi",{enumerable:!0,get:function(){return P.stripAnsi}});const v=n(19569);Object.defineProperty(t,"subscribe",{enumerable:!0,get:function(){return v.subscribe}});const w=n(22722);Object.defineProperty(t,"arrayOfLength",{enumerable:!0,get:function(){return w.arrayOfLength}}),Object.defineProperty(t,"arraysMatch",{enumerable:!0,get:function(){return w.arraysMatch}}),Object.defineProperty(t,"getEnumValueConfig",{enumerable:!0,get:function(){return w.getEnumValueConfig}}),Object.defineProperty(t,"inputObjectFieldSpec",{enumerable:!0,get:function(){return w.inputObjectFieldSpec}}),Object.defineProperty(t,"isPromiseLike",{enumerable:!0,get:function(){return w.isPromiseLike}}),Object.defineProperty(t,"newGrafastFieldConfigBuilder",{enumerable:!0,get:function(){return w.newGrafastFieldConfigBuilder}}),Object.defineProperty(t,"newInputObjectTypeBuilder",{enumerable:!0,get:function(){return w.newInputObjectTypeBuilder}}),Object.defineProperty(t,"newObjectTypeBuilder",{enumerable:!0,get:function(){return w.newObjectTypeBuilder}}),Object.defineProperty(t,"objectFieldSpec",{enumerable:!0,get:function(){return w.objectFieldSpec}}),Object.defineProperty(t,"objectSpec",{enumerable:!0,get:function(){return w.objectSpec}}),Object.defineProperty(t,"stepADependsOnStepB",{enumerable:!0,get:function(){return w.stepADependsOnStepB}}),Object.defineProperty(t,"stepAMayDependOnStepB",{enumerable:!0,get:function(){return w.stepAMayDependOnStepB}}),Object.defineProperty(t,"stepsAreInSamePhase",{enumerable:!0,get:function(){return w.stepsAreInSamePhase}});var O=n(40835);Object.defineProperty(t,"isAsyncIterable",{enumerable:!0,get:function(){return O.isAsyncIterable}}),(0,s.exportAsMany)("grafast",{exportAs:s.exportAs,exportAsMany:s.exportAsMany,grafastPrint:o.grafastPrint,makeGrafastSchema:i.makeGrafastSchema,OperationPlan:p.OperationPlan,defer:l.defer,execute:f.execute,grafast:h.grafast,grafastSync:h.grafastSync,subscribe:v.subscribe,__InputListStep:g.__InputListStep,stringifyPayload:S.stringifyPayload,__InputObjectStep:g.__InputObjectStep,__InputStaticLeafStep:g.__InputStaticLeafStep,assertExecutableStep:m.assertExecutableStep,assertListCapableStep:m.assertListCapableStep,assertModifierStep:m.assertModifierStep,isExecutableStep:m.isExecutableStep,isListCapableStep:m.isListCapableStep,isModifierStep:m.isModifierStep,isObjectLikeStep:m.isObjectLikeStep,isListLikeStep:m.isListLikeStep,isStreamableStep:m.isStreamableStep,__ItemStep:g.__ItemStep,__ListTransformStep:g.__ListTransformStep,__TrackedValueStep:g.__TrackedValueStep,__ValueStep:g.__ValueStep,access:g.access,AccessStep:g.AccessStep,operationPlan:g.operationPlan,connection:g.connection,assertEdgeCapableStep:g.assertEdgeCapableStep,assertPageInfoCapableStep:g.assertPageInfoCapableStep,ConnectionStep:g.ConnectionStep,EdgeStep:g.EdgeStep,condition:g.condition,ConditionStep:g.ConditionStep,constant:g.constant,ConstantStep:g.ConstantStep,context:g.context,rootValue:g.rootValue,trackedContext:g.trackedContext,trackedRootValue:g.trackedRootValue,inhibitOnNull:g.inhibitOnNull,assertNotNull:g.assertNotNull,trap:g.trap,__FlagStep:g.__FlagStep,TRAP_ERROR:g.TRAP_ERROR,TRAP_ERROR_OR_INHIBITED:g.TRAP_ERROR_OR_INHIBITED,TRAP_INHIBITED:g.TRAP_INHIBITED,debugPlans:g.debugPlans,each:g.each,error:g.error,ErrorStep:g.ErrorStep,groupBy:g.groupBy,filter:g.filter,partitionByIndex:g.partitionByIndex,listTransform:g.listTransform,first:g.first,node:g.node,specFromNodeId:g.specFromNodeId,polymorphicBranch:g.polymorphicBranch,PolymorphicBranchStep:g.PolymorphicBranchStep,makeDecodeNodeId:g.makeDecodeNodeId,proxy:g.proxy,applyTransforms:g.applyTransforms,ApplyTransformsStep:g.ApplyTransformsStep,ProxyStep:g.ProxyStep,graphqlResolver:g.graphqlResolver,GraphQLResolverStep:g.GraphQLResolverStep,GraphQLItemHandler:g.GraphQLItemHandler,graphqlItemHandler:g.graphqlItemHandler,NodeStep:g.NodeStep,FirstStep:g.FirstStep,last:g.last,LastStep:g.LastStep,lambda:g.lambda,LambdaStep:g.LambdaStep,sideEffect:g.sideEffect,SideEffectStep:g.SideEffectStep,list:g.list,ListStep:g.ListStep,remapKeys:g.remapKeys,RemapKeysStep:g.RemapKeysStep,object:g.object,ObjectStep:g.ObjectStep,reverse:g.reverse,reverseArray:g.reverseArray,ReverseStep:g.ReverseStep,setter:g.setter,SetterStep:g.SetterStep,listen:g.listen,ListenStep:g.ListenStep,polymorphicWrap:b.polymorphicWrap,stripAnsi:P.stripAnsi,arraysMatch:w.arraysMatch,inputObjectFieldSpec:w.inputObjectFieldSpec,newGrafastFieldConfigBuilder:w.newGrafastFieldConfigBuilder,newInputObjectTypeBuilder:w.newInputObjectTypeBuilder,newObjectTypeBuilder:w.newObjectTypeBuilder,objectFieldSpec:w.objectFieldSpec,objectSpec:w.objectSpec,arrayOfLength:w.arrayOfLength,stepADependsOnStepB:w.stepADependsOnStepB,stepAMayDependOnStepB:w.stepAMayDependOnStepB,stepsAreInSamePhase:w.stepsAreInSamePhase,isPromiseLike:w.isPromiseLike,isDev:c.isDev,noop:c.noop,getEnumValueConfig:w.getEnumValueConfig,loadOne:g.loadOne,loadMany:g.loadMany,loadOneCallback:g.loadOneCallback,loadManyCallback:g.loadManyCallback,LoadedRecordStep:g.LoadedRecordStep,LoadStep:g.LoadStep,isSafeError:d.isSafeError,$$inhibit:d.$$inhibit,flagError:d.flagError,SafeError:d.SafeError,isUnaryStep:u.isUnaryStep});var $=n(90699);Object.defineProperty(t,"hookArgs",{enumerable:!0,get:function(){return $.hookArgs}});var E=n(48651);Object.defineProperty(t,"version",{enumerable:!0,get:function(){return E.version}}),t.deepEval=g.applyTransforms,t.DeepEvalStep=g.ApplyTransformsStep},63881:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inputStep=t.graphqlGetTypeForNode=t.assertInputStep=void 0;const r=n(22970).__importStar(n(45290)),a=n(4730),s=n(57268),o=n(81925),i=n(76241),{assertScalarType:l,GraphQLError:c,GraphQLList:u,GraphQLNonNull:p,isInputType:d,isLeafType:f,isInputObjectType:h,Kind:y}=r;function b(e,t){switch(t.kind){case y.NAMED_TYPE:{const n=e.schema.getType(t.name.value);if(!n)throw new Error(`Could not find type with name '${t.name.value}' in the schema`);return n}case y.LIST_TYPE:return new u(b(e,t.type));case y.NON_NULL_TYPE:return new p(b(e,t.type));default:{const e=t;throw new Error(`Unknown node kind; node: ${(0,a.inspect)(e)}`)}}}function m(e,t,n,r){if(void 0===r&&(r=void 0),void 0===n&&void 0===r)return(0,i.constant)(void 0);const c=h(t);let g=n;if("Variable"===g?.kind){const n=g.name.value,a=e.operation.variableDefinitions?.find((e=>e.variable.name.value===n));if(!a)throw new Error(`No definition for variable '${n}' found`);const s=b(e,a.type);if(!d(s))throw new Error("Expected varible type to be an input type");return S(e,n,s,t,r)}if(g=g??r,t instanceof p){const n=m(e,t.ofType,g,void 0);return n}if(t instanceof u)return new i.__InputListStep(t,g);if(f(t)){if(g?.kind===y.OBJECT||g?.kind===y.LIST){const e=l(t);return new s.__InputDynamicScalarStep(e,g)}return new i.__InputStaticLeafStep(t,g)}if(c)return new o.__InputObjectStep(t,g);{const e=t;throw new Error(`Unsupported type in inputPlan: '${(0,a.inspect)(e)}'`)}}function g(e,t){return e instanceof p&&t instanceof p?g(e.ofType,t.ofType):e instanceof p?g(e.ofType,t):e instanceof u&&t instanceof u?g(e.ofType,t.ofType):e===t}function S(e,t,n,r,a){if(void 0===a&&(a=void 0),n instanceof p&&!(r instanceof p)){return S(e,t,n.ofType,r,a)}if(!g(n,r)){if(r instanceof p&&!(n instanceof p)){const s=S(e,t,n,r.ofType,a);if(s.evalIs(null)||s.evalIs(void 0))throw new c(`Expected non-null value of type ${r.ofType.toString()}`);return s}throw new Error("Expected variable and input types to match")}const s=e.trackedVariableValuesStep.get(t);return void 0!==a&&s.evalIs(void 0)?m(e,r,void 0,a):s}t.assertInputStep=function(e){if(!(e instanceof i.__TrackedValueStep||e instanceof i.__InputListStep||e instanceof i.__InputStaticLeafStep||e instanceof o.__InputObjectStep))throw new Error(`Expected an InputStep, but found ${e}`)},t.graphqlGetTypeForNode=b,t.inputStep=m},4730:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inspect=void 0;try{if(t.inspect=n(70838).inspect,"function"!=typeof t.inspect)throw new Error("Failed to load inspect")}catch{t.inspect=e=>Array.isArray(e)||!e||null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===Object.prototype?JSON.stringify(e):String(e)}},40354:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$$deepDepSkip=t.FORBIDDEN_BY_NULLABLE_BOUNDARY_FLAGS=t.DEFAULT_FORBIDDEN_FLAGS=t.TRAPPABLE_FLAGS=t.DEFAULT_ACCEPT_FLAGS=t.ALL_FLAGS=t.FLAG_STOPPED=t.FLAG_POLY_SKIPPED=t.FLAG_INHIBITED=t.FLAG_NULL=t.FLAG_ERROR=t.NO_FLAGS=t.$$ts=t.$$timeout=t.$$subroutine=t.$$safeError=t.$$proxy=t.$$streamMore=t.$$eventEmitter=t.$$idempotent=t.$$concreteType=t.$$extensions=t.$$data=t.$$bypassGraphQL=t.$$verbatim=t.$$id=t.$$planResults=t.$$grafastContext=t.$$hooked=t.$$cacheByOperation=t.$$queryCache=void 0;const r=n(22970);t.$$queryCache=Symbol("queryCache"),t.$$cacheByOperation=Symbol("cacheByOperation"),t.$$hooked=Symbol("hookArgsApplied"),t.$$grafastContext=Symbol("context"),t.$$planResults=Symbol("planResults"),t.$$id=Symbol("id"),t.$$verbatim=Symbol("verbatim"),t.$$bypassGraphQL=Symbol("bypassGraphQL"),t.$$data=Symbol("data"),t.$$extensions=Symbol("extensions"),t.$$concreteType=Symbol("concreteType"),t.$$idempotent=Symbol("idempotent"),t.$$eventEmitter=Symbol("executionEventEmitter"),t.$$streamMore=Symbol("streamMore"),t.$$proxy=Symbol("proxy"),t.$$safeError=Symbol("safeError"),t.$$subroutine=Symbol("subroutine"),t.$$timeout=Symbol("timeout"),t.$$ts=Symbol("timestamp"),t.NO_FLAGS=0,t.FLAG_ERROR=1,t.FLAG_NULL=2,t.FLAG_INHIBITED=4,t.FLAG_POLY_SKIPPED=8,t.FLAG_STOPPED=16,t.ALL_FLAGS=t.FLAG_ERROR|t.FLAG_NULL|t.FLAG_INHIBITED|t.FLAG_POLY_SKIPPED|t.FLAG_STOPPED,t.DEFAULT_ACCEPT_FLAGS=t.FLAG_NULL,t.TRAPPABLE_FLAGS=t.FLAG_ERROR|t.FLAG_NULL|t.FLAG_INHIBITED,t.DEFAULT_FORBIDDEN_FLAGS=t.ALL_FLAGS&~t.DEFAULT_ACCEPT_FLAGS,t.FORBIDDEN_BY_NULLABLE_BOUNDARY_FLAGS=t.FLAG_NULL|t.FLAG_POLY_SKIPPED,r.__exportStar(n(3067),t),t.$$deepDepSkip=Symbol("deepDepSkip_experimental")},3030:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeGrafastSchema=void 0;const r=n(22970),a=n(45290),s=r.__importStar(n(45290)),o=n(22722),{buildASTSchema:i,isEnumType:l,isInputObjectType:c,isInterfaceType:u,isObjectType:p,isScalarType:d,isUnionType:f,parse:h}=s;t.makeGrafastSchema=function(e){const{typeDefs:t,plans:n,enableDeferStream:r=!1}=e,y=i(h(t),{enableDeferStream:r}).toConfig(),b=new Map;function m(e){if(s.isNonNullType(e))return new s.GraphQLNonNull(m(e.ofType));if(s.isListType(e))return new s.GraphQLList(m(e.ofType));{const t=b.get(e.name);if(!t)throw new Error(`Failed to find replaced type '${e.name}'`);return t}}for(const[e,t]of Object.entries(n)){const t=y.types.findIndex((t=>t.name===e));y.types[t]||console.warn(`'plans' specified configuration for type '${e}', but that type was not present in the schema`)}const g=["String","Int","Float","Boolean","ID"],S=y.types;if(y.types=S.map((e=>{const t=e.name,r=(()=>{if(t.startsWith("__")||g.includes(t))return e;if(p(e)){const r=e.toConfig(),a=n[e.name],i=r.fields,l=r.interfaces,c={...r,extensions:{...r.extensions}};if(a)for(const[e,n]of Object.entries(a)){if("__assertStep"===e){(0,o.exportNameHint)(n,`${t}_assertStep`),c.extensions.grafast={assertStep:n};continue}if(e.startsWith("__"))throw new Error(`Unsupported field name '${e}'; perhaps you meant '__assertStep'?`);const r=n,a=i[e];if(a){if("args"in r&&"object"==typeof r.args&&null!=r.args)for(const[n,s]of Object.entries(r.args)){const r=a.args?.[n];r||console.warn(`'plans' specified configuration for object type '${t}' field '${e}' arg '${n}', but that arg was not present in the type`)}}else console.warn(`'plans' specified configuration for object type '${t}' field '${e}', but that field was not present in the type`)}return c.interfaces=function(){return l.map((e=>m(e)))},c.fields=function(){const e=Object.create(null);for(const[n,r]of Object.entries(i)){if(n.startsWith("__"))continue;const s=a?.[n],i={...r,type:m(r.type)};if(e[n]=i,s)if("function"==typeof s)(0,o.exportNameHint)(s,`${t}_${n}_plan`),i.extensions.grafast={plan:s};else{const e=Object.create(null);if(i.extensions.grafast=e,"function"==typeof s.resolve&&((0,o.exportNameHint)(s.resolve,`${t}_${n}_resolve`),i.resolve=s.resolve),"function"==typeof s.subscribe&&((0,o.exportNameHint)(s.subscribe,`${t}_${n}_subscribe`),i.subscribe=s.subscribe),"function"==typeof s.plan&&((0,o.exportNameHint)(s.plan,`${t}_${n}_plan`),e.plan=s.plan),"function"==typeof s.subscribePlan&&((0,o.exportNameHint)(s.subscribePlan,`${t}_${n}_subscribePlan`),e.subscribePlan=s.subscribePlan),i.args)for(const[e,r]of Object.entries(i.args)){r.type=m(r.type);const a=s.args?.[e];if("function"==typeof a)throw new Error(`Invalid configuration for plans.${t}.${n}.args.${e} - saw a function, but expected an object with 'inputPlan' (optional) and 'applyPlan' (optional) plans`);if(a){(0,o.exportNameHint)(a.applyPlan,`${t}_${n}_${e}_applyPlan`),(0,o.exportNameHint)(a.inputPlan,`${t}_${n}_${e}_inputPlan`);const s=Object.create(null);r.extensions.grafast=s,Object.assign(s,a)}}}}return e},new s.GraphQLObjectType(c)}if(c(e)){const r=e.toConfig(),a={...r,extensions:{...r.extensions,grafast:{...r.extensions?.grafast}}},i=n[e.name];if(i)for(const[e,n]of Object.entries(i)){if("__inputPlan"===e){a.extensions.grafast.inputPlan=n;continue}if(r.fields[e]){if("function"==typeof n)throw new Error(`Expected input object type '${t}' field '${e}' to be an object, but found a function. We don't know if this should be the 'inputPlan' or 'applyPlan' - please supply an object.`)}else console.warn(`'plans' specified configuration for input object type '${t}' field '${e}', but that field was not present in the type`)}const l=r.fields;return a.fields=function(){const e=Object.create(null);for(const[n,r]of Object.entries(l)){const a=i?.[n],s={...r,type:m(r.type)};e[n]=s,a&&((0,o.exportNameHint)(a.inputPlan,`${t}_${n}_inputPlan`),(0,o.exportNameHint)(a.applyPlan,`${t}_${n}_applyPlan`));const l=Object.create(null);s.extensions.grafast=l,Object.assign(l,a)}return e},new s.GraphQLInputObjectType(a)}if(u(e)){const r=e.toConfig(),a={...r},i=r.fields;a.fields=function(){const e=Object.create(null);for(const[t,n]of Object.entries(i)){const r={...n,type:m(n.type)};if(e[t]=r,r.args)for(const[e,t]of Object.entries(r.args))t.type=m(t.type)}return e};const l=r.interfaces;a.interfaces=function(){return l.map((e=>m(e)))};const c=n[e.name];return c?.__resolveType&&((0,o.exportNameHint)(c.__resolveType,`${t}_resolveType`),a.resolveType=c.__resolveType),new s.GraphQLInterfaceType(a)}if(f(e)){const r=e.toConfig(),a={...r},i=r.types;a.types=function(){return i.map((e=>m(e)))};const l=n[e.name];return l?.__resolveType&&((0,o.exportNameHint)(l.__resolveType,`${t}_resolveType`),a.resolveType=l.__resolveType),new s.GraphQLUnionType(a)}if(d(e)){const r=e.toConfig(),a={...r,extensions:{...r.extensions}},i=n[e.name];return"function"==typeof i?.serialize&&((0,o.exportNameHint)(i.serialize,`${t}_serialize`),a.serialize=i.serialize),"function"==typeof i?.parseValue&&((0,o.exportNameHint)(i.parseValue,`${t}_parseValue`),a.parseValue=i.parseValue),"function"==typeof i?.parseLiteral&&((0,o.exportNameHint)(i.parseLiteral,`${t}_parseLiteral`),a.parseLiteral=i.parseLiteral),"function"==typeof i?.plan&&((0,o.exportNameHint)(i.plan,`${t}_plan`),a.extensions.grafast={plan:i.plan}),new s.GraphQLScalarType(a)}if(l(e)){const r={...e.toConfig()},a=n[e.name],i=r.values;if(a)for(const[e,n]of Object.entries(a)){const r=i[e];r?"function"==typeof n?((0,o.exportNameHint)(n,`${t}_${e}_applyPlan`),r.extensions||(r.extensions=Object.create(null)),r.extensions.grafast={applyPlan:n}):"object"==typeof n&&null!=n?(n.applyPlan&&((0,o.exportNameHint)(n.applyPlan,`${t}_${e}_applyPlan`),r.extensions.grafast={applyPlan:n.applyPlan}),"value"in n&&(r.value=n.value)):r.value=n:console.warn(`'plans' specified configuration for enum type '${t}' value '${e}', but that value was not present in the type`)}return new s.GraphQLEnumType(r)}throw new Error(`Unhandled type ${e}`)})();return b.set(t,r),r})),y.query&&(y.query=m(y.query)),y.mutation&&(y.mutation=m(y.mutation)),y.subscription&&(y.subscription=m(y.subscription)),y.directives)for(const e of y.directives)for(const t of e.args)t.type=m(t.type);return new a.GraphQLSchema(y)}},79912:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.planToMermaid=t.mermaidEscape=t.COLORS=void 0;const r=n(22970),a=n(73376);t.COLORS=["#696969","#00bfff","#7f007f","#ffa500","#0000ff","#7fff00","#ff1493","#808000","#dda0dd","#ff0000","#ffff00","#00ffff","#4169e1","#3cb371","#a52a2a","#ff00ff","#f5deb3"];function s(e){return e?e.map((e=>`${e}`)).join("\n"):""}t.mermaidEscape=e=>e.match(/^[a-z0-9 ]+$/i)?e:`"${(0,a.stripAnsi)(e.trim()).replace(/[#"<>]/g,(e=>({"#":"ꖛ",'"':"”","<":"ᐸ",">":"ᐳ"}[e]))).replace(/\r?\n/g,"<br />")}"`,t.planToMermaid=function(e,r){let{concise:o=!1,skipBuckets:i=n.g.grafastExplainMermaidSkipBuckets??!1}=void 0===r?{}:r;if("v1"!==e.version)throw new Error("planToMermaid only supports v1 plan JSON");const l=Object.create(null),c=Object.create(null),u=Object.create(null),p=[],d=e=>{c[e.id]=e;const t=[...e.steps].sort(((e,t)=>t.dependencyIds.length-e.dependencyIds.length));for(const e of t){if(l[e.id])throw new Error(`Step ${e.id} (${e.stepClass}/${e.metaString}) duplicated in plan?!`);l[e.id]=e,p.push(e);for(const t of e.dependencyIds)u[t]?u[t].push(e):u[t]=[e]}for(const t of e.children)d(t)};d(e.rootBucket);const f=e=>t.COLORS[e%t.COLORS.length],h=["%%{init: {'themeVariables': { 'fontSize': '12px'}}}%%",(o?"flowchart":"graph")+" TD","    classDef path fill:#eee,stroke:#000,color:#000","    classDef plan fill:#fff,stroke-width:1px,color:#000","    classDef itemplan fill:#fff,stroke-width:2px,color:#000","    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000","    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000","    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left",""],y=Object.create(null),b=e=>{if(!y[e.id]){const c=e.stepClass.replace(/Step$/,""),u=`${c}${e.id}`;y[e.id]=u;const p=e.metaString,d=null!=p?(0,a.stripAnsi)(p):null,f=o&&d?(void 0===r&&(r=8),void 0===i&&(i=8),(n=d).length>r+i+4?`${n.slice(0,r)}...${n.slice(n.length-i)}`:n):d,b=e.supportsUnbatched,m=s(e.polymorphicPaths),g=1===e.dependencyIds.length&&s(l[e.dependencyIds[0]].polymorphicPaths)===m?"":`\n${m}`,S=`${c}[${e.id}∈${e.bucketId}]${f?`\n<${f}>`:""}${g}`,[P,v]="__ItemStep"===e.stepClass?["[/","\\]"]:e.isSyncAndSafe?b?["{{","}}"]:["[","]"]:["[[","]]"],w=e.hasSideEffects?"sideeffectplan":"__ItemStep"===e.stepClass?"itemplan":b&&!e.isSyncAndSafe?"unbatchedplan":"plan";h.push(`    ${u}${P}${(0,t.mermaidEscape)(S)}${v}:::${w}`)}var n,r,i;return y[e.id]};h.push(""),h.push("    %% plan dependencies");const m=Object.create(null),g=(e,n)=>{const r=e.dependencyForbiddenFlags[n],s=e.dependencyOnReject[n],o=[];r&&(2==(2&r)&&o.push("rejectNull"),0==(1&r)&&o.push("trapError"),0==(4&r)&&o.push("trapInhibited"),s&&o.push(`onReject=${function(e,t){void 0===t&&(t=15);return e.length>t?e.substring(0,t-2)+"…":e}((0,a.stripAnsi)(s))}`));const i=o.join(";");return i?`|${(0,t.mermaidEscape)(i)}|`:""};p.forEach((e=>{const t=b(e),n=e.dependencyIds.map((e=>b(l[e])));if(n.length>0)if("__ItemStep"===e.stepClass){const[r,...a]=n,s=null==e.extra?.transformStepId?"==>":"-.->";if(h.push(`    ${r} ${s}${g(e,0)} ${t}`),a.length>0){const n=[];for(let r=0;r<a.length;r++){const s=a[r],o=g(e,r+1);o?h.push(`    ${s} --\x3e${o} ${t}`):n.push(s)}n.length&&h.push(`    ${n.join(" & ")} --\x3e ${t}`)}}else if(o&&!u[e.id]&&1===n.length){const r=n[0];void 0===m[r]?h.push(`    ${r} --\x3e${g(e,0)} ${t}`):h.push(`    ${m[r]} o--o${g(e,0)} ${t}`),m[r]=t}else{const r=[];for(let a=0;a<n.length;a++){const s=n[a],o=g(e,a+1);o?h.push(`    ${s} --\x3e${o} ${t}`):r.push(s)}r.length&&h.push(`    ${r.join(" & ")} --\x3e ${t}`)}return e})),h.push(""),h.push("    %% define steps"),p.forEach((e=>{b(e)})),h.push(""),o||i||h.push("    subgraph Buckets");const S=Object.values(c);for(let e=0,n=S.length;e<n;e++){const n=S[e],r=n.steps,a=` (${n.reason.type})`+("polymorphic"===n.reason.type?`\n${n.reason.typeNames}`:""),o=[];i||h.push(`    Bucket${n.id}(${(0,t.mermaidEscape)(`Bucket ${n.id}${a}${n.copyStepIds.length>0?`\nDeps: ${n.copyStepIds.map((e=>l[e].id)).join(", ")}\n`:""}${"polymorphic"===n.reason.type?s(n.reason.polymorphicPaths):""}${null!=n.rootStepId&&"root"!==n.reason.type?"\nROOT "+(P=l[n.rootStepId],`${P.stepClass.replace(/Step$/,"")}${0===P.bucketId?"":`{${P.bucketId}}`}${P.metaString?`<${P.metaString}>`:""}[${P.id}]`):""}${v(n)}\n${o.join("\n")}`)}):::bucket`),h.push(`    classDef bucket${n.id} stroke:${f(n.id)}`),h.push(`    class ${[`Bucket${n.id}`,...r.map(b)].join(",")} bucket${n.id}`)}var P;if(!i)for(let e=0,t=S.length;e<t;e++){const t=S[e],n=t.children.map((e=>`Bucket${e.id}`));n.length>0&&h.push(`    Bucket${t.id} --\x3e ${n.join(" & ")}`)}return h.push(`    classDef unary fill:#fafffa,borderWidth:8px\n    class ${p.filter((e=>e.isUnary)).map(b)} unary`),o||i||h.push("    end"),h.join("\n");function v(e){function t(e){return`${e.stepClass.replace(/Step$/,"")??""}[${e.id}]`}function n(e){if(!e)return"";const n=e.map(t).join(", ");return n.length<40?n:e.map((e=>e.id)).join(", ")}return 1===e.phases.length?"":`\n${e.phases.map(((e,t)=>`${t+1}: ${n(e.normalStepIds?.map((e=>l[e])))}${e.unbatchedStepIds?`\n>: ${n(e.unbatchedStepIds.map((e=>l[e])))}`:""}`)).join("\n")}`}},r.__exportStar(n(3067),t)},86780:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.withFieldArgsForArguments=void 0;const r=n(22970).__importStar(n(45290)),a=n(20353),s=n(30910),o=n(40058),{getNullableType:i,isEnumType:l,isInputObjectType:c,isListType:u,isScalarType:p}=r;function d(e,t,n,r,s){if(null!=n&&!(n instanceof a.ConstantStep&&n.isNull()))if("autoApplyAfterParentApplyPlan"===s&&null!=n)for(const a of Object.keys(r))e.apply(n,[...t,a]);else for(const[a,o]of Object.entries(r)){("autoApplyAfterParentPlan"===s?o.extensions.grafast?.autoApplyAfterParentPlan:"autoApplyAfterParentSubscribePlan"===s?o.extensions.grafast?.autoApplyAfterParentSubscribePlan:"autoApplyAfterParentInputPlan"===s?o.extensions.grafast?.autoApplyAfterParentInputPlan:"autoApplyAfterParentApplyPlan"===s?o.extensions.grafast?.autoApplyAfterParentApplyPlan:null)&&e.apply(n,[...t,a])}}function f(e,t){return[...e,...Array.isArray(t)?t:t?[t]:[]]}t.withFieldArgsForArguments=function(e,t,n,r,y,b){null!==e.loc&&e.loc.push(`withFieldArgsForArguments(${r.name})`);const m=e.schema,g=Object.create(null);for(const e of r.args)g[e.name]=e;const S=new Map,P=new Map;let v=!1;const w={getRaw(e){if("string"==typeof e)return n.get(e);if(Array.isArray(e)){const[t,...r]=e;if(!t)throw new Error("getRaw() must be called with a non-empty path");let a=n.get(t);for(const t of r)if("number"==typeof t&&"at"in a)a=a.at(t);else{if(!("get"in a))throw new Error(`'getRaw' path must only relate to input objects right now; path was: '${e}' (failed at '${t}')`);a=a.get(t)}return a}throw new Error("Invalid path")},get(e){const r=Array.isArray(e)?e:e?[e]:[],s=r.join("."),l=S.get(s);if(l)return l;if(0===r.length){const e=Object.create(null);for(const t of Object.keys(g))e[t]=w.get([t]);return(0,o.object)(e)}{const[e,...s]=r;if("string"!=typeof e)throw new Error(`Invalid path; argument '${e}' is an invalid argument name`);let o=g[e];if(!o)throw new Error(`Invalid path; argument '${e}' does not exist`);let l,p=o.type,f=n.get(e);for(const e of s){const t=i(p);if("string"==typeof e&&c(t))if(o=t.getFields()[e],p=o.type,"get"in f)f=f.get(e);else{if(!(f instanceof a.ConstantStep&&f.isUndefined()))throw new Error(`GrafastInternalError<b9e9a57a-bbdd-486c-bdcf-25cf99bf0243>: Processing input object type, but '${f}' has no .get() method.`);f=(0,a.constant)(void 0)}else{if("number"!=typeof e||!u(t))throw new Error(`Asked to navigate ('get' mode) to position '${e}' (${typeof e}) (in path '${r.join(".")}') for incompatible type '${t}' (${t.constructor.name})`);if(o=null,p=t.ofType,!("at"in f))throw new Error(`GrafastInternalError<0abe76fa-c87a-4477-aebd-feffef848c2b>: Processing input object type, but '${f}' has no .get() method.`);f=f.at(e)}}const h=O(r,p,f,"input");if(0===s.length){const e=o;l=e.extensions.grafast?.inputPlan?e.extensions.grafast.inputPlan(t,h,{schema:m,entity:e}):h.get()}else{const e=o;l=e?.extensions.grafast?.inputPlan?e.extensions.grafast.inputPlan(h,{schema:m,entity:e}):h.get()}const y=i(p);return c(y)&&d(w,r,l,y.getFields(),"autoApplyAfterParentInputPlan"),l}},apply(r,a){const s=Array.isArray(a)?a:a?[a]:[],o=s.join("."),l=P.get(o);if(l)throw new Error(`Attempted to apply 'applyPlan' at input path ${o} more than once - first time to ${l}, second time to ${r}. Multiple applications are not currently supported.`);if(0===s.length){v=!0;for(const e of Object.keys(g)){const t="function"==typeof r?r():r;w.apply(t,[e])}}else{const[a,...o]=s;let l=g[a];if(!l)throw new Error(`Invalid path; argument '${a}' does not exist`);let f=l.type,h=n.get(a);for(const e of o){const t=i(f);if(c(t)){if(l=t.getFields()[e],f=l.type,!("get"in h))throw new Error(`GrafastInternalError<91e1e80d-cf24-4828-a749-3f24156c7b9c>: Processing input object type, but '${h}' has no .get() method.`);h=h.get(e)}else{if("number"!=typeof e||!u(t))throw new Error(`Asked to navigate ('apply' mode) to position '${e}' (${typeof e}) (in path '${s.join(".")}') for incompatible type '${t}' (${t.constructor.name})`);if(l=null,f=t.ofType,!("at"in h))throw new Error(`GrafastInternalError<a097a130-f68f-4a5c-bd0c-24fcd26127a9>: Processing list type, but '${h}' has no .at() method.`);h=h.at(e)}}if(!("evalIs"in(p=h))||!p.evalIs(void 0)){const n=O(s,f,h,"apply");e.withModifiers((()=>{let e;const a="function"==typeof r?r():r;if(0===o.length){const r=l;e=r.extensions.grafast?.applyPlan?r.extensions.grafast.applyPlan(t,a,n,{schema:m,entity:r}):void 0}else{if(!l)return void n.apply(a);{const t=l;e=t.extensions.grafast?.applyPlan?t.extensions.grafast.applyPlan(a,n,{schema:m,entity:t}):void 0}}const u=i(f);c(u)&&d(w,s,e,u.getFields(),"autoApplyAfterParentApplyPlan")}))}}var p}};for(const e of Object.keys(g)){let t;Object.defineProperty(w,`$${e}`,{get:()=>(t||(t=w.getRaw(e)),t)})}function O(e,t,n,r){const o=i(t),y={getRaw:t=>w.getRaw(f(e,t)),get(t){if(!t||Array.isArray(t)&&0===t.length){if(u(o)){if(!("evalLength"in n))throw new Error(`GrafastInternalError<6ef74af7-7be0-4117-870f-2ebabcf5161c>: Expected ${n} to be a __InputListStep or __TrackedValueStep (i.e. to have 'evalLength')`);const t=n.evalLength();if(null==t)return(0,a.constant)(null);const r=[];for(let n=0;n<t;n++){const t=w.get([...e,n]);r.push(t)}return(0,s.list)(r)}if(c(o)){const t=(o.extensions.grafast?.inputPlan||h)(O(e,o,n,"input"),{schema:m,type:o});return"apply"===r&&d(w,e,t,o.getFields(),"autoApplyAfterParentInputPlan"),t}if(p(o)){const e=o.extensions.grafast?.inputPlan;return void 0!==e?e(n,{schema:m,type:o}):n}if(l(o))return n;throw new Error(`Call to fieldArgs.get() at input path '${e.join(".")}' must pass a non-empty subpath`)}return w.get(f(e,t))},apply(t,a){if("apply"===r&&(!a||Array.isArray(a)&&0===a.length))if(c(o))for(const n of Object.keys(o.getFields())){const r="function"==typeof t?t():t;w.apply(r,[...e,n])}else if(u(o)){if(!("evalLength"in n))throw new Error(`GrafastInternalError<6ef74af7-7be0-4117-870f-2ebabcf5161c>: Expected ${n} to be a __InputListStep or __TrackedValueStep (i.e. to have 'evalLength')`);const r=n.evalLength();if(null==r)return;for(let n=0;n<r;n++){const r="function"==typeof t?t():t;w.apply(r,[...e,n])}}else if(p(o));else{if(!l(o)){throw new Error(`Unhandled input type ${o}`)}{const e=n.eval(),r=o.getValues().find((t=>t.value===e)),a=r?.extensions.grafast?.applyPlan;if(void 0!==a){a("function"==typeof t?t():t)}}}else{const n="function"==typeof t?t():t;w.apply(n,f(e,a))}}};if(c(o)){const e=o.getFields();for(const t of Object.keys(e)){let e;Object.defineProperty(y,`$${t}`,{enumerable:!0,get(){if(!e)if("get"in n)e=n.get(t);else{if(!(n instanceof a.ConstantStep&&n.isUndefined()))throw new Error(`GrafastInternalError<9b70d5c0-c45f-4acd-8b94-eaa02f87ad41>: expected '${n}' to have a .get() method`);e=(0,a.constant)(void 0)}return e}})}}return y}const $=b(w);return v||d(w,[],$,g,y),null!==e.loc&&e.loc.pop(),$??null};const h=(e,t)=>{const n=t.type.getFields(),r=Object.create(null);for(const t in n)r[t]=e.get(t);return(0,o.object)(r)}},3067:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},68415:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolveType=t.polymorphicWrap=t.assertPolymorphicData=t.isPolymorphicData=void 0;const r=n(4730),a=n(40354);function s(e){return"object"==typeof e&&null!==e&&"string"==typeof e[a.$$concreteType]}function o(e){if(!s(e))throw new Error(`Expected a polymorphic object, received ${(0,r.inspect)(e)}`)}t.isPolymorphicData=s,t.assertPolymorphicData=o,t.polymorphicWrap=function(e,t){if(void 0===t&&(t=Object.create(null)),"string"!=typeof e)throw new Error(`Expected a GraphQLObjectType name, but received ${(0,r.inspect)(e)}`);if(null==t)throw new Error("polymorphicWrap mustn't receive null-like data");return Object.defineProperty(t,a.$$concreteType,{value:e,enumerable:!1,writable:!1,configurable:!1}),t},t.resolveType=function(e){return o(e),e[a.$$concreteType]}},37433:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.grafastPrepare=void 0;const r=n(22970),a=r.__importStar(n(45290)),s=n(92009),o=n(40835),i=r.__importStar(n(48282)),l=n(47655),c=n(79554),u=n(61258),p=n(80569),d=n(54173),f=n(38769),h=n(96574),y=n(40354),b=n(62408),m=n(22722),{GraphQLError:g}=a,S=Symbol("contextPlanCache"),P=Symbol("bypassGraphQL"),v=Object.assign(Object.create(null),{[P]:!0});function w(){}function O(e,t,n){const{streams:r,queue:a}=e.root;c.isDev&&(Object.freeze(r),Object.freeze(a));const s=[];for(const a of r)s.push(I(e.requestContext,t,a,n));for(const r of a)s.push(B(e.requestContext,t,r,n));if(0!==s.length)return Promise.all(s).then(w)}function $(e,t,n){const r=e.iterators[t];if(r){if(n)for(const e of n){const{stream:t}=e;r.delete(t)||console.error("GrafastInternalError<1e43efdf-f901-43dd-8a82-768246e61478>: Stream was returned from an output plan, but that stream wasn't tracked via the bucket.")}if(r.size>0)for(const e of r)e.return?e.return():e.throw&&e.throw(new Error("Iterator no longer needed (due to OutputPlan branch being skipped)"))}else n&&n.length>0&&console.error("GrafastInternalError<c3f57a2b-159d-49a9-924b-8e753696de06>: Untracked stream detected!")}const E=(e,t,n,r)=>{if((0,o.isAsyncIterable)(e))throw i.strictEqual(t.root.queue.length,0,"Subscription cannot also queue"),new Error("TODO<172acb34-c9d4-48f5-a26f-1b37260ecc14>: subscription");if(t.root.streams.length>0||t.root.queue.length>0){let a=!0;const s=x((()=>{a=!1})),o=Object.create(null);void 0!==e&&(o.data=e);const i=t.root.errors;i.length>0&&(o.errors=i),null!=n&&(o.extensions=n),o.hasNext=!0,s.push(o);const l=O(t,s,r);return(0,m.isPromiseLike)(l)?l.then((()=>{s.push({hasNext:!1}),s.return(void 0)}),(e=>{s.throw(e)})):(s.push({hasNext:!1}),s.return(void 0)),s}{const r=Object.create(null);void 0!==e&&(r.data=e);const a=t.root.errors;return a.length>0&&(r.errors=a),void 0!==n&&(r.extensions=n),r}};function _(e,t,n,r,a,s,o){const i=t.layerPlan.operationPlan,l={requestContext:r,root:{insideGraphQL:!1,errors:[],queue:[],streams:[],variables:s},path:a};let c,u;if(e.layerPlan===t.layerPlan)c=t,u=n;else{const r=(0,f.getChildBucketAndIndex)(e,null,t,n,null);if(!r)throw new Error("GrafastInternalError<8bbf56c1-8e2a-4ee9-b5fc-724fd0ee222b>: could not find relevant bucket for output plan");[c,u]=r}try{return[l,(0,p.executeOutputPlan)(l,e,c,u,o)??null]}catch(e){const t=(0,f.coerceError)(e,i.rootOutputPlan.locationDetails,[]);return l.root.errors.push(t),[l,null]}finally{$(t,n,l.root.streams)}}function x(e){const t=[],n=[];let r=!1;return{[Symbol.asyncIterator](){return this},push(e){if(r)return void console.warn("GrafastWarning<85e02385-d3d2-48a1-b791-b4cf87817899>: value pushed into iterable after done; ignoring");const a=n.shift();void 0!==a?(0,m.isPromiseLike)(e)?e.then((e=>a[0]({done:r,value:e})),(e=>{try{const t=a[1](e);(0,m.isPromiseLike)(t)&&t.then(null,w)}catch(e){}this.throw(e)})):a[0]({done:r,value:e}):t.push(e)},next:()=>t.length>0?Promise.resolve(t.shift()).then((e=>({done:!1,value:e}))):r?Promise.resolve({done:!0,value:void 0}):new Promise(((e,t)=>{n.push([e,t])})),return(){if(!r){r=!0,e();for(const e of n)try{e[0]({done:r,value:void 0})}catch(e){}}return Promise.resolve({done:!0,value:void 0})},throw(t){if(!r){r=!0,e(t);for(const e of n)try{e[0]({done:r,value:void 0})}catch(t){}}return Promise.reject(t)}}}async function I(e,t,n,r){const a=(0,l.defer)();let s=null,o=null;let c=0;const p=()=>{c--,h&&c<=0&&a.resolve()},d=()=>{o=null,i.ok(s,"GrafastInternalError<bcf5cef8-2c60-419e-b942-14fd34b8caa7>: processQueue called with no queue");const l=s;s=null;try{const s=(a=>{const s=a.length,o=new Map,l=[],c=[];let p=n.outputPlan.layerPlan;for(;p.parentLayerPlan!==n.bucket.layerPlan;){const e=p.parentLayerPlan;if(!e)throw new Error(`GrafastInternalError<f6179ee1-ace2-429c-8f30-8fe6cd53ed03>: Invalid heirarchy - could not find direct layerPlan child of ${n.bucket.layerPlan}`);p=e}const{id:d,_isUnary:f}=p.rootStep;for(const e of p.copyStepIds){const t=n.bucket.store.get(e);if(!t)throw new Error(`GrafastInternalError<2db7b749-399f-486b-bd12-7ca337b937e4>: ${n.bucket.layerPlan} doesn't seem to include ${e} (required by ${p} via ${n.outputPlan})`);if(t.isBatch){const r=(0,m.arrayOfLength)(s,t.at(n.bucketIndex));o.set(e,(0,u.batchExecutionValue)(r))}else o.set(e,t)}if(f)i.ok(0===a.length,"Unary step should only have one index"),o.set(d,(0,u.unaryExecutionValue)(a[0][0]));else{const e=a.map((e=>e[0]));o.set(d,(0,u.batchExecutionValue)(e))}for(let e=0;e<s;e++)l[e]=n.bucket.polymorphicPathList[n.bucketIndex],c[e]=new Set;const h=(0,u.newBucket)({layerPlan:p,size:s,store:o,flagUnion:0,polymorphicPathList:l,iterators:c},n.bucket.metaByMetaKey),y=(0,u.executeBucket)(h,e),b=()=>{const o=[];for(let i=0;i<s;i++){const s=a[i][1],[l,c]=_(n.outputPlan,h,i,e,[...n.path,s],n.root.variables,r),u=Object.create(null);void 0!==c&&(u.data=c),u.hasNext=!0,null!=n.label&&(u.label=n.label),l.root.errors.length>0&&(u.errors=l.root.errors),u.path=l.path,t.push(u);const p=O(l,t,r);(0,m.isPromiseLike)(p)&&o.push(p)}if(0!==o.length)return Promise.all(o).then(w)};return(0,m.isPromiseLike)(y)?y.then(b):b()})(l);(0,m.isPromiseLike)(s)?s.then(p,(e=>{a.reject(e)})):p()}catch(e){a.reject(e)}},f=(e,t)=>{null!==s?s.push([e,t]):(c++,s=[[e,t]],o=setTimeout(d,1))};let h=!1;try{let e,t=n.startIndex;for(;e=n.stream.next();){const n=await e;if(n.done)break;f(n.value,t),t++}}finally{h=!0,0===c&&a.resolve()}return a}function L(e,t,n,r){const a=n.length,s=new Map,o=[],i=[],l=n[0][1].bucket;if(c.isDev)for(const e of n)if(e[1].bucket!==l)throw new Error("GrafastInternalError<c277422e-adb7-4b07-861e-acab931fc01a>: sorry, it seems the unary dependencies feature broke our incremental delivery support. This incremental delivery is going to be fully rewritten at some point anyway, so we recommend you avoid using it for now (the spec itself has changed since we implemented it).");for(const e of t.layerPlan.copyStepIds){const t=l.store.get(e);if(t.isBatch){const r=n.map((e=>{let[,n]=e;return t.at(n.bucketIndex)}));s.set(e,(0,u.batchExecutionValue)(r))}else s.set(e,t)}for(let e=0;e<a;e++){const t=n[e][1];o[e]=t.bucket.polymorphicPathList[t.bucketIndex],i[e]=new Set}const p=(0,u.newBucket)({layerPlan:t.layerPlan,size:a,store:s,flagUnion:0,polymorphicPathList:o,iterators:i},null),d=(0,u.executeBucket)(p,e),f=()=>{const t=[];for(let s=0;s<a;s++){const[a,o]=n[s],[i,l]=_(o.outputPlan,p,s,e,o.path,o.root.variables,r),c=Object.create(null);void 0!==l&&(c.data=l),c.hasNext=!0,null!=o.label&&(c.label=o.label),i.root.errors.length>0&&(c.errors=i.root.errors),c.path=i.path,a.push(c);const u=O(i,a,r);(0,m.isPromiseLike)(u)&&t.push(u)}if(0!==t.length)return Promise.all(t).then(w)};return(0,m.isPromiseLike)(d)?d.then(f):f()}function k(e,t,n){const r=[];for(const[t,a]of e.entries())for(const[e,s]of a.entries()){const a=L(t,e,s,n);(0,m.isPromiseLike)(a)&&r.push(a)}r.length>0?Promise.all(r).then((()=>t.resolve()),(e=>t.reject(e))):t.resolve()}function j(){const e=T;T=new Map;const t=N;N=null,k(e,t,!0)}function A(){const e=R;R=new Map;const t=D;D=null,k(e,t,!1)}t.grafastPrepare=function(e,t){void 0===t&&(t={});const{schema:n,contextValue:r,rootValue:a=Object.create(null)}=e,i=(0,s.buildExecutionContext)(e);if(Array.isArray(i)||"length"in i)return Object.assign(Object.create(v),{errors:i,extensions:a[y.$$extensions]});const{operation:c,fragments:p,variableValues:f}=i,P=t.timeouts?.planning;let w;try{w=(0,h.establishOperationPlan)(n,c,p,f,r,a,P)}catch(e){return{errors:[e instanceof g?e:new g(e.message,void 0,void 0,void 0,void 0,e,e.extensions??null)]}}(!0===t.explain||t.explain&&t.explain.includes("plan"))&&(null==w[S]&&(w[S]=w.generatePlanJSON()),a[y.$$extensions]?.explain?.operations.push({type:"plan",title:"Plan",plan:w[S]}));const O=t.timeouts?.execution??null;return function(e,t,n,r,a,s){const i=0,c=[d.POLYMORPHIC_ROOT_PATH],p=[new Set],f=new Map;f.set(e.variableValuesStep.id,(0,u.unaryExecutionValue)(t)),f.set(e.contextStep.id,(0,u.unaryExecutionValue)(n)),f.set(e.rootValueStep.id,(0,u.unaryExecutionValue)(r));const h=(0,u.newBucket)({layerPlan:e.rootLayerPlan,size:1,store:f,flagUnion:0,polymorphicPathList:c,iterators:p},null),S=b.timeSource.now(),P={startTime:S,stopTime:null!==s?S+s:null,eventEmitter:r?.[y.$$eventEmitter],insideGraphQL:!1},v=(0,u.executeBucket)(h,P),w=h.layerPlan.children.find((e=>"subscription"===e.reason.type));function O(t,n){const s=w,{rootStep:o}=s,l=new Map;for(const e of s.copyStepIds){const t=h.store.get(e);l.set(e,t)}const c=o._isUnary?(0,u.unaryExecutionValue)(t):(0,u.batchExecutionValue)([t]);l.set(o.id,c);const p=(0,u.newBucket)({layerPlan:s,store:l,flagUnion:h.flagUnion,polymorphicPathList:[d.POLYMORPHIC_ROOT_PATH],iterators:[new Set],size:1},h.metaByMetaKey),f=(0,u.executeBucket)(p,P);function b(){const[t,s]=_(e.rootOutputPlan,p,0,P,[],h.store.get(e.variableValuesStep.id).at(i),a);return E(s,t,0===n?r[y.$$extensions]??void 0:void 0,a)}return(0,m.isPromiseLike)(f)?f.then(b):b()}function I(){const t=null!=h.layerPlan.rootStep&&null!=h.layerPlan.rootStep.id?h.store.get(h.layerPlan.rootStep.id):null,n=t?.at(i);if((t?._flagsAt(i)??y.NO_FLAGS)&y.FLAG_ERROR){$(h,i,null);const t=[new g(n.originalError.message,e.rootOutputPlan.locationDetails.node,void 0,null,null,n.originalError,null)],r=Object.create(null);r.errors=t;const a=n[y.$$extensions];return null!=a&&(r.extensions=a),r}if(null!=n&&null!=w&&Array.isArray(n)&&n[y.$$streamMore]){const e=n[y.$$streamMore];let t=!1;const r=(0,l.defer)(),a=x((n=>{t=!0,r.resolve(void 0),null!=n?e.throw?.(n):e.return?.()}));return(async()=>{let n=0;for(;;){const s=await Promise.race([r,e.next()]);if(t||!s)break;if(!s){a.throw(new Error("Invalid iteration"));break}const{done:i,value:l}=s;if(i)break;const c=await Promise.race([r,O(l,n)]);if(void 0===c)break;if((0,o.isAsyncIterable)(c))for await(const e of c)a.push(e);else a.push(c);n++}})().then((()=>a.return()),(e=>{a.throw(e)})),a}const[s,c]=_(e.rootOutputPlan,h,i,P,[],h.store.get(e.variableValuesStep.id).at(0),a);return E(c,s,r[y.$$extensions]??void 0,a)}return(0,m.isPromiseLike)(v)?v.then(I):I()}(w,f,r,a,t.outputDataAsString??!1,O)};let T=new Map,R=new Map,N=null,D=null;function B(e,t,n,r){const a=r?T:R;let s=a.get(e);s||(s=new Map,a.set(e,s));const o=s.get(n.outputPlan);return void 0!==o?o.push([t,n]):s.set(n.outputPlan,[[t,n]]),r?(N||(N=(0,l.defer)(),setTimeout(j,1)),N):(D||(D=(0,l.defer)(),setTimeout(A,1)),D)}},28326:(e,t,n)=>{"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.assertListCapableStep=t.isListCapableStep=t.assertModifierStep=t.isModifierStep=t.ModifierStep=t.isPolymorphicStep=t.isStreamableStep=t.isListLikeStep=t.isObjectLikeStep=t.isUnbatchedExecutableStep=t.assertExecutableStep=t.isExecutableStep=t.UnbatchedExecutableStep=t.ExecutableStep=t.BaseStep=t.assertFinalized=t.$$noExec=void 0;const s=n(22970),o=s.__importDefault(n(2645)),i=s.__importDefault(n(73177)),l=n(79554),c=n(35616),u=n(44026),p=n(40549),d=n(60977),f=n(4730),h=n(40354),y=n(22722);t.$$noExec=Symbol("noExec");const b=i.default.ref(p.flagError,"flagError");function m(){let e;try{e=`${this} has been destroyed; calling methods on it is no longer possible`}catch(t){e=`Step ${this?.id} has been destroyed; calling methods on it is no longer possible`}throw new Error(e)}function g(e){return h.$$deepDepSkip in e&&"function"==typeof e[h.$$deepDepSkip]}t.assertFinalized=l.isDev?function(e){if(!e.isFinalized)throw new Error(`Step ${e} is not finalized; did you forget to call \`super.finalize()\` from its \`finalize()\` method?`)}:l.noop;class BaseStep{static#e=r=h.$$subroutine;constructor(){this[r]=null,this.isArgumentsFinalized=!1,this.isFinalized=!1,this.debug=(0,d.getDebug)(),this.hasSideEffects=!1;const e=(0,c.currentLayerPlan)();this.layerPlan=e,this.operationPlan=e.operationPlan,this._isUnary=!0,this._isUnaryLocked=!1}toString(){const e=this.toStringMeta();return o.default.bold.blue(`${this.constructor.name.replace(/Step$/,"")}${null!=e&&e.length?o.default.grey(`<${e}>`):""}`)}toStringMeta(){return null}planJSONExtra(){}finalize(){if(this.isFinalized)throw new Error(`Step ${this} has already been finalized - do not call \`finalize()\` from user code!`);this.isFinalized=!0}destroy(){}}t.BaseStep=BaseStep;class ExecutableStep extends BaseStep{static#e=a=u.$$unlock;constructor(){super(),this[a]=void 0,this.defaultForbiddenFlags=h.DEFAULT_FORBIDDEN_FLAGS,this.dependencies=[],this.dependencyForbiddenFlags=[],this.dependencyOnReject=[],this.dependents=[],this.isOptimized=!1,this.allowMultipleOptimizations=!1,this._stepOptions={stream:null},this.store=!0,this.polymorphicPaths=(0,c.currentPolymorphicPaths)(),this.id=this.layerPlan._addStep(this)}withMyLayerPlan(e){return(0,c.withGlobalLayerPlan)(this.layerPlan,this.polymorphicPaths,e)}getStep(e){return this.layerPlan.getStep(e,this)}getDepOptions(e){const t=this.dependencies[e],n=this.dependencyForbiddenFlags[e],r=this.dependencyOnReject[e];return{step:t,acceptFlags:h.ALL_FLAGS&~n,onReject:r}}getDep(e){throw new Error("Grafast failed to load correctly")}getDepDeep(e){let t=this.getDep(e);for(;g(t);)t=t[h.$$deepDepSkip]();return t}toString(){let e;try{e=this.toStringMeta()}catch(e){}return o.default.bold.blue(`${this.constructor.name.replace(/Step$/,"")}${0===this.layerPlan.id?"":o.default.grey(`{${this.layerPlan.id}}`)}${null!=e&&e.length?o.default.grey(`<${e}>`):""}[${(0,f.inspect)(this.id,{colors:!0})}]`)}canAddDependency(e){return(0,y.stepAMayDependOnStepB)(this,e)}addDependency(e){const t=e instanceof ExecutableStep?{step:e,skipDeduplication:!1}:e;return this.operationPlan.stepTracker.addStepDependency(this,t)}addUnaryDependency(e){const t=e instanceof ExecutableStep?{step:e}:e;return this.operationPlan.stepTracker.addStepUnaryDependency(this,t)}finalize(){if("boolean"!=typeof this.isSyncAndSafe&&(l.isDev?("AsyncFunction"===this.execute.constructor.name||console.warn(`${this} uses a regular (non-async) function for 'execute'; if it never returns a promise and the list it returns never includes a promise then setting \`${this}.isSyncAndSafe = true\` will improve performance. If this is not true, set \`${this}.isSyncAndSafe = false\` to dismiss this message.`),this.isSyncAndSafe=!1):this.isSyncAndSafe=!1),!0===this.isSyncAndSafe&&"AsyncFunction"===this.execute.constructor.name)throw new Error(`${this} claims to be synchronous, however the execute method is asynchronous`);super.finalize()}execute(e){throw new Error(`${this} has not implemented an 'execute' method`)}destroy(){this.addDependency=m,this.deduplicate=m,this.deduplicatedWith=m,this.optimize=m,this.finalize=m,this.execute=m,super.destroy()}}function S(e,t){const n=[];for(let t=0;t<e;t++)n.push(i.default.identifier(`value${t}`));return i.default`\
(function execute({
  count,
  values: [${i.default.join(n,", ")}],
  extra,
}) {
  const results = [];
  for (let i = 0; i < count; i++) {
${r=i.default`\
    results[i] = this.unbatchedExecute(extra, ${i.default.join(n.map((e=>i.default`${e}.at(i)`)),", ")});\
`,t?r:i.default`\
    try {
  ${i.default.indent(r)}
    } catch (e) {
      results[i] = ${b}(e);
    }\
`}
  }
  return results;
})`;var r}t.ExecutableStep=ExecutableStep;const P=[],v=[];i.default.batch((()=>{for(let e=0;e<=10;e++){const t=e,n=S(t,!1);i.default.runInBatch(n,(e=>{P[t]=e}));const r=S(t,!0);i.default.runInBatch(r,(e=>{v[t]=e}))}}));class UnbatchedExecutableStep extends ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"UnbatchedExecutableStep"};finalize(){this.execute===UnbatchedExecutableStep.prototype.execute&&function(e,t,n){if(e<=10)return void n((t?v:P)[e]);const r=S(e,t);i.default.runInBatch(r,(e=>{n(e)}))}(this.dependencies.length,this.isSyncAndSafe,(e=>{this.execute=e})),super.finalize()}execute(e){let{indexMap:t,values:n,extra:r}=e;return console.warn(`${this} didn't call 'super.finalize()' in the finalize method.`),t((e=>{try{const t=n.map((t=>t.at(e)));return this.unbatchedExecute(r,...t)}catch(e){return(0,p.flagError)(e)}}))}}function w(e){return e instanceof BaseStep&&"execute"in e&&"function"==typeof e.execute}t.UnbatchedExecutableStep=UnbatchedExecutableStep,t.isExecutableStep=w,t.assertExecutableStep=function(e){if(!w(e))throw new Error(`Expected an executable step, but received something else: ${(0,f.inspect)(e)}`)},t.isUnbatchedExecutableStep=function(e){return w(e)&&"function"==typeof e.unbatchedExecute},t.isObjectLikeStep=function(e){return"get"in e&&"function"==typeof e.get},t.isListLikeStep=function(e){return"at"in e&&"function"==typeof e.at},t.isStreamableStep=function(e){return"function"==typeof e.stream},t.isPolymorphicStep=function(e){return"planForType"in e&&"function"==typeof e.planForType};function O(e){return"apply"in e&&"function"==typeof e.apply}function $(e){return"listItem"in e&&"function"==typeof e.listItem}t.ModifierStep=class ModifierStep extends BaseStep{constructor(e){super(),this.$parent=e,this.id=this.layerPlan._addModifierStep(this)}toString(){const e=this.toStringMeta();return o.default.bold.blue(`${this.constructor.name.replace(/Step$/,"")}${null!=e&&e.length?o.default.grey(`<${e}>`):""}[${(0,f.inspect)(this.id,{colors:!0})}]`)}},t.isModifierStep=O,t.assertModifierStep=function(e,t){if(!O(e))throw new Error(`The plan returned from '${t}' should be a modifier plan, but it does not implement the 'apply' method.`)},t.isListCapableStep=$,t.assertListCapableStep=function(e,t){if(!$(e))throw new Error(`The plan returned from '${t}' should be a list capable plan, but ${e} does not implement the 'listItem' method.`)}},13612:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.trap=t.assertNotNull=t.inhibitOnNull=t.__FlagStep=t.TRAP_ERROR_OR_INHIBITED=t.TRAP_INHIBITED=t.TRAP_ERROR=void 0;const r=n(40549),a=n(4730),s=n(40354),o=n(28326);t.TRAP_ERROR=s.FLAG_ERROR,t.TRAP_INHIBITED=s.FLAG_INHIBITED,t.TRAP_ERROR_OR_INHIBITED=s.FLAG_ERROR|s.FLAG_INHIBITED;const i=["NULL","EMPTY_LIST","PASS_THROUGH"],l=Object.freeze([]);function c(e){switch(e){case"NULL":return null;case"EMPTY_LIST":return l;case"PASS_THROUGH":return!1;default:throw new Error(`TrapValue '${e}' not understood; please use one of: ${i.join(", ")}`)}}class __FlagStep extends o.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__FlagStep"};constructor(e,t){super(),this.isSyncAndSafe=!1,this.ifDep=null;const{acceptFlags:n=s.DEFAULT_ACCEPT_FLAGS,onReject:a,if:i,valueForInhibited:l="PASS_THROUGH",valueForError:u="PASS_THROUGH"}=t;this.forbiddenFlags=s.ALL_FLAGS&~n,this.onRejectReturnValue=null==a?r.$$inhibit:(0,r.flagError)(a,e.id),this.valueForInhibited=c(l),this.valueForError=c(u),this.canBeInlined=!i&&"PASS_THROUGH"===l&&"PASS_THROUGH"===u&&0==(n&s.FLAG_ERROR),this.canBeInlined?this.addDependency({step:e,acceptFlags:n,onReject:a}):(this.addDependency({step:e,acceptFlags:s.TRAPPABLE_FLAGS}),i&&(this.ifDep=this.addDependency(i))),(0,o.isListCapableStep)(e)&&(this.listItem=this._listItem)}toStringMeta(){const e=s.ALL_FLAGS&~this.forbiddenFlags,t=this.onRejectReturnValue?(n=String(this.onRejectReturnValue),void 0===r&&(r=15),n.length>r?n.substring(0,r-2)+"…":n):(0,a.inspect)(this.onRejectReturnValue);var n,r;const o=null!==this.ifDep?this.getDepOptions(this.ifDep).step:null;return`${this.dependencies[0].id}, ${o?`if(${o.id}), `:""}${function(e){const t=[];return 0==(e&s.FLAG_NULL)&&t.push("rejectNull"),0!=(e&s.FLAG_ERROR)&&t.push("trapError"),0!=(e&s.FLAG_INHIBITED)&&t.push("trapInhibited"),t.join("&")}(e)}, onReject: ${t}`}[s.$$deepDepSkip](){return this.getDepOptions(0).step}_listItem(e){const t=this.dependencies[0];return(0,o.isListCapableStep)(t)?t.listItem(e):e}inline(e){if(!this.canBeInlined)return null;const t=this.dependencies[0],n=this.dependencyForbiddenFlags[0],r=this.dependencyOnReject[0],a=s.ALL_FLAGS&~n;return void 0!==e.onReject&&e.onReject!==r||void 0!==e.acceptFlags&&e.acceptFlags!==s.DEFAULT_ACCEPT_FLAGS&&e.acceptFlags!==a?null:{step:t,acceptFlags:a,onReject:r}}deduplicate(e){return e.filter((e=>e.forbiddenFlags===this.forbiddenFlags&&(e.onRejectReturnValue===this.onRejectReturnValue&&(e.valueForInhibited===this.valueForInhibited&&(e.valueForError===this.valueForError&&e.canBeInlined===this.canBeInlined)))))}execute(e){throw new Error(`${this} not finalized?`)}finalize(){this.canBeInlined?this.execute=this.passThroughExecute:this.execute=this.fancyExecute,super.finalize()}fancyExecute(e){const t=e.values[0],n=null===this.ifDep?null:e.values[this.ifDep],{forbiddenFlags:a,onRejectReturnValue:o,valueForError:i,valueForInhibited:l}=this;return e.indexMap((e=>{const c=!n||n.at(e)?a:s.DEFAULT_FORBIDDEN_FLAGS,u=t._flagsAt(e),p=u&c;return p?p&s.FLAG_INHIBITED?r.$$inhibit:p&s.FLAG_ERROR?(0,r.flagError)(t.at(e)):o:u&s.FLAG_ERROR&&!1!==this.valueForError?i:u&s.FLAG_INHIBITED&&!1!==this.valueForInhibited?l:t.at(e)}))}passThroughExecute(e){const t=e.values[0];if(t.isBatch)return t.entries;{const n=t.value;return e.indexMap((()=>n))}}}t.__FlagStep=__FlagStep,t.inhibitOnNull=function(e){return new __FlagStep(e,{acceptFlags:s.DEFAULT_ACCEPT_FLAGS&~s.FLAG_NULL})},t.assertNotNull=function(e,t,n){return new __FlagStep(e,{...n,acceptFlags:s.DEFAULT_ACCEPT_FLAGS&~s.FLAG_NULL,onReject:new r.SafeError(t)})},t.trap=function(e,t,n){return new __FlagStep(e,{...n,acceptFlags:t&s.TRAPPABLE_FLAGS|s.FLAG_NULL})},o.ExecutableStep.prototype.getDep=function(e){const{step:t,acceptFlags:n,onReject:r}=this.getDepOptions(e);return n===s.DEFAULT_ACCEPT_FLAGS&&null==r?t:new __FlagStep(t,{acceptFlags:n,onReject:r})}},57268:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.__InputDynamicScalarStep=void 0;const r=n(22970).__importStar(n(45290)),a=n(40549),s=n(28326),{Kind:o}=r;class __InputDynamicScalarStep extends s.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__InputDynamicScalarStep"};constructor(e,t){var n;super(),n=this,this.value=t,this.isSyncAndSafe=!0,this.variableNames=[],this.unbatchedExecute=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return n.valueFromValues(r)};const r=e=>{switch(e.kind){case o.VARIABLE:{const t=e.name.value;this.variableNames.push(t);const n=this.operationPlan.trackedVariableValuesStep.get(t);return void this.addDependency(n)}case o.INT:case o.FLOAT:case o.STRING:case o.BOOLEAN:case o.NULL:return;case o.LIST:return void e.values.map(r);case o.OBJECT:for(const t of e.fields)r(t.value);return;case o.ENUM:throw new a.SafeError("Enum values cannot be included within scalars");default:{const t=e;throw new a.SafeError(`Unsupported kind '${t.kind}'`)}}};r(t)}valueFromValues(e){const t=n=>{switch(n.kind){case o.VARIABLE:{const t=n.name.value,r=this.variableNames.indexOf(t);return e[r]}case o.INT:return parseInt(n.value,10);case o.FLOAT:return parseFloat(n.value);case o.STRING:case o.BOOLEAN:return n.value;case o.NULL:return null;case o.LIST:return n.values.map(t);case o.OBJECT:{const e=Object.create(null);for(const r of n.fields)e[r.name.value]=t(r.value);return e}case o.ENUM:throw new a.SafeError("Enum values cannot be included within scalars");default:{const e=n;throw new a.SafeError(`Unsupported kind '${e.kind}'`)}}};return t(this.value)}eval(){const e=this.variableNames.map(((e,t)=>this.getDep(t).eval()));return this.valueFromValues(e)}evalIs(e){if(null==e||0===e)return!1;throw new Error("__InputDynamicScalarStep doesn't support evalIs on non-null, non-undefined, non-0 values")}}t.__InputDynamicScalarStep=__InputDynamicScalarStep},18523:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.__InputListStep=void 0;const r=n(22970),a=r.__importStar(n(45290)),s=r.__importStar(n(48282)),o=n(63881),i=n(28326),l=n(20353),c=n(30910),{GraphQLList:u,Kind:p}=a;class __InputListStep extends i.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__InputListStep"};constructor(e,t){super(),this.inputValues=t,this.isSyncAndSafe=!0,this.itemCount=0,this.unbatchedExecute=()=>{throw new Error("__InputListStep should never execute; it should have been optimized away.")},s.ok(e instanceof u,"Expected inputType to be a List");const n=e.ofType,r=void 0===t?void 0:t.kind===p.LIST?t.values:t.kind===p.NULL?void 0:[t];if(void 0!==r)for(let e=0,t=r.length;e<t;e++){const t=r[e],a=(0,o.inputStep)(this.operationPlan,n,t,void 0);this.addDependency(a),this.itemCount++}}optimize(){const{inputValues:e}=this;if("NullValue"===e?.kind)return(0,l.constant)(null);{const e=[];for(let t=0;t<this.itemCount;t++){const n=this.getDep(t);e[t]=n}return(0,c.list)(e)}}execute(){throw new Error("__InputListStep should never execute; it should have been optimized away.")}at(e){const t=e<this.itemCount?this.getDep(e):(0,l.constant)(void 0);return(0,o.assertInputStep)(t),t}eval(){if("NullValue"===this.inputValues?.kind)return null;const e=[];for(let t=0;t<this.itemCount;t++){const n=this.getDep(t);(0,o.assertInputStep)(n);const r=n.eval();e[t]=r}return e}evalIs(e){if(void 0===e)return this.inputValues===e;if(null===e)return"NullValue"===this.inputValues?.kind;throw new Error("__InputListStep cannot evalIs values other than null and undefined currently")}evalLength(){return void 0===this.inputValues||this.inputValues.kind===p.NULL?null:this.inputValues.kind===p.LIST?this.inputValues.values.length:1}}t.__InputListStep=__InputListStep},81925:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.__InputObjectStep=void 0;const r=n(22970).__importDefault(n(73177)),a=n(63881),s=n(28326),o=n(22722),i=n(20353);class __InputObjectStep extends s.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__InputObjectStep"};constructor(e,t){super(),this.inputObjectType=e,this.inputValues=t,this.isSyncAndSafe=!0,this.inputFields=Object.create(null);const n=e.getFields(),r="ObjectValue"===t?.kind?t.fields:void 0;for(const e in n){const t=n[e],s=t.type,i=void 0!==t.defaultValue?(0,o.defaultValueToValueNode)(s,t.defaultValue):void 0,l=r?.find((t=>t.name.value===e)),c=(0,a.inputStep)(this.operationPlan,s,l?.value,i);this.inputFields[e]={step:c,dependencyIndex:this.addDependency(c)},Object.defineProperty(this,`$${e}`,{value:c})}}optimize(){return"NullValue"===this.inputValues?.kind?(0,i.constant)(null):this}finalize(){r.default.runInBatch(r.default`(function (extra, ${r.default.join(this.dependencies.map(((e,t)=>r.default.identifier(`val${t}`))),", ")}) {
  const resultValues = Object.create(null);
  ${r.default.join(Object.entries(this.inputFields).map((e=>{let[t,{dependencyIndex:n}]=e;if(null==n)throw new Error("inputFieldPlan has gone missing.");return r.default`\
  resultValues${r.default.set(t,!0)} = ${r.default.identifier(`val${n}`)};`})),"\n")}
  return resultValues;
})`,(e=>{this.unbatchedExecute=e})),super.finalize()}unbatchedExecute(e){const t=Object.create(null);for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(const e in this.inputFields){const n=this.inputFields[e].dependencyIndex;if(null==n)throw new Error("inputFieldPlan has gone missing.");const a=r[n];t[e]=a}return t}get(e){const t=this.inputFields[e]?.step;if(void 0===t)throw new Error(`Tried to '.get("${e}")', but no such attribute exists on ${this.inputObjectType.name}`);return t}eval(){if("NullValue"===this.inputValues?.kind)return null;const e=Object.create(null);for(const t in this.inputFields){const n=this.inputFields[t].step;e[t]=n.eval()}return e}evalIs(e){if(void 0===e)return this.inputValues===e;if(null===e)return"NullValue"===this.inputValues?.kind;if(0===e)return"IntValue"===this.inputValues?.kind&&"0"===this.inputValues.value;throw new Error("__InputObjectStep cannot evalIs values other than null and undefined currently")}evalIsEmpty(){return"ObjectValue"===this.inputValues?.kind&&0===this.inputValues.fields.length}evalHas(e){return!!this.inputValues&&("NullValue"!==this.inputValues.kind&&(e in this.inputFields&&!this.inputFields[e].step.evalIs(void 0)))}}t.__InputObjectStep=__InputObjectStep},42213:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.__InputStaticLeafStep=void 0;const r=n(22970).__importStar(n(45290)),a=n(28326),s=n(20353),{valueFromAST:o}=r;class __InputStaticLeafStep extends a.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__InputStaticLeafStep"};constructor(e,t){super(),this.isSyncAndSafe=!0,this.coercedValue=null!=t?o(t,e):t}unbatchedExecute(){return this.coercedValue}optimize(){return(0,s.constant)(this.coercedValue,!1)}eval(){return this.coercedValue}evalIs(e){return this.coercedValue===e}}t.__InputStaticLeafStep=__InputStaticLeafStep},29002:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.__ItemStep=void 0;const a=n(22970).__importDefault(n(2645)),s=n(40354),o=n(28326);class __ItemStep extends o.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__ItemStep"};constructor(e,t){void 0===t&&(t=0),super(),this.depth=t,this.isSyncAndSafe=!0,this[r]=!0,this.addDependency(e),this._isUnary=!1,this._isUnaryLocked=!0}toStringMeta(){return a.default.bold.yellow(String(this.dependencies[0].id))}planJSONExtra(){return{transformStepId:this.transformStepId}}getParentStep(){return this.getDep(0)}[(r=o.$$noExec,s.$$deepDepSkip)](){return this.getDep(0)}execute(){throw new Error("__ItemStep must never execute")}unbatchedExecute(){throw new Error("__ItemStep must never execute")}finalize(){super.finalize(),null!=this.transformStepId&&(this.transformStepId=this.operationPlan.dangerouslyGetStep(this.transformStepId).id)}}t.__ItemStep=__ItemStep},76340:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.__TrackedValueStep=void 0;const r=n(45290),a=n(46510),s=n(28326);class __TrackedValueStep extends s.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__TrackedValueStep"};static withGraphQLType(e,t,n,r,a){return void 0===r&&(r=[]),new __TrackedValueStep(e,t,n,r,a)}constructor(e,t,n,a,s){if(void 0===a&&(a=[]),super(),this.isSyncAndSafe=!0,this.addDependency(t),this.value=e,this.constraints=n,this.path=a,this.nullableGraphQLType=s&&!o(s)?(0,r.getNullableType)(s):void 0,this.variableDefinitions=s&&o(s)?s:void 0,(0,r.isInputObjectType)(this.nullableGraphQLType)){const e=this.nullableGraphQLType.getFields();for(const t of Object.keys(e)){let e;Object.defineProperty(this,`$${t}`,{get:()=>(e||(e=this.get(t)),e)})}}else if(this.variableDefinitions)for(const e of this.variableDefinitions){const t=e.variable.name.value;let n;Object.defineProperty(this,`$${t}`,{get:()=>(n||(n=this.get(t)),n)})}}execute(e){let{count:t,values:[n]}=e;return n.isBatch?n.entries:(0,a.arrayOfLength)(t,n.value)}unbatchedExecute(e,t){return t}getValuePlan(){return this.getDep(0)}get(e){const{value:t,path:n,constraints:a}=this,s=t?.[e],o=this.getValuePlan().get(e),i=[...n,e];if(this.nullableGraphQLType){if((0,r.isInputObjectType)(this.nullableGraphQLType)){const t=this.nullableGraphQLType.getFields()[e];if(!t)throw new Error(`'${this.nullableGraphQLType}' has no attribute '${e}'`);return __TrackedValueStep.withGraphQLType(s,o,a,i,t.type)}throw new Error(`Cannot get field '${e}' on non-input-object type '${this.nullableGraphQLType}'`)}if(this.variableDefinitions){const t=this.variableDefinitions.find((t=>t.variable.name.value===e));if(!t)throw new Error(`No variable named '$${e}' exists in this operation`);const n=e=>{if(e.kind===r.Kind.NON_NULL_TYPE)return new r.GraphQLNonNull(n(e.type));if(e.kind===r.Kind.LIST_TYPE)return new r.GraphQLList(n(e.type));{const t=e.name.value;return this.operationPlan.schema.getType(t)}},l=n(t.type);return __TrackedValueStep.withGraphQLType(s,o,a,i,l)}return new __TrackedValueStep(s,o,a,i)}at(e){const{value:t,path:n,constraints:a}=this,s=t?.[e],o=this.getValuePlan().at(e),i=[...n,e];if(this.nullableGraphQLType){if((0,r.isListType)(this.nullableGraphQLType))return __TrackedValueStep.withGraphQLType(s,o,a,i,this.nullableGraphQLType.ofType);throw new Error(`'${this.nullableGraphQLType}' is not a list type, cannot access array index '${e}' on it`)}return new __TrackedValueStep(s,o,a,i)}eval(){const{path:e,value:t}=this;return this.constraints.push({type:"value",path:e,value:t}),t}evalIs(e){const{value:t,path:n}=this,r=t===e;return this.constraints.push({type:"equal",path:n,expectedValue:e,pass:r}),r}evalIsEmpty(){const{value:e,path:t}=this,n="object"==typeof e&&null!==e&&0===Object.keys(e).length;return this.constraints.push({type:"isEmpty",path:t,isEmpty:n}),n}evalHas(e){const{value:t,path:n}=this,r=[...n,e],a="object"==typeof t&&t&&void 0!==t[e]||!1;return this.constraints.push({type:"exists",path:r,exists:a}),a}evalLength(){const{value:e,path:t}=this,n=Array.isArray(e)?e.length:null;return this.constraints.push({type:"length",path:t,expectedLength:n}),n}optimize(){return this.getDep(0)}}function o(e){return Array.isArray(e)}t.__TrackedValueStep=__TrackedValueStep},29294:(e,t,n)=>{"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.__ValueStep=void 0;const a=n(28326),s=n(60351);class __ValueStep extends a.ExecutableStep{static#e=r=a.$$noExec;static#t=this.$$export={moduleName:"grafast",exportName:"__ValueStep"};constructor(){super(),this.isSyncAndSafe=!0,this[r]=!0}toStringMeta(){switch(this){case this.operationPlan.rootValueStep:return"rootValue";case this.operationPlan.variableValuesStep:return"variableValues";case this.operationPlan.contextStep:return"context";default:return null}}execute(){throw new Error(`GrafastInternalError<7696a514-f452-4d47-92d3-85aeb5b23f48>: ${this} is a __ValueStep and thus must never execute`)}get(e){return(0,s.access)(this,[e])}at(e){return(0,s.access)(this,[e])}}t.__ValueStep=__ValueStep},60351:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.access=t.AccessStep=t.expressionSymbol=void 0;const r=n(22970),a=r.__importDefault(n(2645)),s=r.__importDefault(n(25130)),o=r.__importDefault(n(73177)),i=n(4730),l=n(28326);t.expressionSymbol=Symbol("expression");const c=Object.create(null),u=Object.create(null);const p=(0,s.default)("grafast:AccessStep").extend("verbose");class AccessStep extends l.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"AccessStep"};constructor(e,t,n){super(),this.fallback=n,this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.path=t,this.addDependency(e)}toStringMeta(){return`${a.default.bold.yellow(String(this.getDep(0).id))}.${this.path.map((e=>String(e))).join(".")}`}get(e){if("string"!=typeof e)throw new Error("AccessStep::get can only be called with string values");return new AccessStep(this.getDep(0),[...this.path,e])}at(e){if("number"!=typeof e)throw new Error("AccessStep::get can only be called with string values");return new AccessStep(this.getDep(0),[...this.path,e])}optimize(){const e=this.getDep(0);return e instanceof AccessStep&&void 0===e.fallback?d(e.getDep(0),[...e.path,...this.path],this.fallback):this}finalize(){!function(e,n,r){const a=e.length;let s=a>50||a<1?0:a>5?1:2;for(let t=0;t<a;t++){const n=e[t],r=typeof n;if("symbol"===r)2===s&&(s=1);else if("string"===r)2===s&&n.includes("|")&&(s=1);else if("number"===r)Number.isFinite(n)||(s=0);else{if(null!=n)throw new Error(`Invalid path item: ${(0,i.inspect)(n)} in path '${JSON.stringify(e)}'`);s=0}}if(0===s)r((function(t,r){let a=r;for(let t=0,n=e.length;t<n&&null!=a;t++)a=a[e[t]];return a??n}));else{const i=(void 0!==n?"f":"n")+a,l=2===s?a=>{const s=a(n,...e),o=[e,n];s[t.expressionSymbol]=o,r(s)}:t=>r(t(n,...e)),p=c[i];if(void 0!==p)return void l(p);const d=u[i];if(void 0!==d)return void d.push(l);const f=[l];u[i]=f;const h=[],y=[];for(let e=0;e<a;e++){const t=o.default.identifier(`p${e}`);h.push(t),y.push(o.default`[${t}]`)}o.default.runInBatch(o.default`function (fallback, ${o.default.join(h,", ")}) {
return (_meta, value) => value?.${o.default.join(y,"?.")}${void 0===n?o.default.blank:o.default.cache` ?? fallback`};
}`,(e=>{c[i]=e,delete u[i];for(const t of f)t(e)}))}}(this.path,this.fallback,(e=>{this.unbatchedExecute=e})),super.finalize()}unbatchedExecute(e){throw new Error(`${this}: should have had unbatchedExecute method replaced`)}deduplicate(e){const t=JSON.stringify(this.path),n=e.filter((e=>e.fallback===this.fallback&&JSON.stringify(e.path)===t));return p("%c deduplicate: peers with same path %o = %c",this,this.path,n),n}}function d(e,t,n){return new AccessStep(e,Array.isArray(t)?t:null!=t?[t]:[],n)}t.AccessStep=AccessStep,t.access=d},89191:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyTransforms=t.ApplyTransformsStep=void 0;const r=n(22970).__importStar(n(48282)),a=n(79554),s=n(61258),o=n(88784),i=n(35616),l=n(40549),c=n(40354),u=n(28326),p=n(29002);class ApplyTransformsStep extends u.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ApplyTransformsStep"};constructor(e){super(),this.isSyncAndSafe=!1,this.addDependency(e),this.subroutineLayer=new o.LayerPlan(this.operationPlan,this.layerPlan,{type:"subroutine",parentStep:this});const t=(0,i.withGlobalLayerPlan)(this.subroutineLayer,e.polymorphicPaths,(()=>{const t=new p.__ItemStep(e);t.transformStepId=this.id,this.itemStepId=t.id;const n=(0,u.isListCapableStep)(e)?e.listItem(t):t,r=d(n);return!this.isSyncAndSafe||t.isSyncAndSafe&&n.isSyncAndSafe&&r.isSyncAndSafe||(this.isSyncAndSafe=!1),r}));this.subroutineLayer.setRootStep(t),this.operationPlan.finishSubroutine(this,this.subroutineLayer)}async execute(e){let{indexMap:t,values:[n],extra:o}=e;const i=o._bucket,u=this.subroutineLayer,{copyStepIds:p,rootStep:d}=u,f=new Map,h=[],y=[],b=new Map;let m=0;const g=this.operationPlan.dangerouslyGetStep(this.itemStepId),S=g.id;if(null==S)throw new Error("GrafastInternalError<b3a2bff9-15c6-47e2-aa82-19c862324f1a>: listItem layer plan has no rootStepId");g._isUnary?f.set(S,(0,s.unaryExecutionValue)(n.at(0))):f.set(S,(0,s.batchExecutionValue)([]));for(const e of p){const t=i.store.get(e);if(!t)throw new Error(`GrafastInternalError<68675bbd-bc15-4c4a-902a-61c0de616325>: unary step '${e}' (${this.operationPlan.dangerouslyGetStep(e)}) listed in copyStepIds but not available in parent bucket for ${this}`);t.isBatch?f.set(e,(0,s.batchExecutionValue)([])):f.set(e,t)}if(t((e=>{const t=n.at(e);if(Array.isArray(t)){const n=[];b.set(e,n);for(let r=0,a=t.length;r<a;r++){const a=m++;n.push(a),h[a]=i.polymorphicPathList[e],y[a]=i.iterators[e];const s=f.get(S);s.isBatch&&s._setResult(a,t[r],0);for(const t of p){const n=f.get(t);if(n.isBatch){const r=i.store.get(t);n._setResult(a,r.at(e),r._flagsAt(e))}}}}})),m>0){const e=(0,s.newBucket)({layerPlan:u,size:m,store:f,flagUnion:i.flagUnion,polymorphicPathList:h,iterators:y},i.metaByMetaKey);await(0,s.executeBucket)(e,o._requestContext)}const P=f.get(d.id);return t((e=>{const t=n.at(e);if(null==t)return t;const s=b.get(e);if(!Array.isArray(t)||!Array.isArray(s))return t;const o=s.map((e=>{const t=P.at(e);return P._flagsAt(e)&c.FLAG_ERROR?(0,l.flagError)(t):t}));return a.isDev&&r.strictEqual(t.length,o.length,"GrafastInternalError<43cb302e-673b-4881-8c4c-f2d00fe5a3d7>: The list and values length must match for a ApplyTransformsStep"),o}))}}function d(e){return(0,u.isListCapableStep)(e)?new ApplyTransformsStep(e):e}t.ApplyTransformsStep=ApplyTransformsStep,t.applyTransforms=d},57158:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.condition=t.ConditionStep=void 0;const r=n(28326),a=["null","not null","exists","not exists"],s=["===","!=="];class ConditionStep extends r.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ConditionStep"};constructor(e,t,n){if(super(),this.op=e,this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,n){if(!s.includes(e))throw new Error(`Unary operator '${e}' is not known; supported operators: ${s.join(", ")}`);this.addDependency(t),this.addDependency(n)}else{if(!a.includes(e))throw new Error(`Unary operator '${e}' is not known; supported operators: ${a.join(", ")}`);this.addDependency(t)}}toStringMeta(){if(a.includes(this.op))return`${this.op}`;{const e=this.getDepOptions(0).step,t=this.getDepOptions(1).step;return`${e.id} ${this.op} ${t.id}`}}finalize(){this.unbatchedExecute=this.makeUnbatchedExecute(),super.finalize()}makeUnbatchedExecute(){switch(this.op){case"null":return o;case"not null":return i;case"exists":return c;case"not exists":return l;case"===":return u;case"!==":return p;default:{const e=this.op;throw new Error(`Operator ${e} is not supported`)}}}unbatchedExecute(e,t,n){throw new Error(`${this} was not finalized?`)}}function o(e,t){return null===t}function i(e,t){return null!==t}function l(e,t){return null==t}function c(e,t){return null!=t}function u(e,t,n){return t===n}function p(e,t,n){return t!==n}t.ConditionStep=ConditionStep,t.condition=function(e,t,n){return new ConditionStep(e,t,n)}},67647:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.connection=t.EdgeStep=t.assertEdgeCapableStep=t.ConnectionStep=t.assertPageInfoCapableStep=void 0;const r=n(22970).__importStar(n(48282)),a=n(28326),s=n(22722),o=n(57828);t.assertPageInfoCapableStep=function(e){const t=e;if("function"!=typeof t.hasNextPage||"function"!=typeof t.hasPreviousPage||"function"!=typeof t.startCursor||"function"!=typeof t.endCursor)throw new Error(`Expected a PageInfoCapableStep, but found '${e}'`)};const i=Object.freeze(Object.create(null));class ConnectionStep extends a.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ConnectionStep"};constructor(e,t){void 0===t&&(t={}),super(),this.isSyncAndSafe=!0,this._firstDepId=null,this._lastDepId=null,this._offsetDepId=null,this._beforeDepId=void 0,this._afterDepId=void 0;const{edgeDataPlan:n,nodePlan:r,cursorPlan:a}=t;this.edgeDataPlan=n,this.itemPlan=r,this.cursorPlan=a,this.subplanId=e.id}toStringMeta(){return String(this.subplanId)}getFirst(){return null!=this._firstDepId?this.getDep(this._firstDepId):null}setFirst(e){if(null!=this._firstDepId)throw new Error(`${this}->setFirst already called`);this._firstDepId=this.addDependency(e)}getLast(){return null!=this._lastDepId?this.getDep(this._lastDepId):null}setLast(e){if(null!=this._lastDepId)throw new Error(`${this}->setLast already called`);this._lastDepId=this.addDependency(e)}getOffset(){return null!=this._offsetDepId?this.getDep(this._offsetDepId):null}setOffset(e){if(null!=this._offsetDepId)throw new Error(`${this}->setOffset already called`);this._offsetDepId=this.addDependency(e)}getBefore(){return null!=this._beforeDepId?this.getDep(this._beforeDepId):null}setBefore(e){if(void 0!==this._beforeDepId)throw new Error(`${this}->setBefore already called`);const t=this.getSubplan().parseCursor(e);this._beforeDepId=t?this.addDependency(t):null}getAfter(){return null!=this._afterDepId?this.getDep(this._afterDepId):null}setAfter(e){if(void 0!==this._afterDepId)throw new Error(`${this}->setAfter already called`);const t=this.getSubplan().parseCursor(e);this._afterDepId=t?this.addDependency(t):null}getSubplan(){if(this.isArgumentsFinalized)throw new Error("Forbidden to call ConnectionStep.getSubplan after arguments finalize");return this.getStep(this.subplanId)}cloneSubplanWithoutPagination(){if(!this.isArgumentsFinalized)throw new Error("Forbidden to call ConnectionStep.nodes before arguments finalize");const e=this.getStep(this.subplanId);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.connectionClone(this,...n)}cloneSubplanWithPagination(){const e=this.cloneSubplanWithoutPagination(...arguments);{const t=this.getBefore();null!==t&&e.setBefore(t)}{const t=this.getAfter();null!==t&&e.setAfter(t)}{const t=this.getFirst();null!==t&&e.setFirst(t)}{const t=this.getLast();null!==t&&e.setLast(t)}{const t=this.getOffset();null!==t&&e.setOffset(t)}return e}addValidation(e){this.withMyLayerPlan((()=>{this.addDependency(e())}))}get(e){switch(e){case"edges":return this.edges();case"nodes":return this.nodes();case"pageInfo":return this.pageInfo()}}edges(){return this.cursorPlan||this.itemPlan||this.edgeDataPlan?(0,o.each)(this.cloneSubplanWithPagination(),(e=>this.wrapEdge(e))):this.cloneSubplanWithPagination()}nodes(){return void 0!==this.itemPlan?(0,o.each)(this.cloneSubplanWithPagination(),(e=>this.itemPlan(e))):this.cloneSubplanWithPagination()}wrapEdge(e){return new EdgeStep(this,e)}pageInfo(){return this.getStep(this.subplanId).pageInfo(this)}execute(e){let{count:t}=e;return(0,s.arrayOfLength)(t,i)}unbatchedExecute(){return i}}t.ConnectionStep=ConnectionStep,t.assertEdgeCapableStep=function(e){const t=e;if("function"!=typeof t.node||"function"!=typeof t.cursor)throw new Error(`Expected a EdgeCapableStep, but found '${e}'`)};class EdgeStep extends a.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"EdgeStep"};constructor(e,t,n){void 0===n&&(n=!1),super(),this.skipCursor=n,this.isSyncAndSafe=!0,this.needCursor=!1;const a=this.addDependency(t);if(r.strictEqual(a,0,"GrafastInternalError<89cc75cd-ccaf-4b7e-873f-a629c36d55f7>: item must be first dependency"),n)this.cursorDepId=null;else{const n=e.cursorPlan?.(t)??t.cursor?.();if(!n)throw new Error(`No cursor plan known for '${t}'`);this.cursorDepId=this.addDependency(n),r.strictEqual(this.cursorDepId,1,"GrafastInternalError<46e4b5ca-0c11-4737-973d-0edd0be060c9>: cursor must be second dependency")}this.connectionDepId=this.addDependency(e)}get(e){switch(e){case"node":return this.node();case"cursor":return this.cursor()}}getConnectionStep(){return this.getDep(this.connectionDepId)}getItemStep(){return this.getDep(0)}data(){const e=this.getItemStep();return this.getConnectionStep().edgeDataPlan?.(e)??e}node(){const e=this.getItemStep();return this.getConnectionStep().itemPlan?.(e)??e}cursor(){return this.needCursor=!0,this.getDep(this.cursorDepId)}optimize(){return this.needCursor||null===this.cursorDepId?this:new EdgeStep(this.getConnectionStep(),this.getItemStep(),!0)}deduplicate(e){return e}deduplicatedWith(e){this.needCursor&&(e.needCursor=!0)}unbatchedExecute(e,t,n){return null!=t||null!=this.cursorDepId&&null!=n?i:null}}t.EdgeStep=EdgeStep;let l=!1;t.connection=function e(t,n){return"function"==typeof n?(l||(l=!0,console.warn("The call signature for connection() has changed, arguments after the first argument should be specified via a config object")),e(t,{nodePlan:arguments[1],cursorPlan:arguments[2]})):new ConnectionStep(t,n)}},20353:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.constant=t.ConstantStep=void 0;const r=n(4730),a=n(28326),s=n(22722);class ConstantStep extends a.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ConstantStep"};constructor(e,t){void 0===t&&(t="boolean"!=typeof e&&null!=e),super(),this.data=e,this.isSensitive=t,this.isSyncAndSafe=!0}toStringMeta(){return this.isSensitive?"[HIDDEN]":(0,r.inspect)(this.data).replace(/[\r\n]/g," ").slice(0,60)}deduplicate(e){return e.filter((e=>e.data===this.data))}execute(e){let{count:t}=e;return(0,s.arrayOfLength)(t,this.data)}eval(){return this.data}evalIs(e){return this.data===e}evalIsEmpty(){return"object"==typeof this.data&&null!==this.data&&0===Object.keys(this.data).length}unbatchedExecute(){return this.data}isNull(){return null===this.data}isUndefined(){return void 0===this.data}get(e){return o("object"==typeof this.data&&null!==this.data&&Object.hasOwn(this.data,e)?this.data[e]:void 0)}at(e){return o(Array.isArray(this.data)?this.data[e]:void 0)}}function o(e,t){if(function(e){return Array.isArray(e)&&"raw"in e&&Array.isArray(e.raw)}(e)){if(1!==e.length)throw new Error("constant`...` doesn't currently support placeholders; please use 'constant(`...`)' instead");return new ConstantStep(e[0],!1)}return new ConstantStep(e,t)}t.ConstantStep=ConstantStep,t.constant=o},57828:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.each=void 0;const r=n(22970).__importDefault(n(2645)),a=n(28326),s=n(29002),o=n(50186),i=(e,t)=>(e.push(t),e),l=e=>e,c=()=>[],u=new WeakMap,p=(e,t)=>{let n=u.get(e);n||(n=new WeakMap,u.set(e,n));let r=n.get(t);return r||(r=n=>t(e.listItem(n)),n.set(t,r)),r};t.each=function e(t,n){return(0,o.listTransform)({listStep:t,itemPlanCallback:l,initialState:c,reduceCallback:i,listItem:(0,a.isListCapableStep)(t)?p(t,n):n,meta:`each:${r.default.yellow(t.id)}${n.name?`/${n.name}`:""}`,optimize(){const e=this.subroutineLayer,t=e.rootStep;return t instanceof s.__ItemStep&&t.getParentStep().layerPlan!==e?this.getListStep():this},...null!=t.connectionClone?{connectionClone(t){const r=this.getListStep();for(var a=arguments.length,s=new Array(a>1?a-1:0),o=1;o<a;o++)s[o-1]=arguments[o];return e(r.connectionClone(t,...s),n)}}:null})}},50981:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.error=t.ErrorStep=void 0;const r=n(40549),a=n(4730),s=n(28326),o=n(22722);class ErrorStep extends s.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ErrorStep"};constructor(e){if(super(),this.isSyncAndSafe=!1,!(e instanceof Error))throw new Error(`${this} called with non-Error ${(0,a.inspect)(e)}`);this.error=e}execute(e){let{count:t}=e;return(0,o.arrayOfLength)(t,(0,r.flagError)(this.error))}unbatchedExecute(){return(0,r.flagError)(this.error)}}t.ErrorStep=ErrorStep,t.error=function(e){return new ErrorStep(e)}},79091:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.filter=void 0;const r=n(22970).__importDefault(n(2645)),a=n(28326),s=n(50186),o=(e,t,n)=>(n&&e.push(t),e),i=()=>[];t.filter=function(e,t){return(0,s.listTransform)({listStep:e,itemPlanCallback:t,initialState:i,reduceCallback:o,listItem:(0,a.isListCapableStep)(e)?t=>e.listItem(t):void 0,meta:`filter:${r.default.yellow(e.id)}${t.name?`/${t.name}`:""}`})}},29663:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.first=t.FirstStep=void 0;const r=n(28326),a=n(30910);class FirstStep extends r.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"FirstStep"};constructor(e){super(),this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.addDependency(e)}execute(e){let{indexMap:t,values:[n]}=e;return t((e=>n.at(e)?.[0]))}unbatchedExecute(e,t){return t?.[0]}deduplicate(e){return e}optimize(){const e=this.getDep(0);return e instanceof a.ListStep?e.first():this}}t.FirstStep=FirstStep,t.first=function(e){return new FirstStep(e)}},26446:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.graphqlResolver=t.graphqlItemHandler=t.GraphQLItemHandler=t.GraphQLResolverStep=void 0;const r=n(22970).__importStar(n(45290)),a=n(40835),s=n(46510),o=n(68415),i=n(28326),l=n(22722),{defaultTypeResolver:c,getNamedType:u,getNullableType:p,isAbstractType:d,isListType:f}=r;function h(e,t,n){if(null==e)return e;if(e instanceof Error)return(0,s.flagError)(e);if((0,l.isPromiseLike)(e))return e.then((e=>h(e,t,n)));if((0,a.isIterable)(e)){const r=Array.isArray(e)?e:[...e];if(r.some(l.isPromiseLike)){return h(Promise.all(r.map((e=>(0,l.isPromiseLike)(e)?e.then(null,s.flagError):e))),t,n)}}return{data:e,context:t,resolveInfo:n}}class GraphQLResolverStep extends i.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"GraphQLResolverStep"};constructor(e,t,n,r,a,o){void 0===o&&(o=!1),super(),this.resolver=e,this.subscriber=t,this.resolveInfoBase=a,this.returnContextAndResolveInfo=o,this.isSyncAndSafe=!1,this.allowMultipleOptimizations=!1,this.planDep=this.addDependency(n),this.argsDep=this.addDependency(r),this.contextDep=this.addDependency((0,s.context)()),this.variableValuesDep=this.addDependency(this.operationPlan.variableValuesStep),this.rootValueDep=this.addDependency(this.operationPlan.rootValueStep),this.isNotRoot=![this.operationPlan.queryType,this.operationPlan.mutationType,this.operationPlan.subscriptionType].includes(a.parentType)}toStringMeta(){return this.resolver?.displayName||this.resolver?.name||this.subscriber?.displayName||this.subscriber?.name||null}deduplicate(e){return e.filter((e=>e.resolver===this.resolver&&e.subscriber===this.subscriber))}unbatchedExecute(e,t,n,r,a,s){if(this.isNotRoot&&null==t)return t;const o=Object.assign(Object.create(this.resolveInfoBase),{variableValues:a,rootValue:s,path:{typename:this.resolveInfoBase.parentType.name,key:this.resolveInfoBase.fieldName,prev:void 0}}),i=this.resolver?.(t,n,r,o);return this.returnContextAndResolveInfo?h(i,r,o):m(i)}unbatchedStream(e,t,n,r,a,s){if(this.isNotRoot)return Promise.reject(new Error("Invalid non-root subscribe"));if(null==this.subscriber)return Promise.reject(new Error("Cannot subscribe to field"));if(this.returnContextAndResolveInfo)return Promise.reject(new Error("Subscription with returnContextAndResolveInfo is not supported"));const o=Object.assign(Object.create(this.resolveInfoBase),{variableValues:a,rootValue:s});return m(this.subscriber(t,n,r,o))}async stream(e){let{indexMap:t,values:n,extra:r}=e;const a=this.dependencies.length;return t((e=>{try{const t=[];for(let r=0;r<a;r++)t[r]=n[r].at(e);return this.unbatchedStream(r,...t)}catch(e){return(0,s.flagError)(e)}}))}}t.GraphQLResolverStep=GraphQLResolverStep;class GraphQLItemHandler extends i.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"GraphQLItemHandler"};constructor(e,t){if(super(),this.nullableInnerType=null,this.isSyncAndSafe=!1,this.addDependency(e),f(t))this.nullableInnerType=t.ofType;else{if(!d(t))throw new Error(`GrafastInternalError<0a293e88-0f38-43f6-9179-f3ef9a720872>: Expected nullableType to be a list or abstract type, instead found ${t}`);this.abstractType=t}}planForType(){return this}listItem(e){if(!this.nullableInnerType)throw new Error(`GrafastInternalError<83f3533a-db8e-4eb9-9251-2a165ae6147b>: did not expect ${this}.listItem() to be called since it wasn't handling a list type`);return y(e,this.nullableInnerType)}figureOutTheTypeOf(e,t,n){const r=this.abstractType;if(!r)throw new Error("GrafastInternalError<5ea0892a-e9f6-479c-9b0b-2b09e46eecb6>: No abstract type? How can this be?");return null!=r.resolveType?r.resolveType(e,t,n,r):c(e,t,n,r)}actuallyWrapData(e,t){return void 0!==e?(0,o.polymorphicWrap)(e,t):new Error("Could not determine type of data")}polymorphicWrapData(e,t,n){if(null==e)return null;const r=this.figureOutTheTypeOf(e,t,n);return(0,l.isPromiseLike)(r)?r.then((t=>this.actuallyWrapData(t,e))):this.actuallyWrapData(r,e)}wrapListData(e,t,n){return null==e?null:Array.isArray(e)?e.map((e=>h(e,t,n))):(console.warn(`${this}: data wasn't an array, so we're returning null`),null)}execute(e){let{indexMap:t,values:[n]}=e;if(void 0!==this.abstractType)return t((e=>{const t=n.at(e);return null==t?t:(0,l.isPromiseLike)(t.data)?t.data.then((e=>this.polymorphicWrapData(e,t.context,t.resolveInfo))):this.polymorphicWrapData(t.data,t.context,t.resolveInfo)}));if(null!=this.nullableInnerType)return t((e=>{const t=n.at(e);if(null==t)return null;{const{data:e,context:n,resolveInfo:r}=t;return(0,l.isPromiseLike)(e)?e.then((e=>this.wrapListData(e,n,r))):this.wrapListData(e,n,r)}}));throw new Error("GrafastInternalError<6a3ed701-6b53-41e6-9a64-fbea57c76ae7>: has to be abstract or list")}}function y(e,t){return new GraphQLItemHandler(e,t)}function b(e){return e instanceof Error?(0,s.flagError)(e):e}function m(e){return(0,l.isPromiseLike)(e)?e.then(b):b(e)}t.GraphQLItemHandler=GraphQLItemHandler,t.graphqlItemHandler=y,t.graphqlResolver=function(e,t,n,r,a){const{returnType:o}=a,i=u(o),l=d(i),c=new GraphQLResolverStep(e,t,n,r,a,l);if(l){if(null!=t)throw new s.SafeError("GraphQL subscribe function emulation currently doesn't support polymorphism");return y(c,p(o))}return c}},8689:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.groupBy=void 0;const r=n(22970).__importDefault(n(2645)),a=n(28326),s=n(57828),o=n(50186),i=(e,t,n)=>{let r=e.get(n);return r||(r=[],e.set(n,r)),r.push(t),e},l=()=>new Map;t.groupBy=function(e,t){return(0,o.listTransform)({listStep:e,itemPlanCallback:t,initialState:l,reduceCallback:i,listItem:(0,a.isListCapableStep)(e)?t=>(0,s.each)(t,(t=>e.listItem(t))):void 0,meta:`groupBy:${r.default.yellow(e.id)}${t.name?`/${t.name}`:""}`})}},76241:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reverseArray=t.reverse=t.RemapKeysStep=t.remapKeys=t.partitionByIndex=t.ObjectStep=t.object=t.specFromNodeId=t.NodeStep=t.node=t.makeDecodeNodeId=t.listTransform=t.__ListTransformStep=t.ListenStep=t.listen=t.ListStep=t.list=t.LastStep=t.last=t.LambdaStep=t.lambda=t.groupBy=t.FirstStep=t.first=t.filter=t.ErrorStep=t.error=t.each=t.ConstantStep=t.constant=t.EdgeStep=t.ConnectionStep=t.connection=t.assertPageInfoCapableStep=t.assertEdgeCapableStep=t.AccessStep=t.access=t.TRAP_INHIBITED=t.TRAP_ERROR_OR_INHIBITED=t.TRAP_ERROR=t.trap=t.inhibitOnNull=t.assertNotNull=t.__FlagStep=t.debugPlans=t.trackedRootValue=t.trackedContext=t.rootValue=t.context=t.operationPlan=void 0,t.ProxyStep=t.proxy=t.PolymorphicBranchStep=t.polymorphicBranch=t.LoadStep=t.loadOneCallback=t.loadOne=t.loadManyCallback=t.loadMany=t.LoadedRecordStep=t.GraphQLResolverStep=t.graphqlResolver=t.graphqlItemHandler=t.GraphQLItemHandler=t.ConditionStep=t.condition=t.ApplyTransformsStep=t.applyTransforms=t.__ValueStep=t.__TrackedValueStep=t.__ItemStep=t.__InputStaticLeafStep=t.__InputObjectStep=t.__InputListStep=t.SideEffectStep=t.sideEffect=t.SetterStep=t.setter=t.ReverseStep=void 0;const r=n(35616),a=n(60977);function s(){return(0,r.currentLayerPlan)().operationPlan}t.operationPlan=s,t.context=function(){return s().contextStep},t.rootValue=function(){return s().rootValueStep},t.trackedContext=function(){return s().trackedContextStep},t.trackedRootValue=function(){return s().trackedRootValueStep},t.debugPlans=function(e){const t=(0,a.getDebug)();(0,a.setDebug)(!0);const n=e();return(0,a.setDebug)(t),n};var o=n(13612);Object.defineProperty(t,"__FlagStep",{enumerable:!0,get:function(){return o.__FlagStep}}),Object.defineProperty(t,"assertNotNull",{enumerable:!0,get:function(){return o.assertNotNull}}),Object.defineProperty(t,"inhibitOnNull",{enumerable:!0,get:function(){return o.inhibitOnNull}}),Object.defineProperty(t,"trap",{enumerable:!0,get:function(){return o.trap}}),Object.defineProperty(t,"TRAP_ERROR",{enumerable:!0,get:function(){return o.TRAP_ERROR}}),Object.defineProperty(t,"TRAP_ERROR_OR_INHIBITED",{enumerable:!0,get:function(){return o.TRAP_ERROR_OR_INHIBITED}}),Object.defineProperty(t,"TRAP_INHIBITED",{enumerable:!0,get:function(){return o.TRAP_INHIBITED}});var i=n(60351);Object.defineProperty(t,"access",{enumerable:!0,get:function(){return i.access}}),Object.defineProperty(t,"AccessStep",{enumerable:!0,get:function(){return i.AccessStep}});var l=n(67647);Object.defineProperty(t,"assertEdgeCapableStep",{enumerable:!0,get:function(){return l.assertEdgeCapableStep}}),Object.defineProperty(t,"assertPageInfoCapableStep",{enumerable:!0,get:function(){return l.assertPageInfoCapableStep}}),Object.defineProperty(t,"connection",{enumerable:!0,get:function(){return l.connection}}),Object.defineProperty(t,"ConnectionStep",{enumerable:!0,get:function(){return l.ConnectionStep}}),Object.defineProperty(t,"EdgeStep",{enumerable:!0,get:function(){return l.EdgeStep}});var c=n(20353);Object.defineProperty(t,"constant",{enumerable:!0,get:function(){return c.constant}}),Object.defineProperty(t,"ConstantStep",{enumerable:!0,get:function(){return c.ConstantStep}});var u=n(57828);Object.defineProperty(t,"each",{enumerable:!0,get:function(){return u.each}});var p=n(50981);Object.defineProperty(t,"error",{enumerable:!0,get:function(){return p.error}}),Object.defineProperty(t,"ErrorStep",{enumerable:!0,get:function(){return p.ErrorStep}});var d=n(79091);Object.defineProperty(t,"filter",{enumerable:!0,get:function(){return d.filter}});var f=n(29663);Object.defineProperty(t,"first",{enumerable:!0,get:function(){return f.first}}),Object.defineProperty(t,"FirstStep",{enumerable:!0,get:function(){return f.FirstStep}});var h=n(8689);Object.defineProperty(t,"groupBy",{enumerable:!0,get:function(){return h.groupBy}});var y=n(67133);Object.defineProperty(t,"lambda",{enumerable:!0,get:function(){return y.lambda}}),Object.defineProperty(t,"LambdaStep",{enumerable:!0,get:function(){return y.LambdaStep}});var b=n(78851);Object.defineProperty(t,"last",{enumerable:!0,get:function(){return b.last}}),Object.defineProperty(t,"LastStep",{enumerable:!0,get:function(){return b.LastStep}});var m=n(30910);Object.defineProperty(t,"list",{enumerable:!0,get:function(){return m.list}}),Object.defineProperty(t,"ListStep",{enumerable:!0,get:function(){return m.ListStep}});var g=n(47099);Object.defineProperty(t,"listen",{enumerable:!0,get:function(){return g.listen}}),Object.defineProperty(t,"ListenStep",{enumerable:!0,get:function(){return g.ListenStep}});var S=n(50186);Object.defineProperty(t,"__ListTransformStep",{enumerable:!0,get:function(){return S.__ListTransformStep}}),Object.defineProperty(t,"listTransform",{enumerable:!0,get:function(){return S.listTransform}});var P=n(95053);Object.defineProperty(t,"makeDecodeNodeId",{enumerable:!0,get:function(){return P.makeDecodeNodeId}}),Object.defineProperty(t,"node",{enumerable:!0,get:function(){return P.node}}),Object.defineProperty(t,"NodeStep",{enumerable:!0,get:function(){return P.NodeStep}}),Object.defineProperty(t,"specFromNodeId",{enumerable:!0,get:function(){return P.specFromNodeId}});var v=n(40058);Object.defineProperty(t,"object",{enumerable:!0,get:function(){return v.object}}),Object.defineProperty(t,"ObjectStep",{enumerable:!0,get:function(){return v.ObjectStep}});var w=n(10196);Object.defineProperty(t,"partitionByIndex",{enumerable:!0,get:function(){return w.partitionByIndex}});var O=n(10744);Object.defineProperty(t,"remapKeys",{enumerable:!0,get:function(){return O.remapKeys}}),Object.defineProperty(t,"RemapKeysStep",{enumerable:!0,get:function(){return O.RemapKeysStep}});var $=n(81754);Object.defineProperty(t,"reverse",{enumerable:!0,get:function(){return $.reverse}}),Object.defineProperty(t,"reverseArray",{enumerable:!0,get:function(){return $.reverseArray}}),Object.defineProperty(t,"ReverseStep",{enumerable:!0,get:function(){return $.ReverseStep}});var E=n(84180);Object.defineProperty(t,"setter",{enumerable:!0,get:function(){return E.setter}}),Object.defineProperty(t,"SetterStep",{enumerable:!0,get:function(){return E.SetterStep}});var _=n(92744);Object.defineProperty(t,"sideEffect",{enumerable:!0,get:function(){return _.sideEffect}}),Object.defineProperty(t,"SideEffectStep",{enumerable:!0,get:function(){return _.SideEffectStep}});var x=n(18523);Object.defineProperty(t,"__InputListStep",{enumerable:!0,get:function(){return x.__InputListStep}});var I=n(81925);Object.defineProperty(t,"__InputObjectStep",{enumerable:!0,get:function(){return I.__InputObjectStep}});var L=n(42213);Object.defineProperty(t,"__InputStaticLeafStep",{enumerable:!0,get:function(){return L.__InputStaticLeafStep}});var k=n(29002);Object.defineProperty(t,"__ItemStep",{enumerable:!0,get:function(){return k.__ItemStep}});var j=n(76340);Object.defineProperty(t,"__TrackedValueStep",{enumerable:!0,get:function(){return j.__TrackedValueStep}});var A=n(29294);Object.defineProperty(t,"__ValueStep",{enumerable:!0,get:function(){return A.__ValueStep}});var T=n(89191);Object.defineProperty(t,"applyTransforms",{enumerable:!0,get:function(){return T.applyTransforms}}),Object.defineProperty(t,"ApplyTransformsStep",{enumerable:!0,get:function(){return T.ApplyTransformsStep}});var R=n(57158);Object.defineProperty(t,"condition",{enumerable:!0,get:function(){return R.condition}}),Object.defineProperty(t,"ConditionStep",{enumerable:!0,get:function(){return R.ConditionStep}});var N=n(26446);Object.defineProperty(t,"GraphQLItemHandler",{enumerable:!0,get:function(){return N.GraphQLItemHandler}}),Object.defineProperty(t,"graphqlItemHandler",{enumerable:!0,get:function(){return N.graphqlItemHandler}}),Object.defineProperty(t,"graphqlResolver",{enumerable:!0,get:function(){return N.graphqlResolver}}),Object.defineProperty(t,"GraphQLResolverStep",{enumerable:!0,get:function(){return N.GraphQLResolverStep}});var D=n(62801);Object.defineProperty(t,"LoadedRecordStep",{enumerable:!0,get:function(){return D.LoadedRecordStep}}),Object.defineProperty(t,"loadMany",{enumerable:!0,get:function(){return D.loadMany}}),Object.defineProperty(t,"loadManyCallback",{enumerable:!0,get:function(){return D.loadManyCallback}}),Object.defineProperty(t,"loadOne",{enumerable:!0,get:function(){return D.loadOne}}),Object.defineProperty(t,"loadOneCallback",{enumerable:!0,get:function(){return D.loadOneCallback}}),Object.defineProperty(t,"LoadStep",{enumerable:!0,get:function(){return D.LoadStep}});var B=n(49419);Object.defineProperty(t,"polymorphicBranch",{enumerable:!0,get:function(){return B.polymorphicBranch}}),Object.defineProperty(t,"PolymorphicBranchStep",{enumerable:!0,get:function(){return B.PolymorphicBranchStep}});var C=n(3605);Object.defineProperty(t,"proxy",{enumerable:!0,get:function(){return C.proxy}}),Object.defineProperty(t,"ProxyStep",{enumerable:!0,get:function(){return C.ProxyStep}})},67133:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lambda=t.LambdaStep=void 0;const r=n(28326),a=n(30910),s=n(92744);class LambdaStep extends r.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"LambdaStep"};constructor(e,t){if(super(),this.fn=t,this.isSyncAndSafe=!1,this.allowMultipleOptimizations=!0,this.planDep=null!=e?this.addDependency(e):null,t.hasSideEffects)this.hasSideEffects=!0;else if(t.isSyncAndSafe){if("AsyncFunction"===t.constructor.name)throw new Error(`${this}'s callback claims to be syncAndSafe, however it is asynchronous`);this.isSyncAndSafe=!0}}toStringMeta(){return this.fn.displayName||this.fn.name}deduplicate(e){return e.filter((e=>e.fn===this.fn))}unbatchedExecute(e,t){return this.fn(t)}}t.LambdaStep=LambdaStep,t.lambda=function(e,t,n){if(void 0===n&&(n=!1),t.length>1)throw new Error("lambda callback should accept one argument, perhaps you forgot to destructure the arguments?");const r=Array.isArray(e)?new LambdaStep((0,a.list)(e),t):new LambdaStep(e,t);if(t.hasSideEffects)return console.trace("You passed a function with `hasSideEffects = true` to `lambda()`, you should use `sideEffect()` instead (it has the same signature). We've automatically corrected this, but you should fix it in your code so the types are correct."),(0,s.sideEffect)(e,t);if(n){if("AsyncFunction"===t.constructor.name)throw new Error("lambda call claims to be syncAndSafe, however the callback function is asynchronous");r.isSyncAndSafe=!0}return r}},78851:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.last=t.LastStep=void 0;const r=n(28326),a=n(30910);class LastStep extends r.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"LastStep"};constructor(e){super(),this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.unbatchedExecute=(e,t)=>t?.[t?.length-1],this.addDependency(e)}deduplicate(e){return e}optimize(){const e=this.getDep(0);return e instanceof a.ListStep?e.last():this}}t.LastStep=LastStep,t.last=function(e){return new LastStep(e)}},30910:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.list=t.ListStep=void 0;const r=n(28326),a=n(20353);class ListStep extends r.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ListStep"};constructor(e){super(),this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.optimizeMetaKey="ListStep";for(let t=0,n=e.length;t<n;t++)this.addDependency({step:e[t],skipDeduplication:!0})}toStringMeta(){return this.dependencies.map((e=>e.id)).join(",")}execute(e){let{indexMap:t,values:n}=e;return t((e=>n.map((t=>t.at(e)))))}unbatchedExecute(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n}deduplicate(e){return e}optimize(e){if(this.dependencies.every((e=>e instanceof a.ConstantStep))){const t=e.meta,n=this.dependencies.length;t[n]||(t[n]=[]);const r=t[n].find((e=>e.every(((e,t)=>e===this.dependencies[t].data)))),s=this.dependencies.some((e=>e.isSensitive));if(void 0!==r)return(0,a.constant)(r,s);{const e=this.dependencies.map((e=>e.data));return t[n].push(e),(0,a.constant)(e,s)}}return this}at(e){return this.getDep(e)}first(){return this.getDep(0)}last(){return this.getDep(this.dependencies.length-1)}}t.ListStep=ListStep,t.list=function(e){return new ListStep(e)}},50186:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listTransform=t.__ListTransformStep=void 0;const r=n(22970).__importStar(n(48282)),a=n(79554),s=n(61258),o=n(88784),i=n(35616),l=n(40354),c=n(28326),u=n(29002);class __ListTransformStep extends c.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"__ListTransformStep"};constructor(e){super(),this.isSyncAndSafe=!1;const{listStep:t,itemPlanCallback:n,initialState:r,reduceCallback:a,finalizeCallback:s,listItem:l,meta:p,optimize:d,connectionClone:f}=e;this.listStepDepId=this.addDependency(t),this.itemPlanCallback=n,this.initialState=r,this.reduceCallback=a,this.finalizeCallback=s,this.listItem=l,this.meta=p??null,void 0!==d&&(this.optimize=d),this.connectionClone=f,this.subroutineLayer=new o.LayerPlan(this.operationPlan,this.layerPlan,{type:"subroutine",parentStep:this});const h=(0,i.withGlobalLayerPlan)(this.subroutineLayer,t.polymorphicPaths,(()=>{const e=new u.__ItemStep(t);e.transformStepId=this.id,this.itemStepId=e.id;const n=(0,c.isListCapableStep)(t)?t.listItem(e):e,r=this.itemPlanCallback(n);return!this.isSyncAndSafe||e.isSyncAndSafe&&n.isSyncAndSafe&&r.isSyncAndSafe||(this.isSyncAndSafe=!1),r}));this.subroutineLayer.setRootStep(h),this.operationPlan.finishSubroutine(this,this.subroutineLayer)}toStringMeta(){return this.meta}getListStep(){return this.getDep(this.listStepDepId)}[l.$$deepDepSkip](){return this.getListStep()}dangerouslyGetListPlan(){return this.dependencies[this.listStepDepId]}deduplicate(e){return e.filter((e=>e.itemPlanCallback===this.itemPlanCallback&&e.initialState===this.initialState&&e.reduceCallback===this.reduceCallback&&e.finalizeCallback===this.finalizeCallback&&e.listItem===this.listItem))}optimize(){return this}async execute(e){let{indexForEach:t,indexMap:n,values:o,extra:i}=e;const l=i._bucket,c=this.subroutineLayer,{copyStepIds:u,rootStep:p}=c;if(null===p)throw new Error(`rootStep of ${c} must not be null.`);const d=new Map,f=[],h=[],y=new Map;let b=0;const m=this.operationPlan.dangerouslyGetStep(this.itemStepId),g=m.id;if(null==g)throw new Error("GrafastInternalError<b3a2bff9-15c6-47e2-aa82-19c862324f1a>: listItem layer plan has no rootStepId");const S=o[this.listStepDepId];if(m._isUnary){const e=S.at(0);d.set(g,(0,s.unaryExecutionValue)(Array.isArray(e)?e[0]:e))}else d.set(g,(0,s.batchExecutionValue)([]));for(const e of u){const t=l.store.get(e);if(!t)throw new Error(`GrafastInternalError<2be5c2c6-a7f8-4002-93a0-6ace5a89a962>: unary step '${e}' (${this.operationPlan.dangerouslyGetStep(e)}) listed in copyStepIds but not available in parent bucket for ${this}`);t.isBatch?d.set(e,(0,s.batchExecutionValue)([])):d.set(e,t)}if(t((e=>{const t=S.at(e);if(Array.isArray(t)){const n=[];y.set(e,n);for(let r=0,a=t.length;r<a;r++){const a=b++;n.push(a),f[a]=l.polymorphicPathList[e],h[a]=l.iterators[e];const s=d.get(g);s.isBatch&&s._setResult(a,t[r],0);for(const t of u){const n=d.get(t);if(n.isBatch){const r=l.store.get(t);n._setResult(a,r.at(e),r._flagsAt(e))}}}}})),b>0){const e=(0,s.newBucket)({layerPlan:c,size:b,store:d,flagUnion:l.flagUnion,polymorphicPathList:f,iterators:h},l.metaByMetaKey);await(0,s.executeBucket)(e,i._requestContext)}const P=d.get(p.id);return n((e=>{const t=S.at(e);if(null==t)return t;const n=y.get(e);if(!Array.isArray(t)||!Array.isArray(n))return console.warn(`Either list or values was not an array when processing ${this}`),null;const s=n.map((e=>P.at(e)));a.isDev&&r.strictEqual(t.length,s.length,"GrafastInternalError<c85b6936-d406-4801-9c6b-625a567d32ff>: The list and values length must match for a __ListTransformStep");const o=this.initialState(),i=t.reduce(((e,t,n)=>this.reduceCallback(e,t,s[n])),o);return this.finalizeCallback?this.finalizeCallback(i):i}))}}t.__ListTransformStep=__ListTransformStep,t.listTransform=function(e){return new __ListTransformStep(e)}},47099:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.listen=t.ListenStep=void 0;const r=n(79554),a=n(46510),s=n(28326),o=n(20353);class ListenStep extends s.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ListenStep"};constructor(e,t,n){void 0===n&&(n=e=>e),super(),this.itemPlan=n,this.isSyncAndSafe=!0;const r="string"==typeof t?(0,o.constant)(t):t,a=(0,s.isExecutableStep)(e)?e:(0,o.constant)(e,!1);this.pubsubDep=this.addDependency(a),this.topicDep=this.addDependency(r)}execute(){throw new Error("ListenStep cannot be executed, it can only be streamed")}stream(e){let{indexMap:t,values:n}=e;const s=n[this.pubsubDep],o=n[this.topicDep];return t((e=>{const t=s.at(e);if(!t)throw new a.SafeError("Subscription not supported",r.isDev?{hint:`${this.dependencies[this.pubsubDep]} did not provide a GrafastSubscriber; perhaps you forgot to add the relevant property to context?`}:{});const n=o.at(e);return t.subscribe(n)}))}}t.ListenStep=ListenStep,t.listen=function(e,t,n){return new ListenStep(e,t,n)}},62801:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loadOne=t.loadMany=t.LoadStep=t.LoadedRecordStep=t.loadManyCallback=t.loadOneCallback=void 0;const r=n(46510),a=n(28326),s=n(22722),o=n(60351);t.loadOneCallback=function(e){return e},t.loadManyCallback=function(e){return e};const i=new WeakMap;let l=0;class LoadedRecordStep extends a.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"LoadedRecordStep"};constructor(e,t,n,r){super(),this.isSingle=t,this.sourceDescription=n,this.ioEquivalence=r,this.isSyncAndSafe=!0,this.attributes=new Set,this.params=Object.create(null),this.addDependency(e)}toStringMeta(){return this.sourceDescription??null}get(e){return"plan"===this.operationPlan.phase&&this.ioEquivalence[e]?this.ioEquivalence[e]:(this.attributes.add(e),(0,o.access)(this,e))}setParam(e,t){if(!this.isSingle)throw new Error("setParam should not be called on list items - call it on the collection (`loadMany()` step)");this.params[e]=t}optimize(){const e=this.getDepDeep(0);if(e instanceof LoadStep){e.addAttributes(this.attributes);for(const[t,n]of Object.entries(this.params))e.setParam(t,n)}else console.warn(`LoadedRecordStep could not find the parent LoadStep; instead found ${e}`);return this.getDep(0)}execute(e){let{count:t,values:[n]}=e;return n.isBatch?n.entries:(0,s.arrayOfLength)(t,n.value)}}t.LoadedRecordStep=LoadedRecordStep;class LoadStep extends a.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"LoadStep"};constructor(e,t,n,r){super(),this.ioEquivalence=n,this.load=r,this.isSyncAndSafe=!1,this.loadOptions=null,this.loadOptionsKey="",this.attributes=new Set,this.params=Object.create(null),this.unaryDepId=null,this.addDependency(e),t&&(this.unaryDepId=this.addUnaryDependency(t))}toStringMeta(){return this.load.displayName||this.load.name}makeAccessMap(){const e=Object.create(null),t=this.getDep(0);if(null==this.ioEquivalence)return e;if("string"==typeof this.ioEquivalence)return e[this.ioEquivalence]=t,e;if(Array.isArray(this.ioEquivalence)){for(let n=0,r=this.ioEquivalence.length;n<r;n++){e[this.ioEquivalence[n]]=(0,a.isListLikeStep)(t)?t.at(n):(0,o.access)(t,[n])}return e}if("object"==typeof this.ioEquivalence){for(const n of Object.keys(this.ioEquivalence)){const r=this.ioEquivalence[n];null!=r&&(e[r]=(0,a.isObjectLikeStep)(t)?t.get(n):(0,o.access)(t,[n]))}return e}throw new Error("ioEquivalence passed to loadOne() or loadMany() call not understood")}listItem(e){return new LoadedRecordStep(e,!1,this.toStringMeta(),this.makeAccessMap())}single(){return new LoadedRecordStep(this,!0,this.toStringMeta(),this.makeAccessMap())}setParam(e,t){this.params[e]=t}addAttributes(e){for(const t of e)this.attributes.add(t)}finalize(){const e=(0,s.canonicalJSONStringify)(this.params),t=this.operationPlan.getStepsByStepClass(LoadStep).filter((t=>t.id!==this.id&&(t.load===this.load&&(0,s.canonicalJSONStringify)(t.params)===e)));for(const e of t)for(const t of e.attributes)this.attributes.add(t);this.loadOptions={attributes:[...this.attributes].sort(),params:this.params},this.loadOptionsKey=(0,s.canonicalJSONStringify)(this.loadOptions);let n=i.get(this.load);n||(n=String(++l),i.set(this.load,n)),this.metaKey=`LoadStep|${n}|${this.loadOptionsKey}`,super.finalize()}execute(e){let{count:t,values:[n,a],extra:s}=e;const o=s.meta;let i=o.cache;i||(i=new Map,o.cache=i);const l=new Map,c=!1===a?.isBatch?a.value:void 0,u=[];for(let e=0;e<t;e++){const t=n.at(e);if(i.has(t))u.push(i.get(t));else{const e=u.push(null)-1,n=l.get(t);void 0!==n?n.push(e):l.set(t,[e])}}const p=l.size;if(p>0){const e=(0,r.defer)(),t=[...l.keys()],n={deferred:e,batchSpecs:t};o.loadBatchesByLoad||(o.loadBatchesByLoad=new Map);let a=o.loadBatchesByLoad.get(this.load);if(a)a.push(n);else{a=[n],o.loadBatchesByLoad.set(this.load,a);const e=this.loadOptions;setTimeout((()=>{o.loadBatchesByLoad.delete(this.load),async function(e,t,n){try{const r=e.length;if(1===r){const[r]=e;return void r.deferred.resolve(t(r.batchSpecs,n))}{const a=[],s=[];for(let t=0;t<r;t++){const n=e[t];a[t]=s.length;for(const e of n.batchSpecs)s.push(e)}const o=await t(s,n);for(let t=0;t<r;t++){const n=e[t],r=a[t],i=a[t+1]??s.length,l=o.slice(r,i);n.deferred.resolve(l)}}}catch(t){for(const n of e)n.deferred.reject(t)}}(a,this.load,{...e,unary:c})}),0)}return(async()=>{const n=await e;for(let e=0;e<p;e++){const r=t[e],a=l.get(r),s=n[e];i.set(r,s);for(const e of a)u[e]=s}return u})()}return u}}function c(e,t,n,r){return new LoadStep(e,t,n,r)}t.LoadStep=LoadStep,t.loadMany=function(e,t,n,a){return a?c(e,t,n,a):(0,r.isExecutableStep)(t)?c(e,t,null,n):n?c(e,null,t,n):c(e,null,null,t)},t.loadOne=function(e,t,n,a){return a?c(e,t,n,a).single():(0,r.isExecutableStep)(t)?c(e,t,null,n).single():n?c(e,null,t,n).single():c(e,null,null,t).single()}},95053:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.makeDecodeNodeId=t.specFromNodeId=t.node=t.NodeStep=void 0;const r=n(79554),a=n(4730),s=n(68415),o=n(28326),i=n(60351),l=n(20353),c=n(67133);class NodeStep extends o.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"NodeStep"};constructor(e,t){super(),this.possibleTypes=e,this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.unbatchedExecute=(e,t)=>{const n=t?this.getTypeNameFromSpecifier(t):null;return n?(0,s.polymorphicWrap)(n):null};const n=u(Object.values(e));this.specPlanDep=this.addDependency(n(t))}planForType(e){const t=this.possibleTypes[e.name];return void 0!==t?t.get(t.getSpec((0,i.access)(this.getDep(this.specPlanDep),[t.codec.name]))):(0,l.constant)(null)}getTypeNameFromSpecifier(e){for(const[t,n]of Object.entries(this.possibleTypes)){const r=e[n.codec.name];if(null!=r&&n.match(r))return t}return r.isDev&&console.error(`Could not find a type that matched the specifier '${(0,a.inspect)(e)}'`),null}}function u(e){const t=[...new Set(e.map((e=>e.codec)))];function n(e){return null==e?null:t.reduce(((t,n)=>{try{t[n.name]=n.decode(e)}catch(e){t[n.name]=null}return t}),{raw:e})}return n.isSyncAndSafe=!0,e=>(0,c.lambda)(e,n)}t.NodeStep=NodeStep,t.node=function(e,t){return new NodeStep(e,t)},t.specFromNodeId=function(e,t){function n(t){try{const n=e.codec.decode(t);return e.match(n)?n:null}catch(e){return null}}n.displayName=`decode_${e.typeName}_${e.codec.name}`,n.isSyncAndSafe=!0;const r=(0,c.lambda)(t,n);return e.getSpec(r)},t.makeDecodeNodeId=u},40058:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.object=t.ObjectStep=void 0;const r=n(22970).__importStar(n(73177)),a=n(28326),s=n(20353),o=Object.freeze(Object.create(null));class ObjectStep extends a.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ObjectStep"};constructor(e){super(),this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.optimizeMetaKey="ObjectStep",this.metaKey=this.id,this.keys=Object.keys(e);for(let t=0,n=this.keys.length;t<n;t++)this.addDependency({step:e[this.keys[t]],skipDeduplication:!0})}set(e,t){this.keys.push(e),this.addDependency({step:t,skipDeduplication:!0})}getStepForKey(e,t){void 0===t&&(t=!1);const n=this.keys.indexOf(e);if(n<0){if(!t)throw new Error(`${this}: failed to retrieve plan for key '${String(e)}' - we have no such key`);return null}return this.getDep(n)}toStringMeta(){return"{"+this.keys.join(",")+"}"}tupleToObjectJIT(e){if(0===this.keys.length)return e((()=>o));const t=this.keys.every(r.isSafeObjectPropertyName)?r.default`\
  const newObj = {
${r.default.join(this.keys.map(((e,t)=>r.default`    ${r.default.safeKeyOrThrow(e)}: ${r.default.identifier(`val${t}`)}`)),",\n")}
  };
`:r.default`\
  const newObj = Object.create(null);
${r.default.join(this.keys.map(((e,t)=>r.default`  newObj${r.default.set(e,!0)} = ${r.default.identifier(`val${t}`)};\n`)),"")}\
`;return r.default.runInBatch(r.default`\
(function ({ meta }, ${r.default.join(this.keys.map(((e,t)=>r.default.identifier(`val${t}`))),", ")}) {
  if (meta.nextIndex) {
    for (let i = 0, l = meta.results.length; i < l; i++) {
      const [values, obj] = meta.results[i];
      if (${r.default.join(this.keys.map(((e,t)=>r.default`values[${r.default.lit(t)}] === ${r.default.identifier(`val${t}`)}`))," && ")}) {
        return obj;
      }
    }
  } else {
    meta.nextIndex = 0;
    if (!meta.results) {
      meta.results = [];
    }
  }
${t}
  meta.results[meta.nextIndex] = [[${r.default.join(this.keys.map(((e,t)=>r.default.identifier(`val${t}`))),",")}], newObj];
  // Only cache 10 results, use a round-robin
  meta.nextIndex = meta.nextIndex === 9 ? 0 : meta.nextIndex + 1;
  return newObj;
})`,e)}finalize(){return this.tupleToObjectJIT((e=>{this.unbatchedExecute=e})),super.finalize()}execute(e){let{indexMap:t,values:n,extra:r}=e;return t((e=>this.unbatchedExecute(r,...n.map((t=>t.at(e))))))}unbatchedExecute(e){throw new Error(`${this} didn't finalize? No unbatchedExecute method.`)}deduplicate(e){const t=JSON.stringify(this.keys);return e.filter((e=>JSON.stringify(e.keys)===t))}optimize(e){if(this.dependencies.every((e=>e instanceof s.ConstantStep))){const t=e.meta,n=this.keys.join(",");t[n]||(t[n]=[]);const r=t[n].find((e=>this.keys.every(((t,n)=>e[t]===this.dependencies[n].data)))),a=this.dependencies.some((e=>e.isSensitive));if(void 0!==r)return(0,s.constant)(r,a);{const e=Object.create(null);for(let t=0,n=this.keys.length;t<n;t++){const n=this.keys[t],r=this.dependencies[t].data;e[n]=r}return t[n].push(e),(0,s.constant)(e,a)}}return this}get(e){const t=this.keys.indexOf(e);if(t<0)throw new Error(`This ObjectStep doesn't have key '${String(e)}'; supported keys: '${this.keys.join("', '")}'`);return this.getDep(t)}}t.ObjectStep=ObjectStep,t.object=function(e){return new ObjectStep(e)}},10196:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.partitionByIndex=void 0;const r=n(22970).__importDefault(n(2645)),a=n(28326),s=n(57828),o=n(50186),i=(e,t,n)=>(e[n]||(e[n]=[]),e[n].push(t),e),l=(e,t,n)=>{const r=n-1;return e[r]||(e[r]=[]),e[r].push(t),e},c=()=>[];t.partitionByIndex=function(e,t,n){if(void 0===n&&(n=0),0!==n&&1!==n)throw new Error("partitionByIndex only supports 0- and 1-indexed lists currently; please use 'lambda' to convert your index");return(0,o.listTransform)({listStep:e,itemPlanCallback:t,initialState:c,reduceCallback:1===n?l:i,listItem:(0,a.isListCapableStep)(e)?t=>(0,s.each)(t,(t=>e.listItem(t))):void 0,meta:`partitionByIndex${n}:${r.default.yellow(e.id)}${t.name?`/${t.name}`:""}`})}},49419:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.polymorphicBranch=t.PolymorphicBranchStep=void 0;const r=n(46510),a=n(28326),s=n(20353);class PolymorphicBranchStep extends a.ExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"PolymorphicBranchStep"};constructor(e,t){super(),this.isSyncAndSafe=!0,this.addDependency(e),this.typeNames=Object.keys(t),this.matchers=Object.fromEntries(Object.entries(t).map((e=>{let[t,n]=e;const r={match:n.match??(e=>e.__typename===t),plan:n.plan??(e=>e)};return[t,r]})))}planForType(e){const t=this.matchers[e.name],n=this.getDep(0);return t?"function"==typeof t.plan?t.plan(n):n:(0,s.constant)(null)}execute(e){let{indexMap:t,values:[n]}=e;return t((e=>{const t=n.at(e);let a=null;if(null!=t)for(const e of this.typeNames)if(this.matchers[e].match(t)){a=e;break}return null!==a?(0,r.polymorphicWrap)(a,t):null}))}}t.PolymorphicBranchStep=PolymorphicBranchStep,t.polymorphicBranch=function(e,t){return new PolymorphicBranchStep(e,t)}},3605:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.proxy=t.ProxyStep=void 0;const r=n(40354),a=n(28326),s=n(22722);class ProxyStep extends a.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ProxyStep"};constructor(e,t){super(),this.isSyncAndSafe=!0,this.stream=void 0,this.$depId=e.id,this.addDependency(t)}toStringMeta(){return this.operationPlan.dangerouslyGetStep(this.$depId).toString()}addDependency(e){return super.addDependency(e)}execute(e){let{count:t,values:[n]}=e;return n.isBatch?n.entries:(0,s.arrayOfLength)(t,n.value)}unbatchedExecute(e,t){return t}}t.ProxyStep=ProxyStep,t.proxy=function(e,t){void 0===t&&(t=e);const n=new ProxyStep(e,t),a=new Proxy(n,(s=e,{get(e,t,n){if("deduplicate"===t)return()=>[n];if("optimize"===t)return delete e[r.$$proxy],()=>[e];if(t in e){const n=e[t];return"function"==typeof n?function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return n.apply(e,r)}:n}{const e=s[t];return"function"==typeof e?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(s,n)}:e}},has:(e,t)=>t in e||t in s,set(e,t,n,r){if(t in e)return Reflect.set(e,t,n,r);throw new Error(`Setting through a ProxyStep is currently forbidden (attempted to set '${String(t)}' on '${e}'`)},getPrototypeOf:e=>Object.getPrototypeOf(s)}));var s;return n[r.$$proxy]=a,a}},10744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.remapKeys=t.RemapKeysStep=void 0;const r=n(22970),a=r.__importDefault(n(2645)),s=r.__importStar(n(73177)),o=n(28326);class RemapKeysStep extends o.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"RemapKeysStep"};constructor(e,t){super(),this.actualKeyByDesiredKey=t,this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.addDependency(e)}toStringMeta(){return a.default.bold.yellow(String(this.dependencies[0].id))+":"+JSON.stringify(this.actualKeyByDesiredKey)}optimize(){for(const[e,t]of Object.entries(this.actualKeyByDesiredKey))if(String(e)!==String(t))return this;return this.getDep(0)}finalize(){!function(e,t){const n=Object.entries(e);n.every((e=>{let[t,n]=e;return(0,s.isSafeObjectPropertyName)(t)&&(0,s.isSafeObjectPropertyName)(n)}))?s.default.runInBatch(s.default`(function(obj) {
  return (obj == null ? obj : { ${s.default.join(n.map((e=>{let[t,n]=e;return s.default`${s.default.safeKeyOrThrow(t)}: obj${s.default.get(n)}`})),", ")} });
})`,t):t((t=>null==t?t:Object.keys(e).reduce(((n,r)=>(n[r]=t[e[r]],n)),Object.create(null))))}(this.actualKeyByDesiredKey,(e=>{this.mapper=e})),super.finalize()}execute(e){let{count:t,values:[n]}=e;return n.isBatch?n.entries.map(this.mapper):new Array(t).fill(this.mapper(n.value))}unbatchedExecute(e,t){return this.mapper(t)}deduplicate(e){const t=JSON.stringify(this.actualKeyByDesiredKey);return e.filter((e=>JSON.stringify(e.actualKeyByDesiredKey)===t))}}t.RemapKeysStep=RemapKeysStep,t.remapKeys=function(e,t){return new RemapKeysStep(e,t)}},81754:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reverse=t.ReverseStep=t.reverseArray=void 0;const r=n(28326);function a(e){if(!Array.isArray(e))throw new Error("Attempted to reverse an array, but what was passed wasn't an array");const t=e.length,n=[];for(let r=0;r<t;r++)n[r]=e[t-r-1];return n}t.reverseArray=a;class ReverseStep extends r.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"ReverseStep"};constructor(e){super(),this.isSyncAndSafe=!0,this.allowMultipleOptimizations=!0,this.addDependency(e)}execute(e){let{indexMap:t,values:[n]}=e;return t((e=>{const t=n.at(e);return null==t?t:a(t)}))}unbatchedExecute(e,t){return null==t?t:a(t)}deduplicate(e){return e}}t.ReverseStep=ReverseStep,t.reverse=function(e){return new ReverseStep(e)}},84180:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setter=t.SetterStep=void 0;const r=n(28326);class SetterStep extends r.ModifierStep{static#e=this.$$export={moduleName:"grafast",exportName:"SetterStep"};constructor(e){super(e),this.setters=new Map}set(e,t){this.setters.set(e,t)}apply(){for(const[e,t]of this.setters.entries())this.$parent.set(e,t)}}t.SetterStep=SetterStep,t.setter=function(e){return new SetterStep(e)}},92744:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sideEffect=t.SideEffectStep=void 0;const r=n(28326),a=n(30910);class SideEffectStep extends r.UnbatchedExecutableStep{static#e=this.$$export={moduleName:"grafast",exportName:"SideEffectStep"};constructor(e,t){super(),this.fn=t,this.isSyncAndSafe=!1,this.allowMultipleOptimizations=!1,this.hasSideEffects=!0,this.planDep=null!=e?this.addDependency(e):null}toStringMeta(){return this.fn.displayName||this.fn.name}unbatchedExecute(e,t){return this.fn(t)}}t.SideEffectStep=SideEffectStep,t.sideEffect=function(e,t){if(t.length>1)throw new Error("sideEffect callback should accept one argument, perhaps you forgot to destructure the arguments?");return Array.isArray(e)?new SideEffectStep((0,a.list)(e),t):new SideEffectStep(e,t)}},15306:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stringifyPayload=void 0,t.stringifyPayload=function(e,t){if(!t||"string"!=typeof e.data)return JSON.stringify(e);let n="{",r=!0;if(e.incremental)throw new Error("Haven't implemented incremental yet");if(void 0!==e.errors&&(r||(n+=","),r=!1,n+=`"errors":${JSON.stringify(e.errors)}`),void 0===e.data);else if(null===e.data)r||(n+=","),r=!1,n+='"data":null';else{if("string"!=typeof e.data)throw new Error("Expected data to be null, undefined, or a JSON string");r||(n+=","),r=!1,n+=`"data":${e.data}`}return void 0!==e.extensions&&(r||(n+=","),r=!1,n+=`"extensions":${JSON.stringify(e.extensions)}`),void 0!==e.label&&(r||(n+=","),r=!1,n+=`"label":${JSON.stringify(e.label)}`),void 0!==e.hasNext&&(r||(n+=","),r=!1,n+=`"hasNext":${JSON.stringify(e.hasNext)}`),n+="}",n}},73376:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.stripAnsi=t.ANSI_REGEXP=void 0,t.ANSI_REGEXP=/[\u001B\u009B][[\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\d\/#&.:=?%@~_]+)*|[a-zA-Z\d]+(?:;[-a-zA-Z\d\/#&.:=?%@~_]*)*)?\u0007)|(?:(?:\d{1,4}(?:;\d{0,4})*)?[\dA-PR-TZcf-nq-uy=><~]))/g,t.stripAnsi=function(e){return e.replace(t.ANSI_REGEXP,"")}},19569:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.subscribe=void 0;const r=n(94932),a=n(11663);t.subscribe=function(e,t,n){return(0,a.withGrafastArgs)(e,e.resolvedPreset??t??r.NULL_PRESET,e.outputDataAsString??n??!1)}},51086:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=Symbol.for("grafast"),r=globalThis;if(!0===r[n]);else if(r[n])console.trace(`WARNING: more than one version of the 'grafast' module has been instantiated - you must ensure there is exactly one grafast (e.g. using yarn "resolutions" or similar techniques). Try clearing your package lockfile and reinstalling. ${r[n].stack}`),r[n]=!0;else try{throw new Error("The first 'grafast' was installed here")}catch(e){r[n]=e}},62408:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.timeSource=void 0,t.timeSource="undefined"!=typeof performance&&"function"==typeof performance.now?performance:Date},22722:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.exportNameHint=t.hasItemPlan=t.assertNotAsync=t.canonicalJSONStringify=t.stepsAreInSamePhase=t.stepAMayDependOnStepB=t.stepADependsOnStepB=t.writeableArray=t.sudo=t.isTypePlanned=t.findVariableNamesUsed=t.arrayOfLengthCb=t.arrayOfLength=t.stack=t.sharedNull=t.getEnumValueConfig=t.inputObjectFieldSpec=t.newInputObjectTypeBuilder=t.newGrafastFieldConfigBuilder=t.objectFieldSpec=t.newObjectTypeBuilder=t.objectSpec=t.arraysMatch=t.isDeferred=t.isPromiseLike=t.isPromise=t.defaultValueToValueNode=t.assertNullPrototype=t.ROOT_VALUE_OBJECT=void 0;const r=n(22970),a=r.__importStar(n(45290)),s=r.__importStar(n(48282)),o=n(79554),i=n(40549),l=n(4730),{GraphQLBoolean:c,GraphQLEnumType:u,GraphQLFloat:p,GraphQLID:d,GraphQLInputObjectType:f,GraphQLInt:h,GraphQLInterfaceType:y,GraphQLList:b,GraphQLNonNull:m,GraphQLObjectType:g,GraphQLScalarType:S,GraphQLString:P,GraphQLUnionType:v,Kind:w}=a;function O(e){if(null==e)return{kind:w.NULL};if("boolean"==typeof e)return{kind:w.BOOLEAN,value:e};if("number"==typeof e)return e===Math.round(e)?{kind:w.INT,value:String(e)}:{kind:w.FLOAT,value:String(e)};if("string"==typeof e)return{kind:w.STRING,value:e};if(Array.isArray(e))return{kind:w.LIST,values:e.map(O)};if("object"==typeof e&&null!==e)return{kind:w.OBJECT,fields:Object.keys(e).map((t=>({kind:w.OBJECT_FIELD,name:{kind:w.NAME,value:t},value:O(e[t])})))};const t=e;throw console.error(`Unhandled type when converting custom scalar to ValueNode: ${(0,l.inspect)(t)}`),new Error("Unhandled type when converting custom scalar to ValueNode")}function $(e,t){if(e instanceof m){if(null==t)throw new Error("defaultValue contained null/undefined at a position that is marked as non-null");return $(e.ofType,t)}if(void 0===t)return;if(null===t)return{kind:w.NULL};if(e===c){if("boolean"!=typeof t)throw new Error("defaultValue contained invalid value at a position expecting boolean");return{kind:w.BOOLEAN,value:t}}if(e===h){if("number"!=typeof t)throw new Error("defaultValue contained invalid value at a position expecting int");return{kind:w.INT,value:String(parseInt(String(t),10))}}if(e===p){if("number"!=typeof t)throw new Error("defaultValue contained invalid value at a position expecting int");return{kind:w.FLOAT,value:String(t)}}if(e===P||e===d){if("string"!=typeof t)throw new Error("defaultValue contained invalid value at a position expecting string");return{kind:w.STRING,value:t}}if(e instanceof u){const n=e.getValues().find((e=>e.value===t));if(!n)throw console.error(`Default contained invalid value for enum ${e.name}: ${(0,l.inspect)(t)}`),new Error(`Default contained invalid value for enum ${e.name}`);return{kind:w.ENUM,value:n.name}}if(e instanceof S)return O(t);if(e instanceof b){if(!Array.isArray(t))throw new Error("defaultValue contained invalid value at location expecting a list");return{kind:w.LIST,values:t.map((t=>{const n=$(e.ofType,t);if(void 0===n)throw new Error("defaultValue contained invalid list (contained `undefined`)");return n}))}}if(e instanceof f){if("object"!=typeof t||null===t)throw new Error("defaultValue contained invalid value at location expecting an object");const n=e.getFields(),r=[];for(const e in n){const a=n[e],s=$(a.type,void 0!==t[e]?t[e]:a.defaultValue);void 0!==s&&r.push({kind:w.OBJECT_FIELD,name:{kind:w.NAME,value:e},value:s})}return{kind:w.OBJECT,fields:r}}const n=e;throw console.error(`Encountered unexpected type when processing defaultValue ${(0,l.inspect)(n)}`),new Error("Encountered unexpected type when processing defaultValue")}function E(e){return"object"==typeof e&&null!==e&&"function"==typeof e.then&&"function"==typeof e.catch}function _(e){const{assertStep:t,...n}=e;return{...n,...t?{extensions:{...e.extensions,grafast:{assertStep:t,...e.extensions?.grafast}}}:null,fields:()=>{const t="function"==typeof e.fields?e.fields():e.fields;return Object.keys(t).reduce(((n,r)=>(n[r]=x(t[r],`${e.name}.${r}`),n)),{})}}}function x(e,t){const{plan:n,subscribePlan:r,args:a,...s}=e;D(n,`${t??"?"}.plan`),D(r,`${t??"?"}.subscribePlan`);const o=a?Object.keys(a).reduce(((e,n)=>{const{inputPlan:r,applyPlan:s,autoApplyAfterParentPlan:o,autoApplyAfterParentSubscribePlan:i,...l}=a[n];return D(r,`${t??"?"}(${n}:).inputPlan`),D(s,`${t??"?"}(${n}:).applyPlan`),e[n]={...l,...r||s?{extensions:{grafast:{...r?{inputPlan:r}:null,...o?{autoApplyAfterParentPlan:o}:null,...s?{applyPlan:s}:null,...i?{autoApplyAfterParentSubscribePlan:i}:null}}}:null},e}),Object.create(null)):{};return{...s,args:o,...n||r?{extensions:{...s.extensions,grafast:{...s.extensions?.grafast,...n?{plan:n}:null,...r?{subscribePlan:r}:null}}}:null}}function I(e,t){const{inputPlan:n,applyPlan:r,autoApplyAfterParentInputPlan:a,autoApplyAfterParentApplyPlan:s,...o}=e;return D(n,`${t??"?"}.inputPlan`),D(r,`${t??"?"}.applyPlan`),n||r?{...o,extensions:{grafast:{...n?{inputPlan:n}:null,...r?{applyPlan:r}:null,...a?{autoApplyAfterParentInputPlan:a}:null,...s?{autoApplyAfterParentApplyPlan:s}:null}}}:o}t.ROOT_VALUE_OBJECT=Object.freeze(Object.create(null)),t.assertNullPrototype=function(e,t){o.isDev&&s.strictEqual(Object.getPrototypeOf(e),null,`Expected ${t} to have a null prototype`)},t.defaultValueToValueNode=function(e,t){if(void 0!==t)return $(e,t)},t.isPromise=E,t.isPromiseLike=function(e){return null!=e&&"function"==typeof e.then},t.isDeferred=function(e){return E(e)&&"function"==typeof e.resolve&&"function"==typeof e.reject},t.arraysMatch=function(e,t,n){if(e===t)return!0;const r=e.length;if(r!==t.length)return!1;if(void 0!==n){for(let a=0;a<r;a++)if(!n(e[a],t[a]))return!1}else for(let n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0},t.objectSpec=_,t.newObjectTypeBuilder=function(e){return t=>new g(_({assertStep:e,...t}))},t.objectFieldSpec=x,t.newGrafastFieldConfigBuilder=function(){return e=>e},t.newInputObjectTypeBuilder=function(){return e=>new f(function(e){return{...e,fields:()=>{const t="function"==typeof e.fields?e.fields():e.fields;return Object.keys(t).reduce(((n,r)=>(n[r]=I(t[r],`${e.name}.${r}`),n)),{})}}}(e))},t.inputObjectFieldSpec=I;const L=Symbol("valueConfigByValue");function k(e,t){switch(e.kind){case w.INT:case w.FLOAT:case w.STRING:case w.BOOLEAN:case w.NULL:case w.ENUM:return;case w.LIST:for(const n of e.values)k(n,t);return;case w.OBJECT:for(const n of e.fields)k(n.value,t);return;case w.VARIABLE:return void t.add(e.name.value);default:{const t=e;throw new Error(`Unsupported valueNode: ${JSON.stringify(t)}`)}}}function j(e,t){if(void 0!==e)for(const n of e)if(void 0!==n.arguments)for(const e of n.arguments)k(e.value,t)}function A(e,t,n){switch(j(t.directives,n),t.kind){case w.FIELD:return void T(e,t,n);case w.INLINE_FRAGMENT:j(t.directives,n);for(const r of t.selectionSet.selections)A(e,r,n);return;case w.FRAGMENT_SPREAD:{j(t.directives,n);const r=t.name.value,a=e.fragments[r];if(j(a.directives,n),a.variableDefinitions?.length)throw new i.SafeError("Grafast doesn't support variable definitions on fragments yet.");for(const t of a.selectionSet.selections)A(e,t,n);return}default:throw new Error(`Unsupported selection ${t.kind}`)}}function T(e,t,n){if(function(e,t){if(void 0!==e)for(const n of e)k(n.value,t)}(t.arguments,n),j(t.directives,n),void 0!==t.selectionSet)for(const r of t.selectionSet.selections)A(e,r,n)}function R(e){return e}function N(e,t){if(e===t)throw new Error("Invalid call to stepADependsOnStepB");for(const n of e.dependencies){if(n===t)return!0;if(N(n,t))return!0}return!1}t.getEnumValueConfig=function(e,t){if(!e[L]){const t=e.toConfig();e[L]=Object.values(t.values).reduce(((e,t)=>(e[t.value]=t,e)),Object.create(null))}return e[L][t]},t.sharedNull=Object.freeze(Object.create(null)),t.stack=function(e,t){void 0===t&&(t=4);try{throw new Error(e)}catch(e){const n=e.stack.split("\n"),r=n.findIndex((e=>e.startsWith("Error:")));if(r<0)return void console.dir(e.stack);const a=[n[r],...n.slice(r+2,r+2+t)].map((e=>e.replace(/^(.*?)\(\/home[^)]*\/packages\/([^)]*)\)/,((e,t,n)=>`${t}${" ".repeat(Math.max(0,45-t.length))}(${n})`))));console.log(a.join("\n"))}},t.arrayOfLength=function(e,t){const n=[];for(let r=0;r<e;r++)n[r]=t;return n},t.arrayOfLengthCb=function(e,t){const n=[];for(let r=0;r<e;r++)n[r]=t();return n},t.findVariableNamesUsed=function(e,t){const n=new Set;return T(e,t,n),[...n].sort()},t.isTypePlanned=function(e,t){if(t instanceof g)return!!t.extensions?.grafast?.assertStep;if(t instanceof v||t instanceof y){const n=t instanceof v?t.getTypes():e.getImplementations(t).objects;let r=null,a=0;for(const e of n){const s=!!e.extensions?.grafast?.assertStep;if(null===r)r=s;else if(s!==r)throw new Error(`The '${t.name}' interface or union type's first type '${n[0]}' ${r?"expected a plan":"did not expect a plan"}, however the type '${e}' (index = ${a}) ${s?"expected a plan":"did not expect a plan"}. All types in an interface or union must be in agreement about whether a plan is expected or not.`);a++}return!!r}return!1},t.sudo=R,t.writeableArray=function(e){return e},t.stepADependsOnStepB=N,t.stepAMayDependOnStepB=function(e,t){return!e.isFinalized&&(!(e._isUnaryLocked&&e._isUnary&&!t._isUnary)&&(!!e.layerPlan.ancestry.includes(t.layerPlan)&&!N(t,e)))},t.stepsAreInSamePhase=function(e,t){let n=t.layerPlan;do{if(n===e.layerPlan)return!0;const t=n.reason.type;switch(t){case"subscription":case"defer":case"polymorphic":return!1;case"listItem":if(n.reason.stream)continue;continue;case"root":case"nullableBoundary":case"subroutine":case"mutationField":continue;default:throw new Error(`Unhandled layer plan type '${t}'`)}}while(n=n.parentLayerPlan);throw new Error(`${t} is not dependent on ${e}, perhaps you passed the arguments in the wrong order?`)};function D(e,t){if("AsyncFunction"===e?.constructor?.name)throw new Error(`Plans must be synchronous, but this schema has an async function at '${t}': ${e.toString()}`)}t.canonicalJSONStringify=e=>JSON.stringify(e),t.assertNotAsync=D,t.hasItemPlan=function(e){return"itemPlan"in e&&"function"==typeof e.itemPlan},t.exportNameHint=function(e,t){("object"==typeof e&&null!=e||"function"==typeof e)&&("$exporter$name"in e?e.$exporter$name||(e.$exporter$name=t):Object.defineProperty(e,"$exporter$name",{writable:!0,value:t}))}},48651:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.version=void 0,t.version="0.1.1-beta.7"},67067:(e,t,n)=>{"use strict";n.d(t,{Z:()=>H});n(94521),n(49055),n(382),n(40924),n(12400);var r=n(15453),a=n(46510),s=n(19793),o=n(2784),i=n(52322),l=n(81044),c=n(97795),u=n(90508);const p=e=>{let{error:t,onClose:n}=e;return(0,i.jsxs)("div",{className:"errorPopup",children:[(0,i.jsx)("button",{className:"errorPopupClose",onClick:n,children:"🗙"}),(0,i.jsx)("div",{className:"errorPopupError",children:String(t)})]})},d=()=>(0,i.jsxs)("div",{style:{padding:7},children:["Community-funded OSS 🙏"," ",(0,i.jsx)("a",{title:"All our projects are supported by the community, please sponsor ongoing development",href:"https://graphile.org/sponsor/",target:"new",children:"please sponsor"})," ","💖"]}),f=(0,o.createContext)({explainHelpers:{showExplain:!1,explainSize:0,explainAtBottom:!0,setExplainSize:()=>{},setExplainAtBottom:()=>{},setShowExplain:()=>{}},explain:!0,setExplain:()=>{},explainResults:null});var h=n(54981),y=n(15390),b=n(45308);const m=e=>"object"==typeof e&&e&&"string"==typeof e.type&&"string"==typeof e.title;function g(e){return e.startsWith("/")?`ws${"https:"===window.location.protocol?"s":""}://${window.location.host}${e}`:/^https?:\/\//.test(e)?`ws${e.substring(4)}`:e}function S(e,t){const n=e[t];delete e[t],Object.defineProperty(e,t,{value:n,enumerable:!1})}const P=function(e,t){void 0===t&&(t={});const[n,r]=(0,o.useState)(null),a=e.endpoint??"/graphql",s=a.startsWith("/")?("undefined"!=typeof window?window.location.origin:"")+a:a,i=e.subscriptionEndpoint?g(e.subscriptionEndpoint):e.endpoint?g(e.endpoint):void 0,[l,c]=(0,o.useState)(null);(0,o.useEffect)((()=>{s&&r(null)}),[s]);const u=t.explain&&(!e.debugTools||e.debugTools.includes("explain")),p=!!t.verbose,d=(0,o.useMemo)((()=>function(){const e=fetch(...arguments);return e.then((e=>{const t=e.headers.get("X-GraphQL-Event-Stream");if("string"==typeof t){const e=new URL(t,s);r(e.toString())}}),(()=>{})),e}),[s]),f=(0,o.useMemo)((()=>{const e=u?{"X-PostGraphile-Explain":"on","X-GraphQL-Explain":"plan,sql"}:{};return{url:s,headers:e,wsConnectionParams:e,fetch:d,subscriptionUrl:i}}),[u,s,i,d]),P=(0,o.useMemo)((()=>e.fetcher??(0,h.nq)(f)),[f,e.fetcher]),v=(0,o.useMemo)((()=>{const e=t=>{if(null==t)return t;if(Array.isArray(t))return t.map(e);const n={...t,...t.extensions?{extensions:{...t.extensions}}:null},r=n.explain;if(n.extensions?.explain){const e=n.extensions.explain;"object"==typeof e&&(e=>e&&Array.isArray(e.operations)&&e.operations.every(m))(e)?setTimeout((()=>{c(e)}),100):console.warn("The response had `extensions.explain` set, but in an incompatible format."),p||(1===Object.keys(n.extensions).length?S(n,"extensions"):S(n.extensions,"explain"))}else r&&setTimeout((()=>{c({operations:r.map(((e,t)=>({type:"sql",title:`Legacy explain ${t+1}`,query:e.query,explain:e.plan})))})}),100);return n};return async function(){const t=await P(...arguments);if((e=>{try{if("IntrospectionQuery"===e.operationName)return!0;if(e.operationName)return!1;const t=(0,y.Qc)(e.query),n=(0,b.S)(t,e.operationName);return"IntrospectionQuery"===n?.name?.value}catch(e){return!1}})(arguments.length<=0?void 0:arguments[0]))return t;if(setTimeout((()=>{c(null)}),100),"subscribe"in t)return t;if((0,h.D0)(t)){const n=t[Symbol.asyncIterator]();return{throw:n.throw?.bind(n),return:n.return?.bind(n),next(){const t=n.next(...arguments);if((0,h.tI)(t))return t.then((t=>{let{done:n,value:r}=t;return{done:n,value:e(r)}}));{const{done:n,value:r}=t;return{done:n,value:e(r)}}},[Symbol.asyncIterator](){return this}}}return e(t)}}),[P,p]);return{fetcher:v,explainResults:l,streamEndpoint:n}},v={saveHeaders:"Ruru:saveHeadersText",explain:"Ruru:explain",explainSize:"Ruru:explainSize",explainIsOpen:"Ruru:explainIsOpen",explainAtBottom:"Ruru:explainAtBottom",explorerIsOpen:"graphiql:explorerIsOpen",verbose:"Ruru:verbose"},w=e=>e+1,O=()=>{const e="undefined"!=typeof window?window.localStorage:null,[t,n]=(0,o.useState)(0),[r]=(0,o.useState)(Object.create(null));return(0,o.useMemo)((()=>e?{_revision:t,get(t){const n=e.getItem(v[t]);return"null"===n||"undefined"===n?(e.removeItem(v[t]),null):n??null},set(t,r){e.setItem(v[t],r),n(w)},toggle(e){this.get(e)?this.set(e,""):this.set(e,"true")}}:{_revision:t,get:e=>r[e]??null,set(e,t){r[e]=t},toggle(e){r[e]=r[e]?"":"true"}}),[e,t,r])};var $=n(79912),E=n(28316);const _=e=>{let{text:t,json:n,children:r}=e;const a=(0,o.useMemo)((()=>t??(void 0!==n?JSON.stringify(n):void 0)),[t,n]),s=(0,o.useRef)(null),l=(0,o.useCallback)((()=>{const e=s.current;e&&(e.select(),e.setSelectionRange(0,99999),navigator.clipboard.writeText(e.value))}),[]);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("textarea",{ref:e=>{s.current=e},value:a,readOnly:!0,style:{display:"none"}}),(0,i.jsx)("button",{onClick:l,children:r})]})},x=e=>{let{sql:t}=e;const[n,r]=(0,o.useState)(null),a=(0,o.useMemo)((()=>{const e=t.split("\n"),a=[],s=new Map;let o=0;const l=e=>{const t=[];let a=0;const l=/__([a-zA-Z0-9](_?[a-zA-Z0-9])*)(__|_[0-9]+(?![a-zA-Z0-9_]))/g;let c;for(;c=l.exec(e);){const u=c.index,p=l.lastIndex;u>a&&t.push((0,i.jsx)(i.Fragment,{children:e.substring(a,u)})),a=p;const[d]=c,f=s.get(d);if(f)t.push(f);else{const e=o++,a=(0,i.jsx)(L,{n:e,highlit:e===n,setHighlitIndex:r,children:d});s.set(d,a),t.push(a)}}return a<e.length&&t.push((0,i.jsx)(i.Fragment,{children:e.substring(a)})),t};for(let t=0,n=e.length;t<n;t++){const n=l(e[t]);a.push((0,i.jsx)("code",{style:{display:"block",marginLeft:"1.8rem",textIndent:"-1.8rem"},children:n},t))}return a}),[t,n]);return(0,i.jsx)("pre",{className:"explain-sql",children:a})},I=["#00bfff","#ffa500","#7fff00","#ff1493","#808000","#dda0dd","#ff0000","#4169e1","#3cb371","#a52a2a","#ff00ff"],L=e=>{let{n:t,highlit:n,setHighlitIndex:r,children:a}=e;const s=I[t%I.length],l=n?{color:s,borderRadius:"3px",fontWeight:"900",backgroundColor:"hsla(var(--color-primary),var(--alpha-background-medium))"}:{color:s},c=(0,o.useCallback)((()=>{r(t)}),[r,t]),u=(0,o.useCallback)((()=>{r(null)}),[r]);return(0,i.jsx)("strong",{style:l,onMouseEnter:c,onMouseLeave:u,children:a})};let k=!1;const j=e=>{let{plan:t}=e;const n=(0,o.useMemo)((()=>(0,$.planToMermaid)(t)),[t]);return(0,o.useEffect)((()=>{window.mermaid&&(k||(k=!0,window.mermaid.initialize({startOnLoad:!0,maxTextSize:1e6})),n&&window.mermaid.contentLoaded())}),[n]),window.mermaid?(0,i.jsx)("div",{className:"mermaid",children:n},n):(0,i.jsx)("div",{children:"Mermaid hasn't (yet) loaded, so we cannot render plan diagrams"})},A=e=>{let{explain:t,setExplain:n,helpers:r,results:a}=e;return(0,i.jsx)(i.Fragment,{children:a?0===a.operations.length?(0,i.jsx)("p",{children:"Empty explain results"}):(0,i.jsx)("div",{children:(0,i.jsx)(T,{helpers:r,results:a})}):t?(0,i.jsx)("p",{children:"There are no explain results to display - perhaps you have not yet ran an operation against a server that supports this feature?"}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("p",{children:"WARNING: you've not enabled the 'explain' functionality"}),(0,i.jsx)("p",{children:(0,i.jsx)("button",{onClick:()=>n(!0),children:"Enable explain"})})]})})},T=e=>{let{results:t}=e;const[n,r]=(0,o.useState)(0);(0,o.useEffect)((()=>{r(0)}),[t]);const a=t.operations[n],[s,l]=(0,o.useState)(!1),c=(0,o.useCallback)((()=>{l(!0)}),[]),u=(0,o.useRef)();u.current||(u.current=document.createElement("div"));const p=u.current;(0,o.useEffect)((()=>(document.body.appendChild(p),()=>{document.body.removeChild(p)})),[p]);const[d,f]=(0,o.useState)(!1),h=(0,o.useCallback)((()=>{a&&"plan"===a.type&&(f(!0),setTimeout((()=>{if(window.mermaid){const e=(0,$.planToMermaid)(a.plan);window.mermaid.mermaidAPI.render("id1",e,(e=>{const t=new File([e.replace(/<br>/g,"<br/>")],"grafast-plan.svg"),n=document.createElement("a");n.href=URL.createObjectURL(t),n.download=t.name,n.style.display="none",document.body.appendChild(n),n.click(),f(!1),setTimeout((()=>{URL.revokeObjectURL(n.href),n.parentNode.removeChild(n)}),0)}))}else alert("Mermaid hasn't loaded (yet)")}),0))}),[a]),y=(()=>{switch(a?.type){case"sql":return(0,i.jsxs)("div",{children:[a.explain?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("h4",{children:["Result from SQL"," ",(0,i.jsx)("a",{href:"https://www.postgresql.org/docs/current/sql-explain.html",children:"EXPLAIN"})," ","on executed query:"]}),(0,i.jsx)("pre",{className:"explain-plan",children:(0,i.jsx)("code",{children:a.explain})}),(0,i.jsx)(_,{text:a.explain,children:"Copy plan"})]}):null,(0,i.jsx)("h4",{children:"Executed SQL query:"}),(0,i.jsx)(x,{sql:a.query}),(0,i.jsx)(_,{text:a.query,children:"Copy SQL"})]});case"plan":return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(_,{json:a.plan,children:"Copy plan JSON"}),(0,i.jsx)("button",{onClick:h,disabled:d,children:"Save Mermaid Diagram"}),(0,i.jsx)("div",{onClick:c,children:(0,i.jsx)(j,{plan:a.plan})}),s?(0,E.createPortal)((0,i.jsxs)("div",{className:"explainExpandedContainer",children:[(0,i.jsx)("div",{className:"explainExpandedTitle",children:"Operation Plan"}),(0,i.jsx)("div",{className:"explainExpandedCloseContainer",children:(0,i.jsx)("button",{className:"explainExpandedCloseButton",onClick:()=>l(!1),children:"×"})}),(0,i.jsx)("div",{className:"explainExpandedMain",children:(0,i.jsx)(j,{plan:a.plan})})]}),p):null]});case void 0:return(0,i.jsxs)("div",{children:["Explain result type '$",a.type,"' not yet supported."]});default:return(0,i.jsx)("div",{})}})();return(0,i.jsxs)("div",{children:[(0,i.jsx)("select",{value:String(n),onChange:e=>r(parseInt(e.target.value,10)),children:t.operations.map(((e,t)=>(0,i.jsx)("option",{value:String(t),children:e.title},t)))}),y]})},R={title:"Explain",icon:c._V,content:()=>{const{explainHelpers:e,explain:t,explainResults:n,setExplain:r}=(0,o.useContext)(f);return(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"graphiql-doc-explorer-header",children:(0,i.jsx)("div",{className:"graphiql-doc-explorer-title",children:"Explain"})}),(0,i.jsx)("div",{className:"graphiql-doc-explorer-content",children:(0,i.jsx)(A,{explain:t,setExplain:r,helpers:e,results:n})})]})}};if(c.j$!==u.j$)throw new Error("PACKAGE MANAGEMENT ERROR! The providers don't match up!");const N={width:"1.5rem",display:"inline-block"},D=(0,i.jsx)("span",{style:N,children:"✔"}),B=(0,i.jsx)("span",{style:N}),C=[(0,l.o)({showAttribution:!1}),R],F=e=>{const t=O(),n="true"===t.get("explain"),r="true"===t.get("verbose"),a="true"===t.get("saveHeaders"),s=(0,o.useCallback)((e=>{t.set("explain",e?"true":"")}),[t]),{fetcher:l,explainResults:c,streamEndpoint:p}=P(e,{explain:n,verbose:r}),[d,h]=(0,o.useState)(null),y=(e=>{const[t,n]=(0,o.useState)("true"===e.get("explainIsOpen")),[r,a]=(0,o.useState)(parseInt(e.get("explainSize")??"",10)||300),[s,i]=(0,o.useState)([null,"true"].includes(e.get("explainAtBottom"))),l=(0,o.useCallback)((t=>{n(t),t&&e.set("explain","true"),e.set("explainIsOpen",t?"true":"")}),[e]),c=(0,o.useCallback)((t=>{i(t),e.set("explainAtBottom",t?"true":"")}),[e]);return{showExplain:t,explainSize:r,explainAtBottom:s,setExplainSize:(0,o.useCallback)((t=>{a(t),e.set("explainSize",String(t))}),[e]),setExplainAtBottom:c,setShowExplain:l}})(t),b=e.defaultQuery??'# Welcome to Ruru, our distribution of GraphiQL and related tooling to\n# inspect your GraphQL API.\n#\n# GraphiQL is an in-browser tool for writing, validating, and\n# testing GraphQL queries.\n#\n# Type queries into this side of the screen, and you will see intelligent\n# typeaheads aware of the current GraphQL type schema and live syntax and\n# validation errors highlighted within the text.\n#\n# GraphQL queries typically start with a "{" character. Lines that starts\n# with a # are ignored.\n#\n# An example GraphQL query might look like:\n#\n#     {\n#       field(arg: "value") {\n#         subField\n#       }\n#     }\n#\n# Keyboard shortcuts:\n#\n#  Prettify Query:  Shift-Ctrl-P (or press the prettify button above)\n#\n#     Merge Query:  Shift-Ctrl-M (or press the merge button above)\n#\n#       Run Query:  Ctrl-Enter (or press the play button above)\n#\n#   Auto Complete:  Ctrl-Space (or just start typing)\n#\n';return(0,i.jsx)(f.Provider,{value:{explainHelpers:y,explain:n,setExplain:s,explainResults:c},children:(0,i.jsx)(u.j$,{inputValueDeprecation:!0,schemaDescription:!0,fetcher:l,defaultQuery:b,query:e.query??e.initialQuery,variables:e.variables??e.initialVariables,plugins:C,shouldPersistHeaders:a,children:(0,i.jsx)(G,{storage:t,editorTheme:e.editorTheme,error:d,setError:h,onEditQuery:e.onEditQuery,onEditVariables:e.onEditVariables,streamEndpoint:p})})})},G=e=>{const{storage:t,editorTheme:n,error:r,setError:a,onEditQuery:s,onEditVariables:l,streamEndpoint:f}=e,h=(()=>{const e=(0,c._i)(),t=(0,c.fE)();return(0,o.useCallback)((()=>{const n=e?.queryEditor;n&&(n&&void 0!==window.prettier&&void 0!==window.prettierPlugins?n.setValue(window.prettier.format(n.getValue(),{parser:"graphql",plugins:window.prettierPlugins})):t())}),[e?.queryEditor,t])})(),y=(0,c.pQ)(),b=(0,c.Xd)();return((e,t,n)=>{const[r,a]=(0,o.useState)(null),s=(0,o.useRef)(null);(0,o.useEffect)((()=>{s.current=n?new EventSource(n):null;const e=s.current;return()=>{e&&(e.close(),s.current!==e&&console.error("Logic error in EventSource handling in useGraphQLChangeStream"),s.current=null)}}),[n]);const i=s.current;(0,o.useEffect)((()=>{if(i){if(i.readyState===i.CLOSED)throw new Error("Lifecycle management error for EventSource");const e=()=>{console.log("Ruru: Listening for server sent events"),a(null),t()},n=e=>{console.error("Ruru: Failed to connect to event stream",e),a(new Error("Failed to connect to event stream"))};return i.addEventListener("change",t,!1),i.addEventListener("open",e,!1),i.addEventListener("error",n,!1),()=>{i.removeEventListener("change",t,!1),i.removeEventListener("open",e,!1),i.removeEventListener("error",n,!1)}}}),[r,i,t,n])})(0,(0,c.J5)({nonNull:!0}).introspect,f),(0,i.jsxs)("div",{className:"graphiql-container",style:{position:"absolute",width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,i.jsx)("div",{style:{display:"flex",flex:"1 1 100%",overflow:"hidden",position:"relative"},children:(0,i.jsxs)(u.Ax,{editorTheme:n??"graphiql",onEditQuery:s,onEditVariables:l,children:[(0,i.jsx)(u.yB.Logo,{children:(0,i.jsx)("a",{href:"https://grafast.org/ruru",style:{textDecoration:"none"},target:"_blank",rel:"noreferrer",children:"Ruru"})}),(0,i.jsxs)(u.yB.Toolbar,{children:[(0,i.jsx)(c.wC,{onClick:h,label:"Prettify Query (Shift-Ctrl-P)",children:(0,i.jsx)(c.Kt,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(0,i.jsx)(c.wC,{onSelect:y,label:"Merge Query (Shift-Ctrl-M)",children:(0,i.jsx)(c.Rn,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(0,i.jsx)(c.wC,{onClick:b,label:"Copy query (Shift-Ctrl-C)",children:(0,i.jsx)(c.TI,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),(0,i.jsxs)(c.HM,{label:"Options",button:(0,i.jsx)(c.wC,{label:"Options",children:(0,i.jsx)(c.ew,{className:"graphiql-toolbar-icon","aria-hidden":"true"})}),children:[(0,i.jsx)(c.HM.Item,{title:"View the SQL statements that this query invokes",onSelect:()=>t.toggle("explain"),children:(0,i.jsxs)("span",{children:["true"===t.get("explain")?D:B,"Explain (if supported)"]})}),(0,i.jsx)(c.HM.Item,{title:"Don't hide explain from results",onSelect:()=>t.toggle("verbose"),children:(0,i.jsxs)("span",{children:["true"===t.get("verbose")?D:B,"Verbose"]})}),(0,i.jsx)(c.HM.Item,{title:"Should we persist the headers to localStorage? Header editor is next to variable editor at the bottom.",onSelect:()=>t.toggle("saveHeaders"),children:(0,i.jsxs)("span",{children:["true"===t.get("saveHeaders")?D:B,"Save headers"]})})]})]}),(0,i.jsx)(u.yB.Footer,{children:(0,i.jsx)(d,{})})]})}),r?(0,i.jsx)(p,{error:r,onClose:()=>a(null)}):null]})},M={container:"container_xh9R",editors:"editors_Zna6",editor:"editor_oZOQ",ruru:"ruru_PSgE"},V="query Example {\n  meaningOfLife: addTwoNumbers(a:37, b:5)\n}\n",z="type Query {\n  addTwoNumbers(a: Int!, b: Int!): Int\n}\n",U="const plans = {\n  Query: {\n    addTwoNumbers(_, { $a, $b }) {\n      return lambda([$a, $b], ([a, b]) => a + b, true);\n    },\n  },\n};\n";function H(){const[e,t]=(0,o.useState)(z),[n,r]=(0,o.useState)(U),i=(0,o.useMemo)((()=>{try{const t=new Function("Grafast",`with (Grafast) {\n  ${n};\n  return plans;\n}\n`)(a);return(0,a.makeGrafastSchema)({typeDefs:e,plans:t,enableDeferStream:!1})}catch(e){return e}}),[n,e]),l=(0,o.useCallback)((async e=>{let{query:t,operationName:n,variables:r}=e;if(i instanceof Error)return{errors:[new s.__(i)]};const o=await(0,a.grafast)({schema:i,source:t,operationName:n,variableValues:r},{grafast:{explain:["plan"]}});if(o.extensions){const{extensions:e,...t}=o;return Object.defineProperty(t,"extensions",{value:e}),t}return o}),[i]);return o.createElement("div",{className:M.container},o.createElement("div",{className:M.ruru},o.createElement(F,{fetcher:l,defaultQuery:V})),o.createElement("div",{className:M.editors},o.createElement("div",{className:M.editor},o.createElement("h4",null,"typeDefs.graphql"),o.createElement(q,{lang:"graphql",value:e,onValueChange:t})),o.createElement("div",{className:M.editor},o.createElement("h4",null,"plans.js"),o.createElement(q,{lang:"js",value:n,onValueChange:r}))))}const q=e=>{let{value:t,onValueChange:n,lang:a}=e;const s=(0,o.useMemo)((()=>({theme:"monokai",keyMap:"sublime",mode:a})),[a]);return o.createElement(r.ZP,{lazyLoadMode:!1,value:t,onChange:n,options:s})}},53870:(e,t)=>{"use strict";function n(e){return this.c.get(e)?.v}Object.defineProperty(t,"__esModule",{value:!0}),t.LRU=void 0;class LRU{constructor(e){let{maxLength:t,dispose:r}=e;if(t<2)throw new Error("Max length must be >= 2");if(parseInt(String(t),10)!==t)throw new Error("Max length must be an integer");this.length=0,this.m=t,this.h=null,this.t=null,this.c=new Map,this.d=r||null,this.s=!1,this.get=n,this.reset()}reset(){const e=this.c.values();if(this.c.clear(),this.h=null,this.t=null,this.length=0,null!==this.d)for(const t of e)this.d(t.k,t.v)}get(e){const t=this.c.get(e);if(void 0!==t)return null===this.h?this.h=this.t=t:t!==this.h&&(t.p.n=t.n,null!==t.n?t.n.p=t.p:this.t=t.p,t.n=this.h,this.h.p=t,this.h=t,t.p=null),t.v}set(e,t){const n=this.c.get(e);if(void 0!==n)n.v=t;else{const n={k:e,v:t,n:null,p:null};this.c.set(e,n),this.a(n)}}a(e){if(null===this.h)return this.h=this.t=e,void(this.length=1);if(this.h.p=e,e.n=this.h,this.h=e,this.s){const e=this.t;this.c.delete(e.k),this.t=e.p,this.t.n=null,null!==this.d&&this.d(e.k,e.v)}else 0===this.length&&(this.t=e),this.length++,this.length===this.m&&(this.s=!0,this.get=LRU.prototype.get)}}t.LRU=LRU,t.default=LRU},73177:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reservedWords=t.undefined=t.tmp=t.tempVar=t.te=t.substring=t.subcomment=t.set=t.safeKeyOrThrow=t.runInBatch=t.runExportable=t.run=t.ref=t.optionalGet=t.literal=t.lit=t.join=t.isTE=t.identifier=t.get=t.eval=t.debug=t.dangerouslyIncludeRawCode=t.dangerousKey=t.compile=t.cache=t.batch=t.Idents=t.EXPORTABLE=t.isSafeObjectPropertyName=t.toJSON=t.stringifyJSON=t.stringifyString=void 0;const r=n(6537);Object.defineProperty(t,"reservedWords",{enumerable:!0,get:function(){return r.reservedWords}});const a=n(97449);function s(e,t){const n=e.$$export;if(n){if(n.exportName!==t)throw new Error(`Attempted to export same thing under multiple names '${n.exportName}' and '${t}'`)}else Object.defineProperty(e,"$$export",{value:{moduleName:"tamedevil",exportName:t}});return e}const o="undefined"!=typeof process&&"development"===process.env.GRAPHILE_ENV;function i(e){return{[a.$$type]:"RAW",t:e}}function l(e,t){const n={[a.$$type]:"RAW",t:e};return s(n,t),n}function c(e,t){return Object.freeze({[a.$$type]:"REF",v:e,n:t})}function u(e){return Object.freeze({[a.$$type]:"INDENT",c:"QUERY"===e[a.$$type]?e:p([e])})}function p(e){return Object.freeze({[a.$$type]:"QUERY",n:e})}function d(e){return"object"==typeof e&&null!==e&&"string"==typeof e[a.$$type]}function f(e){const t=X.compile(e),n=Y(...Object.keys(t.refs),t.string).toString().split(/\r?\n/),r=String(n.length).length,a=n.map(((e,t)=>`${String(t+1).padStart(r," ")}: ${e}`));console.log("Outputting expression from tamedevil:"),console.dir(t.refs),console.log(a.join("\n"))}function h(e,t){if(d(e))return e;throw new Error(`[tamedevil] Invalid expression. Expected an TE item${t?` at ${t}`:""} but received '${String(e)}'. This may mean that there is an issue in the TE expression where a dynamic value was not escaped via 'te.ref(...)', an embedded string wasn't wrapped with 'te.string(...)', or a TE expression was added without using the \`te\` tagged template literal.`)}t.isTE=d,t.debug=f;const y=(e,t,n,r)=>{const a=t.get(n);if(a)return a;const s=t.size+1;if(s>65535)throw new Error("[tamedevil] This TE statement would contain too many placeholders; tamedevil supports at most 65535 placeholders. To solve this, consider passing multiple values in using a single array or object.");const o=r?function(e,t){if(!(t in e))return t;for(let n=0;n<1e6;n++){const r=t+n;if(!(r in e))return r}throw new Error("Failed to find an available variable name to use")}(e,r):`_$$_ref_${s}`;return t.set(n,o),e[o]=n,o},b=(e,t)=>{const n=e.get(t);if(n)return n;const r=`_$_tmp${e.size+1}`;return e.set(t,r),r};function m(e,t,n,r,s){void 0===s&&(s=0);let i="";switch(null==e&&h(e),e[a.$$type]){case"QUERY":for(const a of e.n)i+=m(a,t,n,r,s);break;case"RAW":if(""===e.t)break;i+=o?e.t.replace(/\n/g,"\n"+"  ".repeat(s)):e.t;break;case"REF":i+=y(t,n,e.v,e.n);break;case"VARIABLE":i+=b(r,e.s);break;case"INDENT":if(!o)throw new Error("INDENT nodes only allowed in development mode");i+="\n"+"  ".repeat(s+1),i+=m(e.c,t,n,r,s+1),i+="\n"+"  ".repeat(s);break;default:throw new Error(`Unsupported node found in TE: ${String(h(e))}`)}return i}function g(e){const t=Object.create(null),n=new Map,r=new Map;let a=m(e,t,n,r),s="";for(const e of r.values())s+=`let ${e};\n`;s.length>0&&(a=s+"\n"+a);return{string:o?a.replace(/\n\s*\n/g,"\n"):a,refs:t}}t.compile=g;const S=function(e){if(!Array.isArray(e)||!e.raw)throw new Error("[tamedevil] te should be used as a template literal, not a function call.");const t=e.length;if(1===t){const t=e[0];return""===t?E:"undefined"===t?_:i(t)}for(var n=arguments.length,r=new Array(n>1?n-1:0),s=1;s<n;s++)r[s-1]=arguments[s];if(2===t&&""===e[0]&&""===e[1]){const e=r[0];return void 0!==e[a.$$type]?e:h(e)}const o=[];let l=null,c="";const u=t-1;for(let n=0;n<t;n++){const t=e[n];if(c+=t,n!==u){const e=r[n],t=void 0!==e[a.$$type]?e:h(e,`literal placeholder ${n}`);if("RAW"===t[a.$$type])l=t,c+=t.t;else if("QUERY"===t[a.$$type]){const e=t.n,n=e.length;for(let t=0;t<n;t++){const n=e[t];"RAW"===n[a.$$type]?(l=n,c+=n.t):(""!==c&&(null!==l&&l.t===c||(l=i(c)),o.push(l),c=""),o.push(n))}}else""!==c&&(null!==l&&l.t===c||(l=i(c)),o.push(l),c=""),o.push(t)}}return""!==c&&(null!==l&&l.t===c||(l=i(c)),o.push(l),c=""),1===o.length?o[0]:p(o)},P=Object.create(null);function v(e){if(1!==e.length)throw new Error("te.cache can currently only be used with a static string");const t=e[0],n=P[t];if(n)return n;const r=i(t);return P[t]=r,r}t.cache=v;let w=!1;function O(e){if(!w){w=!0;try{throw new Error("te.dangerouslyIncludeRawCode first invoked here")}catch(e){console.warn(`[tamedevil] WARNING: you're using the te.dangerouslyIncludeRawCode escape hatch, usage of this API is rarely required and is highly discouraged due to the potential security ramifications. Please be sure this is what you intend. ${e.stack}`)}}if("string"!=typeof e)throw new Error(`[tamedevil] te.dangerouslyIncludeRawCode must be passed a string, but it was passed '${String(e)}'.`);return i(e)}function $(e,t){if(null!=t){if(!N(t))throw new Error(`Invalid variable name '${t}'`);return c(e,t)}return c(e)}t.dangerouslyIncludeRawCode=O,t.ref=$;const E=l("","blank"),_=l("undefined","undefined");t.undefined=_;const x=200,I="\\".charCodeAt(0),L='"'.charCodeAt(0);function k(e){const t=e.length;if(t>x)return JSON.stringify(e);for(let n=0;n<t;n++){const t=e.charCodeAt(n);if(t===I||t===L||0==(65504&t)||0!=(49152&t))return JSON.stringify(e)}return`"${e}"`}t.stringifyString=k;function j(e){if(void 0===e)return _;if(null===e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e&&Number.isFinite(e)){const n=e;return i((0,t.stringifyJSON)(n))}return $(e)}function A(e,t){if("string"!=typeof e||"string"!=typeof t)throw new Error("Invalid call to te.substring");const n=e.length;if(n<x){const r=t.charCodeAt(0);let a=!0;for(let t=0;t<n;t++){const n=e.charCodeAt(t);if(n===I||n===r||0==(65504&n)||0!=(49152&n)){a=!1;break}}if(a)return i(e)}const r=JSON.stringify(e),a=r.substring(1,r.length-1);return i('"'===t?a:"'"===t?a.replace(/'/g,"\\'"):a.replace(/[`$]/g,"\\$&"))}function T(e){return i(String(e).replace(/\*\//g,"* /"))}t.stringifyJSON=e=>{if(null==e)return"null";if(!0===e)return"true";if(!1===e)return"false";const t=typeof e;return"number"===t?""+e:"string"===t?k(e):JSON.stringify(e)},t.toJSON=t.stringifyJSON,t.lit=j,t.literal=j,t.substring=A,t.subcomment=T;const R=[...Object.getOwnPropertyNames(Object.prototype),...Object.getOwnPropertySymbols(Object.prototype)];R.includes("__proto__")||R.push("__proto__");t.isSafeObjectPropertyName=e=>("number"==typeof e||"symbol"==typeof e||"string"==typeof e&&/^(?:[0-9a-z$]|_[a-z0-9$])[a-z0-9_$]*$/i.test(e))&&!R.includes(e);function N(e){return!r.reservedWords.has(e)&&!!/^[a-zA-Z_$][a-zA-Z0-9_$]*$/.test(e)}function D(e){if("string"!=typeof e||!N(e))throw new Error(`Invalid identifier name '${e}'`);return i(e)}function B(e){if((0,t.isSafeObjectPropertyName)(e))return(e=>Number.isFinite(e)||"string"==typeof e&&("_"===e||/^(?:[a-z$]|_[a-z0-9$])[a-z0-9_$]*$/i.test(e)))(e)?i(String(e)):i(JSON.stringify(e));throw new Error(`Forbidden object key: ${JSON.stringify(e)}; consider using 'Object.create(null)' and assigning properties using te.lit.`)}function C(e){return e.length<x&&/^[$_a-zA-Z][$_a-zA-Z0-9]*$/.test(e)}function F(e){return"string"==typeof e&&C(e)?i(`.${e}`):"string"==typeof e||"number"==typeof e&&Number.isFinite(e)?i(`[${(0,t.stringifyJSON)(e)}]`):X`[${X.lit(e)}]`}function G(e){return"string"==typeof e&&C(e)?i(`?.${e}`):"string"==typeof e||"number"==typeof e&&Number.isFinite(e)?i(`?.[${(0,t.stringifyJSON)(e)}]`):X`?.[${X.lit(e)}]`}function M(e,n){if(void 0===n&&(n=!1),!n&&R.includes(e))throw new Error(`Attempted to set '${String(e)}' on an object that isn't declared as having a null prototype. This could be unsafe.`);return"string"==typeof e&&C(e)?i(`.${e}`):"string"==typeof e||"number"==typeof e&&Number.isFinite(e)?i(`[${(0,t.stringifyJSON)(e)}]`):X`[${X.lit(e)}]`}function V(e){if(void 0===e&&(e=Symbol()),"symbol"!=typeof e)throw new Error("Invalid call to te.tempVar");return function(e){return Object.freeze({[a.$$type]:"VARIABLE",s:e})}(e)}function z(e,t){const n=void 0!==e[a.$$type]?e:h(e),r=X.tempVar();return X`(${r} = ${n}, ${t(r)})`}function U(e,t,n){const r=e(...t);return"function"!=typeof r&&("object"!=typeof r||null===r)||"$exporter$factory"in r||Object.defineProperties(r,{$exporter$args:{value:t},$exporter$factory:{value:e},$exporter$name:{writable:!0,value:n}}),r}function H(e,t){void 0===t&&(t=!1);const n=g(void 0!==e[a.$$type]?e:h(e)),r=Object.keys(n.refs),s=Object.values(n.refs);if(o&&W)throw new Error("te.run called, but batch is active - recommend you use runInBatch");try{const e=Y(...r,n.string);return t?U(e,s):e(...s)}catch(e){throw console.error("Error occurred during code generation:"),console.error(e),console.error("Function definition:"),console.error(n.string),new Error("Error occurred during code generation.")}}function q(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("raw"in e)return q(X(e,...n));if(n.length>0)throw new Error("Invalid call to `te.run`");return H(e)}function Q(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if("raw"in e)return Q(X(e,...n));if(n.length>0)throw new Error("Invalid call to `te.runExportable`");return H(e,!0)}t.identifier=D,t.dangerousKey=B,t.safeKeyOrThrow=B,t.get=F,t.optionalGet=G,t.set=M,t.tempVar=V,t.tmp=z,t.EXPORTABLE=U,t.eval=q,t.run=q,t.runExportable=Q;let W=null;function K(e,t){if(!W)throw new Error("te.runInBatch failed - there's no active batch");W.push({fragment:e,callback:t})}function J(e){if(W)throw new Error("te.batch failed - there's already a batch in progress");let t;try{W=[],e(),t=W}finally{W=null}if(0===t.length)return;const n=X`return [\n${X.join(t.map((e=>e.fragment)),",\n")}\n];`,r=X.run(n);for(let e=0,n=t.length;e<n;e++)t[e].callback(r[e])}function Y(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Function(...t)}function Z(e,t){if(void 0===t&&(t=""),!Array.isArray(e))throw new Error(`[tamedevil] Invalid te.join call - the first argument should be an array, but it was '${String(e)}'.`);if("string"!=typeof t)throw new Error(`[tamedevil] Invalid separator passed to te.join - must be a string, but we received '${String(t)}'`);if(0===e.length)return E;if(1===e.length){const t=e[0];return void 0!==t[a.$$type]?t:h(t,"join item 0")}const n=t.length>0;let r="";const s=[];for(let o=0,l=e.length;o<l;o++){const l=e[o],c=void 0!==l[a.$$type]?l:h(l,`join item ${o}`);if(o>0&&n&&(r+=t),"QUERY"===c[a.$$type])for(const e of c.n)"RAW"===e[a.$$type]?r+=e.t:(""!==r&&(s.push(i(r)),r=""),s.push(e));else"RAW"===c[a.$$type]?r+=c.t:(""!==r&&(s.push(i(r)),r=""),s.push(c))}return""!==r&&(s.push(i(r)),r=""),1===s.length?s[0]:p(s)}t.runInBatch=K,t.batch=J,t.join=Z;t.Idents=class Idents{constructor(){this.idents=new Set(r.reservedWords)}forbid(e){for(const t in e)this.idents.add(t)}makeSafeIdentifier(e){const{idents:t}=this,n="i_"+e.replace(/[^a-zA-Z0-9_$]+/g,"").replace(/_+/,"_");let r;for(let e=1;e<1e4;e++){const a=n+(e>1?String(e):"");if(!t.has(a)){r=a;break}}if(!r)throw new Error("Too many identifiers!");return t.add(r),r}};const X=S;t.te=X,t.default=X;const ee={te:X,cache:v,ref:$,reference:$,lit:j,literal:j,substring:A,subcomment:T,join:Z,identifier:D,safeKeyOrThrow:B,dangerousKey:B,get:F,optionalGet:G,set:M,tmp:z,tempVar:V,run:q,eval:q,runExportable:Q,runInBatch:K,batch:J,compile:g,indent:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s="raw"in e?X(e,...n):void 0!==e[a.$$type]?e:h(e);return o?u(s):s},indentIf:function(e,t){const n=void 0!==t[a.$$type]?t:h(t);return o&&e?u(n):n},undefined:_,blank:E,isTE:d,debug:f,dangerouslyIncludeRawCode:O};Object.entries(ee).forEach((e=>{let[t,n]=e;n.$$export||s(n,t)})),Object.assign(S,ee)},6537:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.reservedWords=void 0,t.reservedWords=new Set(["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","false","finally","for","function","if","import","in","instanceof","new","null","return","super","switch","this","throw","true","try","typeof","var","void","while","with","let","static","yield","enum","implements","interface","package","private","protected","public","abstract","boolean","byte","char","double","final","float","goto","int","long","native","short","synchronized","throws","transient","volatile","arguments","as","import","require","eval","Function","from","get","of","in","set","null","undefined","Math","Number","BigInt","true","false","async","window","global","globalThis","process","require","import","constructor","class"])},97449:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.$$type=void 0;t.$$type=Symbol.for("tamedevil-type-1")},30410:(e,t,n)=>{"use strict";n.r(t),n.d(t,{contentTitle:()=>u,default:()=>y,frontMatter:()=>c,metadata:()=>p,toc:()=>d});var r=n(7896),a=n(2784),s=n(30876),o=n(69979),i=n(69854);function l(){return a.createElement(o.Z,null,(()=>{const e=n(67067).Z;return a.createElement(a.Fragment,null,a.createElement(i.Z,null,a.createElement("script",{src:"https://cdn.jsdelivr.net/npm/mermaid@9.4.3"})),a.createElement(e,null))}))}const c={title:"Playground",hide_title:!0,hide_table_of_contents:!0},u=void 0,p={type:"mdx",permalink:"/playground",source:"@site/src/pages/playground.mdx",title:"Playground",frontMatter:{title:"Playground",hide_title:!0,hide_table_of_contents:!0}},d=[],f={toc:d},h="wrapper";function y(e){let{components:t,...n}=e;return(0,s.kt)(h,(0,r.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)(l,{mdxType:"Playground"}))}y.isMDXComponent=!0},14015:()=>{},70838:()=>{},44256:()=>{},28211:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyHooks=t.AsyncHooks=void 0;const r=n(28446),a="development"===process.env.GRAPHILE_ENV;t.AsyncHooks=class AsyncHooks{constructor(){this.callbacks=Object.create(null)}hook(e,t){this.callbacks[e]=this.callbacks[e]||[],this.callbacks[e].push(t)}process(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=this.callbacks[e];if(!s)return;const o=s.length;let i;for(let t=0;t<o;t++){const r=s[t];if(void 0!==i)i=i.then((()=>r.apply(null,n)));else{const t=r.apply(null,n);if(null!=t){if(a&&"function"!=typeof t.then)throw new Error(`Hook '${e}' returned invalid value of type ${typeof t} - must be 'undefined' or a Promise/PromiseLike.`);i=t}}}return i}},t.applyHooks=function(e,t,n){const a=Object.create(null);let s=0;if(e)for(const n of e){const e=t(n);if(!e)continue;const r=Object.keys(e);for(const t of r){const r=e[t];if(!r)continue;const o=e=>"function"!=typeof e,i=(e=>"function"==typeof e)(r)?r:r.callback,{provides:l,before:c,after:u}=o(r)?r:{};a[t]||(a[t]=[]);const p=String(s++);a[t].push({id:p,plugin:n,callback:i,provides:[...l||[],p,n.name],before:c||[],after:u||[]})}}for(const e in a){const t=a[e];if(!t)continue;const s=(0,r.sortWithBeforeAfterProvides)(t,"id");for(const t of s)n(e,t.callback,t.plugin)}}},71678:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sortedPlugins=t.resolvePresets=t.isResolvedPreset=t.AsyncHooks=t.applyHooks=void 0,n(70783);const r=n(28446);var a=n(28211);Object.defineProperty(t,"applyHooks",{enumerable:!0,get:function(){return a.applyHooks}}),Object.defineProperty(t,"AsyncHooks",{enumerable:!0,get:function(){return a.AsyncHooks}});var s=n(70071);Object.defineProperty(t,"isResolvedPreset",{enumerable:!0,get:function(){return s.isResolvedPreset}}),Object.defineProperty(t,"resolvePresets",{enumerable:!0,get:function(){return s.resolvePresets}}),t.sortedPlugins=function(e){return e?(0,r.sortWithBeforeAfterProvides)(e,"name"):[]}},70783:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},70071:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.resolvePresets=t.isResolvedPreset=void 0,n(70783);const r=n(28446),a=["name","experimental","provides","before","after","appendPlugins","prependPlugins","skipPlugins"],s=["plugins","disablePlugins","extends"];let o;try{if(o=n(44256).inspect,"function"!=typeof o)throw new Error("Failed to load inspect")}catch{o=e=>Array.isArray(e)||!e||null===Object.getPrototypeOf(e)||Object.getPrototypeOf(e)===Object.prototype?JSON.stringify(e):String(e)}function i(e){return e.plugins&&0===e.extends?.length||!1}function l(e,t){if(void 0===t&&(t=!0),1===e.length){const t=e[0];if(t&&i(t))return t}const n={extends:[],plugins:[],disablePlugins:[]};for(const t of e){f(n,d(t))}return n.plugins&&(n.plugins=(0,r.sortWithBeforeAfterProvides)(n.plugins,"name")),t&&n.disablePlugins&&n.disablePlugins.length>0&&console.warn(`One or more of the plugin(s) entered in your preset's 'disablePlugins' list was not found:\n${n.disablePlugins.map((e=>`  - ${e}`)).join("\n")}\nThe list of know plugins is:\n  ${n.plugins?.map((e=>e.name)).join(", ")??"-"}`),n}function c(e){if("object"!=typeof e||null==e)throw new Error(`Expected plugin, but found '${o(e)}'`);const t=Object.getPrototypeOf(e);if(t!==Object.prototype&&null!==t)throw new Error(`Expected plugin to be a plain object, but found '${o(e)}'`);if("string"!=typeof e.name)throw new Error(`Expected plugin to have a string 'name'; found ${o(e.name)} (${o(e)})`);if(null!=e.version&&"string"!=typeof e.version)throw new Error(`Expected plugin '${e.name}' to have a string 'version'; found ${o(e.version)}`);const n=Object.keys(e).filter(p);if(n.length)throw new Error(`Expected a GraphileConfig plugin, but found an object with forbidden keys (e.g. keys starting with a capital letter, or a 'default' key). This typically indicates an issue with ESM compatibility or import method, for example doing \`import MyPlugin from 'my-plugin'\` instead of \`import { MyPlugin } from 'my-plugin'\` or vice versa. Forbidden keys: '${n.join("', '")}', full value: '${o(e)}'`);for(const t of s)if(e[t])throw new Error(`Plugin '${e.name}' has '${t}' property which suggests it is a preset rather than a plugin. If it is indeed a preset you should add it to your preset via 'extends' rather than 'plugins'.`)}function u(e){return/^[A-Z_]/.test(e)||"default"===e}function p(e){return/^[A-Z_]/.test(e)||"default"===e}function d(e){if(!function(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype||"[object Object]"===String(e)}(e))throw new Error(`Expected a GraphileConfig preset (a plain JS object), but found '${o(e)}'`);const t=Object.keys(e).filter(u);if(t.length)throw new Error(`Expected a GraphileConfig preset, but found an object with forbidden keys (e.g. keys starting with a capital letter, or a 'default' key). This typically indicates an issue with ESM compatibility or import method, for example doing \`import MyPreset from 'my-preset'\` instead of \`import { MyPreset } from 'my-preset'\` or vice versa. Forbidden keys: '${t.join("', '")}', full value: '${o(e)}'`);try{for(const t of a)if(e[t])throw new Error(`Preset has '${t}' property which suggests it is a plugin rather than a preset. If it is indeed a plugin you should add it to your preset via 'plugins' rather than 'extends'.`);const{extends:t=[]}=e,n=l(t,!1);f(n,e);const r=n.disablePlugins;if(r){const e=new Set(n.plugins),t=new Set(r);for(const n of e)c(n),t.has(n.name)&&(t.delete(n.name),e.delete(n));n.plugins=[...e],n.disablePlugins=[...t]}return n}catch(t){throw new Error(`Error occurred when resolving preset: ${t}\nPreset: ${o(e)}`)}}function f(e,t){if(null!=e.extends&&0!==e.extends.length)throw new Error("First argument to mergePreset must be a resolved preset");const n=new Set([...e.plugins||[],...t.plugins||[]]);e.plugins=[...n],t.disablePlugins&&(e.disablePlugins=[...new Set([...e.disablePlugins??[],...t.disablePlugins??[]])]);const r=Object.keys(e).filter(h),a=Object.keys(t).filter(h),s=[...new Set([...r,...a])];for(const n of s){const r=e[n],a=t[n];if(r&&a){if(Array.isArray(r)!==Array.isArray(a))throw new Error(`${n} contains an array entry in one preset and a non-array entry in another, this doesn't make sense`);Array.isArray(a)?e[n]=a:e[n]=Object.assign(Object.create(null),r,a)}else e[n]=r||a}}function h(e){return"extends"!==e&&"plugins"!==e&&"disablePlugins"!==e}t.isResolvedPreset=i,t.resolvePresets=l},28446:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sortWithBeforeAfterProvides=void 0,t.sortWithBeforeAfterProvides=function(e,t){const n=e.map((e=>{const n=[...e.before??[]],r=[...e.after??[]],a=[...e.provides??[]];return a.includes(e[t])||a.push(e[t]),{thing:e,before:n,after:r,provides:a}})),r=new Set;for(const{provides:e}of n)for(const t of e)r.add(t);for(const{after:e,before:t}of n)for(const a of[...e,...t])r.has(a)||(n.push({thing:Symbol(a),before:[],after:[],provides:[a]}),r.add(a));for(const{thing:e,before:r}of n){if("symbol"==typeof e)continue;const{[t]:a}=e;if(r.length){const t=r.splice(0,r.length);for(const{thing:r,provides:s,after:o}of n)r!==e&&t.some((e=>s.includes(e)))&&o.push(a)}}const a=[],s=[...n];for(let e=0;e<1e4;e++){let e=0;if(0===s.length)break;for(let t=0;t<s.length;t++){const n=s[t];if(!n)continue;const{thing:r,after:o}=n;s.some((e=>{let{thing:t,provides:n}=e;return t!==r&&n.some((e=>o.includes(e)))}))||(e++,s.splice(t,1),"symbol"!=typeof r&&a.push(r),t--)}if(0===e)throw new Error(`Infinite loop in dependencies detected; remaining items:\n  ${s.map((e=>`${"symbol"==typeof e.thing?`FakeProvider<${e.thing.description}>`:e.thing[t]} (after: ${e.after}; provides: ${e.provides})`)).join("\n  ")}`)}if(a.length!==e.length)throw new Error(`Expected the same number of list entries after sorting (${a.length} != ${e.length})`);return a}}}]);