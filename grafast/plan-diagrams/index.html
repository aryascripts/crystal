<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-plan-diagrams">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Plan diagrams | Grafast</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://grafast.org/grafast/plan-diagrams"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Plan diagrams | Grafast"><meta data-rh="true" name="description" content="A plan diagram is a directed acyclic graph made of a number of step nodes"><meta data-rh="true" property="og:description" content="A plan diagram is a directed acyclic graph made of a number of step nodes"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://grafast.org/grafast/plan-diagrams"><link data-rh="true" rel="alternate" href="https://grafast.org/grafast/plan-diagrams" hreflang="en"><link data-rh="true" rel="alternate" href="https://grafast.org/grafast/plan-diagrams" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://G81R3UYS9Q-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Grafast" href="/opensearch.xml">


<link rel="alternate" type="application/rss+xml" href="/news/rss.xml" title="Grafast RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/news/atom.xml" title="Grafast Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8cd52a68.css">
<link rel="preload" href="/assets/js/runtime~main.f86d0f08.js" as="script">
<link rel="preload" href="/assets/js/main.60ddd26c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_G6ar" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_ncOr" role="banner"><div class="content_L1uV announcementBarContent__57G"><a href="/caveats">Read the pre-release caveats!</a> Documentation is not complete; PRs welcome ♥</div></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/grafast-exclamation.svg" alt="Grafast Logo" class="themedImage_RWGG themedImage--light_riBm"><img src="/img/grafast-exclamation.svg" alt="Grafast Logo" class="themedImage_RWGG themedImage--dark_Dsi0"></div><b class="navbar__title text--truncate">Home</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/grafast/">Gra<em>fast</em></a><a class="navbar__item navbar__link" href="/grafserv/">Grafserv</a><a class="navbar__item navbar__link" href="/ruru/">Ruru</a><a class="navbar__item navbar__link" href="/playground">Playground</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/news">News</a><a class="navbar__item navbar__link" href="/sponsor">Sponsor</a><a href="https://github.com/grafast/wg" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">WG<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/graphile/crystal/tree/main/grafast/grafast/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_OLSw colorModeToggle_Hg9V"><button class="clean-btn toggleButton_wYmb toggleButtonDisabled_vaDU" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_Sxwe"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Yem1"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_xrOJ"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_UyTV docsWrapper_BqXd"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_z1FD" type="button"></button><div class="docPage_pOTq"><aside class="theme-doc-sidebar-container docSidebarContainer_aIKW"><div class="sidebarViewport_DwR9"><div class="sidebar_vJCc"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_qiME menuWithAnnouncementBar_hRfJ"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/">Grafast Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/grafast/getting-started/">Getting started</a><button aria-label="Toggle the collapsible sidebar category &#x27;Getting started&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/servers">Servers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/plan-resolvers">Plan resolvers</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/grafast/step-library/">Step library</a><button aria-label="Toggle the collapsible sidebar category &#x27;Step library&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/step-classes">Step classes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/request-overview">Request overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/operation-plan">Operation plan</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/access-control">Access control</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/grafast/plan-diagrams">Plan diagrams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/polymorphism">Polymorphism</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/grafast/production-considerations">Production Considerations</a></li></ul></nav></div></div></aside><main class="docMainContainer_fv3b"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_YAwJ"><div class="docItemContainer_Rv5Z"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_zCmv" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_JFrk"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Plan diagrams</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_O_Qc theme-doc-toc-mobile tocMobile_tjDr"><button type="button" class="clean-btn tocCollapsibleButton_htYj">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Plan diagrams</h1><p>A plan diagram is a directed acyclic graph made of a number of <strong>step</strong> nodes
connected by arrows which show the flow of data. It also details the <strong>LayerPlans</strong>
(aka &quot;buckets&quot;) and the relationships between them.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="example">Example<a href="#example" class="hash-link" aria-label="Direct link to Example" title="Direct link to Example">​</a></h2><p>For the following GraphQL request:</p><div class="language-graphql codeBlockContainer_ZGJx theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_qZBB"><pre tabindex="0" class="prism-code language-graphql codeBlock_TAPP thin-scrollbar"><code class="codeBlockLines_AdAo"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token object">currentUser</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token object">friends</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup_TNwR"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_MVhB" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_yxgH"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_QJLJ"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You might see a plan diagram such as:</p><div class="mermaid">%%{init: {&#x27;themeVariables&#x27;: { &#x27;fontSize&#x27;: &#x27;12px&#x27;}}}%%
flowchart TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef unbatchedplan fill:#dff,stroke-width:1px,color:#000
    classDef sideeffectplan fill:#fcc,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left


    %% plan dependencies
    Access7{{&quot;Access[7∈0]&lt;br /&gt;ᐸ3.currentUserIdᐳ&quot;}}:::plan
    __Value3[&quot;__Value[3∈0]&lt;br /&gt;ᐸcontextᐳ&quot;]:::plan
    __Value3 --&gt; Access7
    Load8[[&quot;Load[8∈0]&lt;br /&gt;ᐸuserByIdᐳ&quot;]]:::plan
    Access7 --&gt; Load8
    Load11[[&quot;Load[11∈0]&lt;br /&gt;ᐸfriendshipsByUserIdᐳ&quot;]]:::plan
    Access7 --&gt; Load11
    __Value0[&quot;__Value[0∈0]&quot;]:::plan
    __Value5[&quot;__Value[5∈0]&lt;br /&gt;ᐸrootValueᐳ&quot;]:::plan
    __Item15[/&quot;__Item[15∈3]&lt;br /&gt;ᐸ11ᐳ&quot;\]:::itemplan
    Load11 ==&gt; __Item15
    Access17{{&quot;Access[17∈3]&lt;br /&gt;ᐸ15.friend_idᐳ&quot;}}:::plan
    __Item15 --&gt; Access17
    Load18[[&quot;Load[18∈3]&lt;br /&gt;ᐸuserByIdᐳ&quot;]]:::plan
    Access17 --&gt; Load18

    %% define steps

    Bucket0(&quot;Bucket 0 (root)&lt;br /&gt;1: &lt;br /&gt;ᐳ: Access[7]&lt;br /&gt;2: Load[8], Load[11]&quot;):::bucket
    classDef bucket0 stroke:#696969
    class Bucket0,__Value0,__Value3,__Value5,Access7,Load8,Load11 bucket0
    Bucket1(&quot;Bucket 1 (nullableBoundary)&lt;br /&gt;Deps: 8, 11&lt;br /&gt;&lt;br /&gt;ROOT LoadᐸuserByIdᐳ[8]&quot;):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1 bucket1
    Bucket3(&quot;Bucket 3 (listItem)&lt;br /&gt;ROOT __Item{3}ᐸ11ᐳ[15]&lt;br /&gt;1: &lt;br /&gt;ᐳ: Access[17]&lt;br /&gt;2: Load[18]&quot;):::bucket
    classDef bucket3 stroke:#ffa500
    class Bucket3,__Item15,Access17,Load18 bucket3
    Bucket4(&quot;Bucket 4 (nullableBoundary)&lt;br /&gt;Deps: 18&lt;br /&gt;&lt;br /&gt;ROOT Load{3}ᐸuserByIdᐳ[18]&quot;):::bucket
    classDef bucket4 stroke:#0000ff
    class Bucket4 bucket4
    Bucket0 --&gt; Bucket1
    Bucket1 --&gt; Bucket3
    Bucket3 --&gt; Bucket4</div><p>This diagram has two main sections: the <strong>steps</strong>, and the <strong>buckets</strong>. We&#x27;ll
talk about the buckets first.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_qNG0"><div class="admonitionHeading_l909"><span class="admonitionIcon_UNbs"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_oUmQ"><p>If you&#x27;re able to convince mermaid to reliably render these two things on the
same diagram in a more independent manner, please get in touch!</p></div></div><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="buckets-aka-layer-plans">Buckets (aka layer plans)<a href="#buckets-aka-layer-plans" class="hash-link" aria-label="Direct link to Buckets (aka layer plans)" title="Direct link to Buckets (aka layer plans)">​</a></h2><p>A bucket, or layer plan, is where data for steps at a similar &quot;layer&quot; in the
operation go. For each layer, the cardinality is the same for every step -
every step deals with the same number of results. Generally buckets are
introduced where this may no longer be the case - for example when we start
handling more results due to processing the items in a list, or fewer results
due to polymorphic filtering or excluding null results from further processing.</p><p>Here&#x27;s an example of a bucket node:</p><div class="mermaid">
%%{init: {&#x27;themeVariables&#x27;: { &#x27;fontSize&#x27;: &#x27;12px&#x27;}}}%%
flowchart TD
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left
    Bucket1(&quot;Bucket 1 (nullableBoundary)&lt;br /&gt;Deps: 8&lt;br /&gt;&lt;br /&gt;ROOT LoadOneᐸuserByIdᐳ[8]&lt;br /&gt;1: &lt;br /&gt;ᐳ: Access[10]&lt;br /&gt;2: Load[11]&quot;):::bucket
    classDef bucket1 stroke:#00bfff
    class Bucket1,Access10,Load11 bucket1
</div><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="first-line-eg-bucket-1-nullableboundary">First line (e.g. <code>Bucket 1 (nullableBoundary)</code>)<a href="#first-line-eg-bucket-1-nullableboundary" class="hash-link" aria-label="Direct link to first-line-eg-bucket-1-nullableboundary" title="Direct link to first-line-eg-bucket-1-nullableboundary">​</a></h3><p>The first line in the bucket node always start with the word <code>Bucket</code> followed by the bucket number.
Buckets are numbered from <code>0</code>, but during the optimization of the operation
plan the need for certain buckets may be eradicated, resulting in &quot;gaps&quot; in the
numbering. Afterwards comes the reason for the bucket, in parenthesis: <code>root</code>,
<code>nullableBoundary</code>, <code>listItem</code>, <code>subscription</code>, <code>mutationField</code>, <code>defer</code>,
<code>polymorphic</code>, <code>subroutine</code> or other.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="deps"><code>Deps:</code><a href="#deps" class="hash-link" aria-label="Direct link to deps" title="Direct link to deps">​</a></h3><p>A line starting with <code>Deps:</code> indicates the buckets &quot;dependencies&quot; - that is to
say the data from the parent bucket that will be copied into this bucket when
it is created, before execution of any of the steps within the bucket
commences.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="root"><code>ROOT</code><a href="#root" class="hash-link" aria-label="Direct link to root" title="Direct link to root">​</a></h3><p>A line starting with <code>ROOT</code> indicates the step that represents the &quot;root&quot; of
the bucket, this is often used for checking for nulls/errors and similar
purposes.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="1"><code>1:</code><a href="#1" class="hash-link" aria-label="Direct link to 1" title="Direct link to 1">​</a></h3><p>Lines beginning with a number indicate the order in which the steps will be
executed in that bucket. Numbered lines with multiple steps listed will execute
those steps in parallel since they are independent of each other.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="ᐳ"><code>ᐳ:</code><a href="#ᐳ" class="hash-link" aria-label="Direct link to ᐳ" title="Direct link to ᐳ">​</a></h3><p>Immediately following a numbered line, there may be a line that begins with
&quot;ᐳ:&quot;. This indicates the &quot;synchronous and safe&quot; unbatched steps that will be
executed immediately after the numbered line - this is an optimization that
means the system doesn&#x27;t need to loop multiple times to satisfy these needs.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="steps">Steps<a href="#steps" class="hash-link" aria-label="Direct link to Steps" title="Direct link to Steps">​</a></h2><p>Generally when looking at a plan diagram, you care more about the steps than
the buckets. Each step contains a first line that consists of the step class
name with <code>Step</code> removed (for brevity), followed by <code>[X∈Y]</code> where X is the id
of the step, and Y is the number of the bucket to which it belongs - the latter
of which is also indicated by the border colour of the step.</p><p>Often steps will have a second line of text such as <code>ᐸ3.currentUserIdᐳ</code> - this
is metadata specific to that particular step class that gives more detail on
what this step is doing.</p><p>The shape of the step&#x27;s border also reveals more details about the step:</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="standard-synchronous-steps">Standard synchronous steps<a href="#standard-synchronous-steps" class="hash-link" aria-label="Direct link to Standard synchronous steps" title="Direct link to Standard synchronous steps">​</a></h3><div class="mermaid">%%{init: {&#x27;themeVariables&#x27;: { &#x27;fontSize&#x27;: &#x27;16px&#x27;}}}%%
flowchart TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left
    classDef bucket0 stroke:#696969
    classDef bucket2 stroke:#7f007f

    __Value5[&quot;__Value[5∈0]&lt;br /&gt;ᐸrootValueᐳ&quot;]:::plan
    class __Value5 bucket0
</div><p>A standard synchronous step is represented by a simple rectangle.</p><p>In this example:</p><ul><li><code>__Value</code> is the name of the Step (but with the redundant &#x27;Step&#x27; removed - truly it&#x27;s called <code>__ValueStep</code>).</li><li><code>5</code> is the step ID - every step has a unique identifier.</li><li><code>∈0</code> means that the step &quot;belongs&quot; to LayerPlan (aka &quot;bucket&quot;) number <code>0</code>.</li><li>The next line contains additional step-specific metadata; in this case it&#x27;s telling us that the step represents the GraphQL <code>rootValue</code></li></ul><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="asynchronous-steps">Asynchronous steps<a href="#asynchronous-steps" class="hash-link" aria-label="Direct link to Asynchronous steps" title="Direct link to Asynchronous steps">​</a></h3><div class="mermaid">%%{init: {&#x27;themeVariables&#x27;: { &#x27;fontSize&#x27;: &#x27;16px&#x27;}}}%%
flowchart TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left
    classDef bucket0 stroke:#696969
    classDef bucket2 stroke:#7f007f

    LoadOne18[[&quot;LoadOne[18∈3]&lt;br /&gt;ᐸuserByIdᐳ&quot;]]:::plan
    class LoadOne18 bucket2
</div><p>These appear very similar to synchronous steps, except that they have a double
border on the left and right. The key difference with these steps, and why they
render more prominently, is that this is typically where your work will take
place - they execute asynchronously, and so can communicate with remote
services and resources.</p><p>All step classes you create will generate asynchronous steps unless you
specifically opt them in to one of the optimized forms.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="item-steps">Item steps<a href="#item-steps" class="hash-link" aria-label="Direct link to Item steps" title="Direct link to Item steps">​</a></h3><div class="mermaid">%%{init: {&#x27;themeVariables&#x27;: { &#x27;fontSize&#x27;: &#x27;16px&#x27;}}}%%
flowchart TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left
    classDef bucket0 stroke:#696969
    classDef bucket2 stroke:#7f007f

    __Item15[/&quot;__Item[15∈3]&lt;br /&gt;ᐸ11ᐳ&quot;\]:::itemplan
    class __Item15 bucket3
</div><p><code>__ItemStep</code> steps never execute, they&#x27;re managed by <!-- -->Gra<i>fast</i> manually to
represent individual entries in a list or stream (including subscription event
streams). They look like a trapezoid (US) / trapezium (UK) to imply that they
are going from a smaller set to a larger set, though this isn&#x27;t always the
case.</p><h3 class="anchor anchorWithStickyNavbar_fF9Z" id="unbatched-synchronous-steps">Unbatched synchronous steps<a href="#unbatched-synchronous-steps" class="hash-link" aria-label="Direct link to Unbatched synchronous steps" title="Direct link to Unbatched synchronous steps">​</a></h3><div class="mermaid">%%{init: {&#x27;themeVariables&#x27;: { &#x27;fontSize&#x27;: &#x27;16px&#x27;}}}%%
flowchart TD
    classDef path fill:#eee,stroke:#000,color:#000
    classDef plan fill:#fff,stroke-width:1px,color:#000
    classDef itemplan fill:#fff,stroke-width:2px,color:#000
    classDef sideeffectplan fill:#f00,stroke-width:2px,color:#000
    classDef bucket fill:#f6f6f6,color:#000,stroke-width:2px,text-align:left
    classDef bucket0 stroke:#696969
    classDef bucket2 stroke:#7f007f

    Access17{{&quot;Access[17∈3]&lt;br /&gt;ᐸ15.friend_idᐳ&quot;}}:::plan
    class Access17 bucket3
</div><p>An unbatched synchronous step is a special variant of a synchronous step that
confers no benefit from batching. This allows the system to calculate their
values alongside their dependencies without having to loop multiple times.
Typically they&#x27;re used for trivial operations such as accessing a named
property from an object or accessing the first/last entry in a list.</p><h2 class="anchor anchorWithStickyNavbar_fF9Z" id="how-to-see-a-requests-plan-diagram">How to see a request&#x27;s plan diagram<a href="#how-to-see-a-requests-plan-diagram" class="hash-link" aria-label="Direct link to How to see a request&#x27;s plan diagram" title="Direct link to How to see a request&#x27;s plan diagram">​</a></h2><p>Your server must be configured to expose plans for you to be able to see them;
if it is then you can use a tool such as <a href="/ruru">Ruru</a> to view the execution plan,
or you can render it directly from the JSON response. You can convert the plan
JSON into mermaid format via the <code>planToMermaid</code> function so you can load them
into the <a href="https://mermaid-js.github.io/mermaid-live-editor/edit" target="_blank" rel="noopener noreferrer">mermaid live editor</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/graphile/crystal/tree/main/grafast/website/grafast/plan-diagrams.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_UohW" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_T23F"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/grafast/access-control"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Access control</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/grafast/polymorphism"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Polymorphism</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_TN1Q thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#example" class="table-of-contents__link toc-highlight">Example</a></li><li><a href="#buckets-aka-layer-plans" class="table-of-contents__link toc-highlight">Buckets (aka layer plans)</a><ul><li><a href="#first-line-eg-bucket-1-nullableboundary" class="table-of-contents__link toc-highlight">First line (e.g. <code>Bucket 1 (nullableBoundary)</code>)</a></li><li><a href="#deps" class="table-of-contents__link toc-highlight"><code>Deps:</code></a></li><li><a href="#root" class="table-of-contents__link toc-highlight"><code>ROOT</code></a></li><li><a href="#1" class="table-of-contents__link toc-highlight"><code>1:</code></a></li><li><a href="#ᐳ" class="table-of-contents__link toc-highlight"><code>ᐳ:</code></a></li></ul></li><li><a href="#steps" class="table-of-contents__link toc-highlight">Steps</a><ul><li><a href="#standard-synchronous-steps" class="table-of-contents__link toc-highlight">Standard synchronous steps</a></li><li><a href="#asynchronous-steps" class="table-of-contents__link toc-highlight">Asynchronous steps</a></li><li><a href="#item-steps" class="table-of-contents__link toc-highlight">Item steps</a></li><li><a href="#unbatched-synchronous-steps" class="table-of-contents__link toc-highlight">Unbatched synchronous steps</a></li></ul></li><li><a href="#how-to-see-a-requests-plan-diagram" class="table-of-contents__link toc-highlight">How to see a request&#39;s plan diagram</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/grafast">Gra<em>fast</em></a></li><li class="footer__item"><a class="footer__link-item" href="/grafserv/">Grafserv</a></li><li class="footer__item"><a class="footer__link-item" href="/ruru/">Ruru</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/graphile" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/GraphileHQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/graphile/crystal" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_awgD"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Graphile Ltd. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.f86d0f08.js"></script>
<script src="/assets/js/main.60ddd26c.js"></script>
</body>
</html>